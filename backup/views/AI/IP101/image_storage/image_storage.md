# ğŸ“¦ å›¾åƒå­˜å‚¨ç§˜ç±

> ğŸŒŸ åœ¨è®¡ç®—æœºè§†è§‰çš„ä¸–ç•Œé‡Œï¼Œç†è§£å›¾åƒå­˜å‚¨å°±åƒæ˜¯æŒæ¡äº†æ•°å­—å›¾åƒçš„"DNA"ã€‚ä»Šå¤©ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å½“ç¦å°”æ‘©æ–¯ï¼Œè§£å¼€å›¾åƒæ•°æ®å­˜å‚¨ä¹‹è°œï¼

## ğŸ“š ç›®å½•

1. [åŸºç¡€æ¦‚å¿µ - è®¡ç®—æœºçœ¼ä¸­çš„"ä¸–ç•Œ"](#åŸºç¡€æ¦‚å¿µ)
2. [å­˜å‚¨æ ¼å¼ - æ•°å­—å›¾åƒçš„"ç™¾å®ç®±"](#å­˜å‚¨æ ¼å¼)
3. [å†…å­˜å¸ƒå±€ - æ•°æ®çš„"è±ªå®…è£…ä¿®æŒ‡å—"](#å†…å­˜å¸ƒå±€)
4. [æ·±åº¦å­¦ä¹ æ ¼å¼ - AIæ—¶ä»£çš„"æ–°æ½®æµ"](#æ·±åº¦å­¦ä¹ æ ¼å¼)
5. [æ€§èƒ½ä¼˜åŒ– - å­˜å‚¨çš„"é€Ÿåº¦ä¸æ¿€æƒ…"](#æ€§èƒ½ä¼˜åŒ–)

## ğŸ¯ åŸºç¡€æ¦‚å¿µ
<a name="åŸºç¡€æ¦‚å¿µ"></a>

### 1. åƒç´ ï¼ˆPixelï¼‰- å›¾åƒç•Œçš„"åŸå­"
å°±åƒä¹é«˜ç§¯æœ¨ä¸€æ ·ï¼Œå†å®ä¼Ÿçš„å»ºç­‘ä¹Ÿæ˜¯ç”±ä¸€ä¸ªä¸ªå°æ–¹å—æ­å»ºè€Œæˆã€‚åœ¨å›¾åƒä¸–ç•Œé‡Œï¼Œè¿™äº›"å°æ–¹å—"å°±æ˜¯åƒç´ ï¼š

```
åƒç´ çš„"å…¨å®¶ç¦"ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äºŒå€¼åƒç´ ï¼š1bitâ”‚ <- éé»‘å³ç™½çš„å°æ¸…æ–°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç°åº¦åƒç´ ï¼š8bitâ”‚ <- æ–‡è‰ºé»‘ç™½ç‰‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½©è‰²åƒç´ ï¼š24bitâ”‚ <- å¤šå½©äººç”Ÿ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ä½æ·±åº¦ï¼ˆBit Depthï¼‰- è‰²å½©ç•Œçš„"è´¢å¯Œå¯†ç "
å†³å®šæ¯ä¸ªåƒç´ èƒ½"ç©¿"å¤šå°‘ç§é¢œè‰²ï¼š

| ä½æ·±åº¦ | å¯è¡¨ç¤ºé¢œè‰²æ•° | å…¸å‹åº”ç”¨ | é€šä¿—è§£é‡Š |
|-------|------------|---------|---------|
| 1ä½   | 2 (2Â¹)     | äºŒå€¼å›¾åƒ | éé»‘å³ç™½ï¼Œåƒè€ƒè¯•ç­”é¢˜å¡ |
| 8ä½   | 256 (2â¸)   | ç°åº¦å›¾åƒ | ä¸€ç”Ÿåªçˆ±ä¸€ç§é¢œè‰²ï¼Œä½†æœ‰256ç§æ·±æµ… |
| 24ä½  | 16.7M (2Â²â´)| çœŸå½©è‰²  | æ¯”ä½ è¡£æŸœé‡Œçš„è¡£æœè¿˜è¦å¤šçš„é€‰æ‹© |
| 32ä½  | 4.3B (2Â³Â²) | å¸¦é€æ˜é€šé“ | åŠ ä¸Šäº†"éšèº«è¡£"åŠŸèƒ½ |

### 3. åˆ†è¾¨ç‡ï¼ˆResolutionï¼‰- å›¾åƒçš„"é¢œå€¼å¯†åº¦"
å°±åƒæˆ¿åœ°äº§ä¸€æ ·ï¼Œé¢ç§¯ï¼ˆåˆ†è¾¨ç‡ï¼‰å†³å®šæ°”è´¨ï¼š

```python
class ImageResolution:
    def __init__(self, width, height):
        self.width = width    # æ¨ªå‘æœ‰å¤šå°‘"æ ¼å­"
        self.height = height  # çºµå‘æœ‰å¤šå°‘"æ ¼å­"
        self.total_pixels = width * height  # æ€»"é¢ç§¯"
        self.aspect_ratio = width / height  # "èº«ææ¯”ä¾‹"
```

## ğŸ“Š å­˜å‚¨æ ¼å¼
<a name="å­˜å‚¨æ ¼å¼"></a>

### 1. äºŒè¿›åˆ¶æ ¼å¼ - æ•°æ®çš„"ç”Ÿå­˜æ–¹å¼"

#### 1.1 åŸå§‹æ ¼å¼ï¼ˆRAWï¼‰- æ•°æ®çš„"ç´ é¢œç…§"
```cpp
// æœ€ç®€å•çš„å›¾åƒå­˜å‚¨æ–¹å¼ï¼Œå°±åƒæŠŠæ•°æ®æ‰“åŒ…æ”¾è¿›å¿«é€’ç›’
struct RawImage {
    uint32_t width;      // å®½åº¦ï¼Œåƒç›’å­çš„é•¿
    uint32_t height;     // é«˜åº¦ï¼Œåƒç›’å­çš„å®½
    uint8_t* data;       // åƒç´ æ•°æ®ï¼Œå°±æ˜¯ç›’å­é‡Œçš„ä¸œè¥¿
};
```

#### 1.2 å‹ç¼©æ ¼å¼ - æ•°æ®çš„"å˜å½¢è®°"
```python
# å„ç§å‹ç¼©æ ¼å¼çš„"æ±Ÿæ¹–åœ°ä½"
formats = {
    'JPEG': {
        'compression': 'lossy',        # æœ‰æŸå‹ç¼©ï¼ŒåƒæŠŠè¡£æœå èµ·æ¥ï¼Œéš¾å…æœ‰è¤¶çš±
        'best_for': 'photographs',     # æœ€é€‚åˆæ‹ç…§ï¼Œä¸é€‚åˆå­˜æ”¾ä½ çš„ä»£ç 
        'typical_ratio': '10:1'        # å‹ç¼©æ¯”ï¼Œåƒå‡è‚¥æˆåŠŸç‡
    },
    'PNG': {
        'compression': 'lossless',     # æ— æŸå‹ç¼©ï¼ŒåƒçœŸç©ºå‹ç¼©è¢‹
        'best_for': 'graphics',        # æœ€é€‚åˆå›¾å½¢ï¼Œä¿è¯çº¿æ¡ä¸å˜å½¢
        'typical_ratio': '2:1'         # å‹ç¼©æ¯”ç›¸å¯¹ä¿å®ˆ
    },
    'WebP': {
        'compression': 'both',         # åŒæ¨¡å‹ç¼©ï¼Œåƒå¯ä»¥å˜å½¢çš„å˜å½¢é‡‘åˆš
        'best_for': 'web images',      # ç½‘é¡µå›¾ç‰‡çš„æ–°å® 
        'typical_ratio': '15:1'        # å‹ç¼©æ¯”å¾ˆæ¿€è¿›
    }
}
```

### 2. é¢œè‰²ç©ºé—´ - è‰²å½©çš„"å¤šé‡å®‡å®™"

#### 2.1 RGB/BGR - ä¸‰åŸè‰²çš„"é“ä¸‰è§’"
```
ä¸‰åŸè‰²çš„"ç»„åˆæ‹³"ï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  R  â”‚  G  â”‚  B  â”‚
â”‚(çº¢) â”‚(ç»¿) â”‚(è“) â”‚ <- å…‰çš„ä¸‰åŸè‰²ï¼Œä¸æ˜¯é¢œæ–™å“¦ï¼
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

#### 2.2 YUV - äº®åº¦ä¸è‰²åº¦çš„"åˆ†å±…åè®®"
```
æ˜æš—ä¸è‰²å½©åˆ†å¼€å­˜æ”¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  Y  â”‚  U  â”‚  V  â”‚
â”‚(äº®åº¦)â”‚(è‰²åº¦)â”‚(è‰²åº¦)â”‚ <- Yç‹¬å±…ï¼ŒUVåˆç§Ÿ
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

å­˜å‚¨æ–¹æ¡ˆçš„"èŠ‚çº¦æ”»ç•¥"ï¼š
YUV444: Y Y Y Y  æ¯ä¸ªYéƒ½æœ‰ä¸“å±UVï¼ˆè±ªåå¥—æˆ¿ï¼‰
        U U U U
        V V V V

YUV422: Y Y Y Y  ä¸¤ä¸ªYå…±äº«ä¸€ç»„UVï¼ˆåˆç§Ÿæˆ¿ï¼‰
        U U
        V V

YUV420: Y Y Y Y  å››ä¸ªYå…±äº«ä¸€ç»„UVï¼ˆç¾¤ç§Ÿæˆ¿ï¼‰
        Y Y Y Y
        U U
        V V
```

#### 2.3 HSV/HSL - æ›´ç¬¦åˆäººç±»ç›´è§‰çš„"è‰²å½©ä¸–ç•Œ"
```
æ›´æ¥åœ°æ°”çš„é¢œè‰²è¡¨ç¤ºï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  H  â”‚  S  â”‚  V  â”‚
â”‚(è‰²ç›¸)â”‚(é¥±å’Œ)â”‚(æ˜åº¦)â”‚ <- åƒè°ƒè‰²ç›˜ä¸€æ ·ç›´è§‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ å†…å­˜å¸ƒå±€
<a name="å†…å­˜å¸ƒå±€"></a>

### 1. è¿ç»­å­˜å‚¨ - æ•°æ®çš„"ä¸€å­—é•¿åŸ"
```cpp
// ä¸€ç»´æ•°ç»„å­˜å‚¨ï¼ŒåƒæŠŠæ‰€æœ‰ä¸œè¥¿æ’æˆä¸€é˜Ÿ
template<typename T>
class ImageData {
    T* data;          // æ•°æ®"é•¿é˜Ÿ"
    size_t width;     // é˜Ÿä¼æ¯æ’å¤šå°‘äºº
    size_t height;    // æœ‰å¤šå°‘æ’
    size_t channels;  // æ¯ä¸ªäººå¸¦å¤šå°‘ä¸ª"èƒŒåŒ…"

    T& at(size_t x, size_t y, size_t c) {
        return data[(y * width + x) * channels + c];  // æ‰¾åˆ°æŒ‡å®šä½ç½®çš„"æˆ˜å£«"
    }
};
```

### 2. åˆ†ç¦»å­˜å‚¨ - æ•°æ®çš„"ä¸‰å›½æ¼”ä¹‰"
```cpp
// ä¸‰ä¸ªé€šé“åˆ†å¼€å­˜å‚¨ï¼Œåƒä¸‰ä¸ªç‹¬ç«‹çš„ç‹å›½
template<typename T>
class PlanarImage {
    T* channel_r;     // çº¢è‰²ç‹å›½
    T* channel_g;     // ç»¿è‰²ç‹å›½
    T* channel_b;     // è“è‰²ç‹å›½
    size_t width;     // æ¯ä¸ªç‹å›½çš„å®½åº¦
    size_t height;    // æ¯ä¸ªç‹å›½çš„é«˜åº¦

    T& at_channel(T* channel, size_t x, size_t y) {
        return channel[y * width + x];  // åœ¨æŒ‡å®šç‹å›½æ‰¾åˆ°å­æ°‘
    }
};
```

### 3. å¯¹é½è¦æ±‚ - å†…å­˜çš„"å¼ºè¿«ç—‡"
```cpp
// å†…å­˜å¯¹é½ï¼Œåƒæ’é˜Ÿæ—¶è¦æ±‚ç«™åœ¨åœ°ç –çš„æ ¼å­ä¸Š
struct alignas(4) Pixel {    // 4å­—èŠ‚å¯¹é½ï¼Œåƒå››äººä¸€ç»„
    uint8_t r;
    uint8_t g;
    uint8_t b;
    uint8_t a;
};

// è¡Œå¯¹é½ï¼Œåƒæ¯æ’éƒ½è¦å‡‘å¤Ÿä¸€å®šäººæ•°
size_t row_stride = ((width * channels + 3) & ~3);  // 4å­—èŠ‚å¯¹é½
```

## ğŸ¤– æ·±åº¦å­¦ä¹ æ ¼å¼
<a name="æ·±åº¦å­¦ä¹ æ ¼å¼"></a>

### 1. NCHWï¼ˆChannels Firstï¼‰- PyTorchçš„"ç‹¬é—¨æ­¦åŠŸ"
```python
class NCHWTensor:
    def __init__(self, batch_size, channels, height, width):
        self.shape = (batch_size, channels, height, width)
        # PyTorchçš„é»˜è®¤æ ¼å¼ï¼Œåƒå…ˆæŒ‰é¢œè‰²åˆ†ç±»ï¼Œå†æŒ‰ä½ç½®æ’åˆ—
        self.data = torch.zeros(self.shape)

    def get_feature_map(self, batch_idx, channel_idx):
        return self.data[batch_idx, channel_idx, :, :]
```

### 2. NHWCï¼ˆChannels Lastï¼‰- TensorFlowçš„"ç§˜ä¼ å¿ƒæ³•"
```python
class NHWCTensor:
    def __init__(self, batch_size, height, width, channels):
        self.shape = (batch_size, height, width, channels)
        # TensorFlowçš„é»˜è®¤æ ¼å¼ï¼Œåƒå…ˆæŒ‰ä½ç½®æ’åˆ—ï¼Œå†æŒ‰é¢œè‰²åˆ†ç±»
        self.data = tf.zeros(self.shape)

    def get_pixel(self, batch_idx, h, w):
        return self.data[batch_idx, h, w, :]
```

### 3. æ ¼å¼è½¬æ¢ - "æ­¦åŠŸç§˜ç±äº’è¯‘"
```python
def convert_format(image, source='NHWC', target='NCHW'):
    if source == 'NHWC' and target == 'NCHW':
        # ä»TensorFlowè½¬PyTorchï¼Œåƒæ”¹å˜é˜Ÿä¼çš„æ’åˆ—æ–¹å¼
        return image.transpose(0,3,1,2)
    elif source == 'NCHW' and target == 'NHWC':
        # ä»PyTorchè½¬TensorFlowï¼Œåå…¶é“è€Œè¡Œä¹‹
        return image.transpose(0,2,3,1)
```

## âš¡ æ€§èƒ½ä¼˜åŒ–
<a name="æ€§èƒ½ä¼˜åŒ–"></a>

### 1. å†…å­˜è®¿é—®ä¼˜åŒ– - "æ•°æ®çš„é«˜é€Ÿå…¬è·¯"

#### 1.1 ç¼“å­˜å‹å¥½çš„è®¿é—®æ¨¡å¼ - "éµå®ˆäº¤é€šè§„åˆ™"
```cpp
// ä¸å¥½çš„å®ç° - åƒåœ¨è½¦æµä¸­æ¨ªç©¿é©¬è·¯
for(int x = 0; x < width; x++)
    for(int y = 0; y < height; y++)
        process_pixel(data[y][x]);

// ä¼˜åŒ–å®ç° - åƒæŒ‰è½¦é“æœ‰åºè¡Œé©¶
for(int y = 0; y < height; y++)
    for(int x = 0; x < width; x++)
        process_pixel(data[y][x]);
```

#### 1.2 SIMDä¼˜åŒ– - "æ•°æ®çš„å¹¶è¡Œé«˜é€Ÿè·¯"
```cpp
// ä½¿ç”¨SIMDè¿›è¡Œå›¾åƒå¤„ç†ï¼Œåƒå¤šè½¦é“åŒæ—¶é€šè¡Œ
void process_row_simd(uint8_t* row, int width) {
    __m128i* row_ptr = (__m128i*)row;
    for(int x = 0; x < width; x += 16) {
        __m128i pixels = _mm_load_si128(row_ptr);
        // åŒæ—¶å¤„ç†16ä¸ªåƒç´ ï¼Œåƒ16è¾†è½¦å¹¶æ’è¡Œé©¶
        _mm_store_si128(row_ptr, pixels);
        row_ptr++;
    }
}
```

### 2. å­˜å‚¨ä¼˜åŒ– - "æ•°æ®çš„ç²¾æ‰“ç»†ç®—"

#### 2.1 å†…å­˜æ±  - "å¾ªç¯åˆ©ç”¨çš„æ¸¸æ³³æ± "
```cpp
template<typename T>
class ImageMemoryPool {
    std::vector<T*> free_buffers;  // ç©ºé—²çš„"æ³³é“"
public:
    T* acquire(size_t size) {      // ç”³è¯·ä¸€ä¸ª"æ³³é“"
        if(free_buffers.empty())
            return new T[size];     // æ²¡æœ‰ç©ºé—²çš„å°±æ–°å»ºä¸€ä¸ª
        T* buffer = free_buffers.back();
        free_buffers.pop_back();    // æœ‰ç©ºé—²çš„å°±é‡å¤ä½¿ç”¨
        return buffer;
    }

    void release(T* buffer) {       // ç”¨å®Œæ”¾å›å»
        free_buffers.push_back(buffer);
    }
};
```

#### 2.2 é›¶æ‹·è´æŠ€æœ¯ - "æ•°æ®çš„æ„å¿µç§»åŠ¨"
```cpp
class ZeroCopyImage {
    void* data;
    size_t size;
public:
    // ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œåƒç”¨ä¼ é€é—¨ç›´æ¥è®¿é—®
    void map_file(const char* filename) {
        int fd = open(filename, O_RDWR);
        data = mmap(NULL, size, PROT_READ|PROT_WRITE,
                   MAP_SHARED, fd, 0);
        close(fd);
    }
};
```

### 3. å¹¶è¡Œå¤„ç† - "å¤šçº¿ç¨‹çš„å¤§åˆå”±"
```cpp
void process_image_parallel(Image& img) {
    #pragma omp parallel for  // å¤šä¸ªçº¿ç¨‹ä¸€èµ·å¤„ç†ï¼Œåƒå¤šäººåˆä½œ
    for(int y = 0; y < img.height; y++) {
        for(int x = 0; x < img.width; x++) {
            process_pixel(img.at(x, y));
        }
    }
}
```

## ğŸ“ å®æˆ˜é”¦å›Š

1. é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ ¼å¼
   - è€ƒè™‘ä½¿ç”¨åœºæ™¯ï¼ˆæ˜¾ç¤º/ä¼ è¾“/å¤„ç†ï¼‰- åƒé€‰æ‹©åˆé€‚çš„äº¤é€šå·¥å…·
   - æƒè¡¡å‹ç¼©ç‡å’Œè´¨é‡ - åƒé€‰æ‹©å¿«é€’çš„æœåŠ¡ç­‰çº§
   - è¯„ä¼°è§£ç æ€§èƒ½éœ€æ±‚ - åƒè€ƒè™‘æ”¶è´§æ—¶é—´

2. ä¼˜åŒ–å†…å­˜å¸ƒå±€
   - ä½¿ç”¨åˆé€‚çš„å¯¹é½æ–¹å¼ - åƒæ’é˜Ÿè¦æ•´é½
   - é€‰æ‹©é€‚åˆçš„å­˜å‚¨æ¨¡å¼ - åƒé€‰æ‹©åˆé€‚çš„ä»“åº“ç±»å‹
   - è€ƒè™‘ç¼“å­˜å‹å¥½çš„è®¿é—®æ¨¡å¼ - åƒè§„åˆ’æœ€ä¼˜é…é€è·¯çº¿

3. æ€§èƒ½ä¼˜åŒ–æ”»ç•¥
   - ä½¿ç”¨SIMDæŒ‡ä»¤é›† - åƒå¼€å¯"å¤šè½¦é“æ¨¡å¼"
   - å®ç°å¹¶è¡Œå¤„ç† - åƒå¤šä¸ªå¿«é€’å‘˜åŒæ—¶é€è´§
   - é‡‡ç”¨å†…å­˜æ± ç®¡ç† - åƒå¾ªç¯ä½¿ç”¨å¿«é€’ç®±
   - åº”ç”¨é›¶æ‹·è´æŠ€æœ¯ - åƒä½¿ç”¨è™«æ´ä¼ é€

## ğŸ”— å»¶ä¼¸é˜…è¯»

- [OpenCVå›¾åƒæ ¼å¼æŒ‡å—](https://docs.opencv.org/master/d4/da8/group__imgcodecs.html)
- [å›¾åƒå‹ç¼©ç®—æ³•è¯¦è§£](https://en.wikipedia.org/wiki/Image_compression)
- [SIMDç¼–ç¨‹æŒ‡å—](https://software.intel.com/content/www/us/en/develop/documentation/cpp-compiler-developer-guide-and-reference/top/compiler-reference/intrinsics/intrinsics-for-intel-advanced-vector-extensions-2.html)

## ğŸ“š è¿›é˜¶æ¢ç´¢

- [æ•°å­—å›¾åƒå¤„ç† - å†ˆè¨é›·æ–¯](https://book.douban.com/subject/6434627/)
- [æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­çš„å¼ é‡æ ¼å¼](https://pytorch.org/docs/stable/tensor_attributes.html)
- [å¹¶è¡Œè®¡ç®—ä¸å›¾åƒå¤„ç†](https://www.nvidia.com/en-us/research/)

---

> ğŸ’¡ å°è´´å£«ï¼šå›¾åƒå­˜å‚¨çœ‹èµ·æ¥ç®€å•ï¼Œä½†æš—è—ç„æœºã€‚æŒæ¡è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œå°±åƒç»ƒå°±äº†ä¸€èº«"æ•°å­—æ­¦åŠŸ"ï¼è®°ä½ï¼Œå³ä½¿æ˜¯ç«ç®­ç§‘å­¦å®¶ä¹Ÿæ˜¯ä»"1+1=2"å¼€å§‹å­¦èµ·çš„~ ğŸ˜‰