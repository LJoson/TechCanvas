{"remainingRequest":"C:\\Users\\12503\\Desktop\\myblog\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!C:\\Users\\12503\\Desktop\\myblog\\docs\\.vuepress\\plugins\\live2d\\bin\\assets\\js\\live2dv3.js","dependencies":[{"path":"C:\\Users\\12503\\Desktop\\myblog\\docs\\.vuepress\\plugins\\live2d\\bin\\assets\\js\\live2dv3.js","mtime":1587196478000},{"path":"C:\\Users\\12503\\Desktop\\myblog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1689682400664},{"path":"C:\\Users\\12503\\Desktop\\myblog\\node_modules\\babel-loader\\lib\\index.js","mtime":1689682400168}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbGwiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubGFzdC1pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUubm93Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC5zaWduIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmNyZWF0ZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Quc2V0LXByb3RvdHlwZS1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIik7Cgp2YXIgX3R5cGVvZiA9IHJlcXVpcmUoIkM6XFxVc2Vyc1xcMTI1MDNcXERlc2t0b3BcXG15YmxvZ1xcbm9kZV9tb2R1bGVzXFxAdnVlXFxiYWJlbC1wcmVzZXQtYXBwXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL3R5cGVvZiIpOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoIkM6XFxVc2Vyc1xcMTI1MDNcXERlc2t0b3BcXG15YmxvZ1xcbm9kZV9tb2R1bGVzXFxAdnVlXFxiYWJlbC1wcmVzZXQtYXBwXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIik7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgiQzpcXFVzZXJzXFwxMjUwM1xcRGVza3RvcFxcbXlibG9nXFxub2RlX21vZHVsZXNcXEB2dWVcXGJhYmVsLXByZXNldC1hcHBcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKTsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIExJVkUyRENVQklTTUZSQU1FV09SSzsKCiAgKGZ1bmN0aW9uIChMSVZFMkRDVUJJU01GUkFNRVdPUkspIHsKICAgIHZhciBBbmltYXRpb25Qb2ludCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQW5pbWF0aW9uUG9pbnQodGltZSwgdmFsdWUpIHsKICAgICAgICB0aGlzLnRpbWUgPSB0aW1lOwogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIEFuaW1hdGlvblBvaW50OwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5BbmltYXRpb25Qb2ludCA9IEFuaW1hdGlvblBvaW50OwoKICAgIHZhciBBbmltYXRpb25Vc2VyRGF0YUJvZHkgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEFuaW1hdGlvblVzZXJEYXRhQm9keSh0aW1lLCB2YWx1ZSkgewogICAgICAgIHRoaXMudGltZSA9IHRpbWU7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICB9CgogICAgICA7CiAgICAgIHJldHVybiBBbmltYXRpb25Vc2VyRGF0YUJvZHk7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkFuaW1hdGlvblVzZXJEYXRhQm9keSA9IEFuaW1hdGlvblVzZXJEYXRhQm9keTsKCiAgICB2YXIgQnVpbHRpbkFuaW1hdGlvblNlZ21lbnRFdmFsdWF0b3JzID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBCdWlsdGluQW5pbWF0aW9uU2VnbWVudEV2YWx1YXRvcnMoKSB7fQoKICAgICAgQnVpbHRpbkFuaW1hdGlvblNlZ21lbnRFdmFsdWF0b3JzLmxlcnAgPSBmdW5jdGlvbiAoYSwgYiwgdCkgewogICAgICAgIHJldHVybiBuZXcgQW5pbWF0aW9uUG9pbnQoYS50aW1lICsgKGIudGltZSAtIGEudGltZSkgKiB0LCBhLnZhbHVlICsgKGIudmFsdWUgLSBhLnZhbHVlKSAqIHQpOwogICAgICB9OwoKICAgICAgQnVpbHRpbkFuaW1hdGlvblNlZ21lbnRFdmFsdWF0b3JzLkxJTkVBUiA9IGZ1bmN0aW9uIChwb2ludHMsIG9mZnNldCwgdGltZSkgewogICAgICAgIHZhciBwMCA9IHBvaW50c1tvZmZzZXQgKyAwXTsKICAgICAgICB2YXIgcDEgPSBwb2ludHNbb2Zmc2V0ICsgMV07CiAgICAgICAgdmFyIHQgPSAodGltZSAtIHAwLnRpbWUpIC8gKHAxLnRpbWUgLSBwMC50aW1lKTsKICAgICAgICByZXR1cm4gcDAudmFsdWUgKyAocDEudmFsdWUgLSBwMC52YWx1ZSkgKiB0OwogICAgICB9OwoKICAgICAgQnVpbHRpbkFuaW1hdGlvblNlZ21lbnRFdmFsdWF0b3JzLkJFWklFUiA9IGZ1bmN0aW9uIChwb2ludHMsIG9mZnNldCwgdGltZSkgewogICAgICAgIHZhciB0ID0gKHRpbWUgLSBwb2ludHNbb2Zmc2V0ICsgMF0udGltZSkgLyAocG9pbnRzW29mZnNldCArIDNdLnRpbWUgLSBwb2ludHNbb2Zmc2V0XS50aW1lKTsKICAgICAgICB2YXIgcDAxID0gQnVpbHRpbkFuaW1hdGlvblNlZ21lbnRFdmFsdWF0b3JzLmxlcnAocG9pbnRzW29mZnNldCArIDBdLCBwb2ludHNbb2Zmc2V0ICsgMV0sIHQpOwogICAgICAgIHZhciBwMTIgPSBCdWlsdGluQW5pbWF0aW9uU2VnbWVudEV2YWx1YXRvcnMubGVycChwb2ludHNbb2Zmc2V0ICsgMV0sIHBvaW50c1tvZmZzZXQgKyAyXSwgdCk7CiAgICAgICAgdmFyIHAyMyA9IEJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9ycy5sZXJwKHBvaW50c1tvZmZzZXQgKyAyXSwgcG9pbnRzW29mZnNldCArIDNdLCB0KTsKICAgICAgICB2YXIgcDAxMiA9IEJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9ycy5sZXJwKHAwMSwgcDEyLCB0KTsKICAgICAgICB2YXIgcDEyMyA9IEJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9ycy5sZXJwKHAxMiwgcDIzLCB0KTsKICAgICAgICByZXR1cm4gQnVpbHRpbkFuaW1hdGlvblNlZ21lbnRFdmFsdWF0b3JzLmxlcnAocDAxMiwgcDEyMywgdCkudmFsdWU7CiAgICAgIH07CgogICAgICBCdWlsdGluQW5pbWF0aW9uU2VnbWVudEV2YWx1YXRvcnMuU1RFUFBFRCA9IGZ1bmN0aW9uIChwb2ludHMsIG9mZnNldCwgdGltZSkgewogICAgICAgIHJldHVybiBwb2ludHNbb2Zmc2V0ICsgMF0udmFsdWU7CiAgICAgIH07CgogICAgICBCdWlsdGluQW5pbWF0aW9uU2VnbWVudEV2YWx1YXRvcnMuSU5WRVJTRV9TVEVQUEVEID0gZnVuY3Rpb24gKHBvaW50cywgb2Zmc2V0LCB0aW1lKSB7CiAgICAgICAgcmV0dXJuIHBvaW50c1tvZmZzZXQgKyAxXS52YWx1ZTsKICAgICAgfTsKCiAgICAgIHJldHVybiBCdWlsdGluQW5pbWF0aW9uU2VnbWVudEV2YWx1YXRvcnM7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9ycyA9IEJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9yczsKCiAgICB2YXIgQW5pbWF0aW9uU2VnbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQW5pbWF0aW9uU2VnbWVudChvZmZzZXQsIGV2YWx1YXRlKSB7CiAgICAgICAgdGhpcy5vZmZzZXQgPSBvZmZzZXQ7CiAgICAgICAgdGhpcy5ldmFsdWF0ZSA9IGV2YWx1YXRlOwogICAgICB9CgogICAgICByZXR1cm4gQW5pbWF0aW9uU2VnbWVudDsKICAgIH0oKTsKCiAgICBMSVZFMkRDVUJJU01GUkFNRVdPUksuQW5pbWF0aW9uU2VnbWVudCA9IEFuaW1hdGlvblNlZ21lbnQ7CgogICAgdmFyIEFuaW1hdGlvblRyYWNrID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBbmltYXRpb25UcmFjayh0YXJnZXRJZCwgcG9pbnRzLCBzZWdtZW50cykgewogICAgICAgIHRoaXMudGFyZ2V0SWQgPSB0YXJnZXRJZDsKICAgICAgICB0aGlzLnBvaW50cyA9IHBvaW50czsKICAgICAgICB0aGlzLnNlZ21lbnRzID0gc2VnbWVudHM7CiAgICAgIH0KCiAgICAgIEFuaW1hdGlvblRyYWNrLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uICh0aW1lKSB7CiAgICAgICAgdmFyIHMgPSAwOwogICAgICAgIHZhciBsYXN0UyA9IHRoaXMuc2VnbWVudHMubGVuZ3RoIC0gMTsKCiAgICAgICAgZm9yICg7IHMgPCBsYXN0UzsgKytzKSB7CiAgICAgICAgICBpZiAodGhpcy5wb2ludHNbdGhpcy5zZWdtZW50c1tzICsgMV0ub2Zmc2V0XS50aW1lIDwgdGltZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLnNlZ21lbnRzW3NdLmV2YWx1YXRlKHRoaXMucG9pbnRzLCB0aGlzLnNlZ21lbnRzW3NdLm9mZnNldCwgdGltZSk7CiAgICAgIH07CgogICAgICByZXR1cm4gQW5pbWF0aW9uVHJhY2s7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkFuaW1hdGlvblRyYWNrID0gQW5pbWF0aW9uVHJhY2s7CgogICAgdmFyIEFuaW1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQW5pbWF0aW9uKG1vdGlvbjNKc29uKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdGhpcy5tb2RlbFRyYWNrcyA9IFtdOwogICAgICAgIHRoaXMucGFyYW1ldGVyVHJhY2tzID0gW107CiAgICAgICAgdGhpcy5wYXJ0T3BhY2l0eVRyYWNrcyA9IFtdOwogICAgICAgIHRoaXMudXNlckRhdGFCb2R5cyA9IFtdOwogICAgICAgIHRoaXMuZHVyYXRpb24gPSBtb3Rpb24zSnNvbi5NZXRhLkR1cmF0aW9uOwogICAgICAgIHRoaXMuZnBzID0gbW90aW9uM0pzb24uTWV0YS5GcHM7CiAgICAgICAgdGhpcy5sb29wID0gbW90aW9uM0pzb24uTWV0YS5Mb29wOwogICAgICAgIHRoaXMudXNlckRhdGFDb3VudCA9IG1vdGlvbjNKc29uLk1ldGEuVXNlckRhdGFDb3VudDsKICAgICAgICB0aGlzLnRvdGFsVXNlckRhdGFTaXplID0gbW90aW9uM0pzb24uTWV0YS5Ub3RhbFVzZXJEYXRhU2l6ZTsKCiAgICAgICAgaWYgKG1vdGlvbjNKc29uLlVzZXJEYXRhICE9IG51bGwpIHsKICAgICAgICAgIG1vdGlvbjNKc29uLlVzZXJEYXRhLmZvckVhY2goZnVuY3Rpb24gKHUpIHsKICAgICAgICAgICAgX3RoaXMudXNlckRhdGFCb2R5cy5wdXNoKG5ldyBBbmltYXRpb25Vc2VyRGF0YUJvZHkodS5UaW1lLCB1LlZhbHVlKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnNvbGUuYXNzZXJ0KHRoaXMudXNlckRhdGFCb2R5cy5sZW5ndGggPT09IHRoaXMudXNlckRhdGFDb3VudCk7CiAgICAgICAgfQoKICAgICAgICBtb3Rpb24zSnNvbi5DdXJ2ZXMuZm9yRWFjaChmdW5jdGlvbiAoYykgewogICAgICAgICAgdmFyIHMgPSBjLlNlZ21lbnRzOwogICAgICAgICAgdmFyIHBvaW50cyA9IFtdOwogICAgICAgICAgdmFyIHNlZ21lbnRzID0gW107CiAgICAgICAgICBwb2ludHMucHVzaChuZXcgQW5pbWF0aW9uUG9pbnQoc1swXSwgc1sxXSkpOwoKICAgICAgICAgIGZvciAodmFyIHQgPSAyOyB0IDwgcy5sZW5ndGg7IHQgKz0gMykgewogICAgICAgICAgICB2YXIgb2Zmc2V0ID0gcG9pbnRzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgIHZhciBldmFsdWF0ZSA9IEJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9ycy5MSU5FQVI7CiAgICAgICAgICAgIHZhciB0eXBlID0gc1t0XTsKCiAgICAgICAgICAgIGlmICh0eXBlID09PSAxKSB7CiAgICAgICAgICAgICAgZXZhbHVhdGUgPSBCdWlsdGluQW5pbWF0aW9uU2VnbWVudEV2YWx1YXRvcnMuQkVaSUVSOwogICAgICAgICAgICAgIHBvaW50cy5wdXNoKG5ldyBBbmltYXRpb25Qb2ludChzW3QgKyAxXSwgc1t0ICsgMl0pKTsKICAgICAgICAgICAgICBwb2ludHMucHVzaChuZXcgQW5pbWF0aW9uUG9pbnQoc1t0ICsgM10sIHNbdCArIDRdKSk7CiAgICAgICAgICAgICAgdCArPSA0OwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICBldmFsdWF0ZSA9IEJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9ycy5TVEVQUEVEOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICBldmFsdWF0ZSA9IEJ1aWx0aW5BbmltYXRpb25TZWdtZW50RXZhbHVhdG9ycy5JTlZFUlNFX1NURVBQRUQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSAhPT0gMCkge30KCiAgICAgICAgICAgIHBvaW50cy5wdXNoKG5ldyBBbmltYXRpb25Qb2ludChzW3QgKyAxXSwgc1t0ICsgMl0pKTsKICAgICAgICAgICAgc2VnbWVudHMucHVzaChuZXcgQW5pbWF0aW9uU2VnbWVudChvZmZzZXQsIGV2YWx1YXRlKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRyYWNrID0gbmV3IEFuaW1hdGlvblRyYWNrKGMuSWQsIHBvaW50cywgc2VnbWVudHMpOwoKICAgICAgICAgIGlmIChjLlRhcmdldCA9PT0gJ01vZGVsJykgewogICAgICAgICAgICBfdGhpcy5tb2RlbFRyYWNrcy5wdXNoKHRyYWNrKTsKICAgICAgICAgIH0gZWxzZSBpZiAoYy5UYXJnZXQgPT09ICdQYXJhbWV0ZXInKSB7CiAgICAgICAgICAgIF90aGlzLnBhcmFtZXRlclRyYWNrcy5wdXNoKHRyYWNrKTsKICAgICAgICAgIH0gZWxzZSBpZiAoYy5UYXJnZXQgPT09ICdQYXJ0T3BhY2l0eScpIHsKICAgICAgICAgICAgX3RoaXMucGFydE9wYWNpdHlUcmFja3MucHVzaCh0cmFjayk7CiAgICAgICAgICB9IGVsc2Uge30KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgQW5pbWF0aW9uLmZyb21Nb3Rpb24zSnNvbiA9IGZ1bmN0aW9uIChtb3Rpb24zSnNvbikgewogICAgICAgIGlmIChtb3Rpb24zSnNvbiA9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHZhciBhbmltYXRpb24gPSBuZXcgQW5pbWF0aW9uKG1vdGlvbjNKc29uKTsKICAgICAgICByZXR1cm4gYW5pbWF0aW9uLmlzVmFsaWQgPyBhbmltYXRpb24gOiBudWxsOwogICAgICB9OwoKICAgICAgQW5pbWF0aW9uLnByb3RvdHlwZS5hZGRBbmltYXRpb25DYWxsYmFjayA9IGZ1bmN0aW9uIChjYWxsYmFja0Z1bmMpIHsKICAgICAgICBpZiAodGhpcy5fY2FsbGJhY2tGdW5jdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgdGhpcy5fY2FsbGJhY2tGdW5jdGlvbnMgPSBbXTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2NhbGxiYWNrRnVuY3Rpb25zLnB1c2goY2FsbGJhY2tGdW5jKTsKICAgICAgfTsKCiAgICAgIEFuaW1hdGlvbi5wcm90b3R5cGUucmVtb3ZlQW5pbWF0aW9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAoY2FsbGJhY2tGdW5jKSB7CiAgICAgICAgaWYgKHRoaXMuX2NhbGxiYWNrRnVuY3Rpb25zICE9IG51bGwpIHsKICAgICAgICAgIHZhciBfdGFyZ2V0ID0gLTE7CgogICAgICAgICAgZm9yICh2YXIgX2luZGV4ID0gMDsgX2luZGV4IDwgdGhpcy5fY2FsbGJhY2tGdW5jdGlvbnMubGVuZ3RoOyBfaW5kZXgrKykgewogICAgICAgICAgICBpZiAodGhpcy5fY2FsbGJhY2tGdW5jdGlvbnNbX2luZGV4XSA9PT0gY2FsbGJhY2tGdW5jKSB7CiAgICAgICAgICAgICAgX3RhcmdldCA9IF9pbmRleDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGFyZ2V0ID49IDApIHsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tGdW5jdGlvbnMuc3BsaWNlKF90YXJnZXQsIDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIEFuaW1hdGlvbi5wcm90b3R5cGUuY2xlYXJBbmltYXRpb25DYWxsYmFjayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9jYWxsYmFja0Z1bmN0aW9ucyA9IFtdOwogICAgICB9OwoKICAgICAgQW5pbWF0aW9uLnByb3RvdHlwZS5jYWxsQW5pbWF0aW9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBpZiAodGhpcy5fY2FsbGJhY2tGdW5jdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgdGhpcy5fY2FsbGJhY2tGdW5jdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoZnVuYykgewogICAgICAgICAgICBmdW5jKHZhbHVlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIEFuaW1hdGlvbi5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiAodGltZSwgd2VpZ2h0LCBibGVuZCwgdGFyZ2V0LCBzdGFja0ZsYWdzLCBncm91cHMpIHsKICAgICAgICBpZiAoZ3JvdXBzID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGdyb3VwcyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAod2VpZ2h0IDw9IDAuMDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmxvb3ApIHsKICAgICAgICAgIHdoaWxlICh0aW1lID4gdGhpcy5kdXJhdGlvbikgewogICAgICAgICAgICB0aW1lIC09IHRoaXMuZHVyYXRpb247CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhcmFtZXRlclRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgcCA9IHRhcmdldC5wYXJhbWV0ZXJzLmlkcy5pbmRleE9mKHQudGFyZ2V0SWQpOwoKICAgICAgICAgIGlmIChwID49IDApIHsKICAgICAgICAgICAgdmFyIHNhbXBsZSA9IHQuZXZhbHVhdGUodGltZSk7CgogICAgICAgICAgICBpZiAoc3RhY2tGbGFnc1swXVtwXSAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgIHRhcmdldC5wYXJhbWV0ZXJzLnZhbHVlc1twXSA9IHRhcmdldC5wYXJhbWV0ZXJzLmRlZmF1bHRWYWx1ZXNbcF07CiAgICAgICAgICAgICAgc3RhY2tGbGFnc1swXVtwXSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhcmdldC5wYXJhbWV0ZXJzLnZhbHVlc1twXSA9IGJsZW5kKHRhcmdldC5wYXJhbWV0ZXJzLnZhbHVlc1twXSwgc2FtcGxlLCB0LmV2YWx1YXRlKDApLCB3ZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucGFydE9wYWNpdHlUcmFja3MuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIHAgPSB0YXJnZXQucGFydHMuaWRzLmluZGV4T2YodC50YXJnZXRJZCk7CgogICAgICAgICAgaWYgKHAgPj0gMCkgewogICAgICAgICAgICB2YXIgc2FtcGxlID0gdC5ldmFsdWF0ZSh0aW1lKTsKCiAgICAgICAgICAgIGlmIChzdGFja0ZsYWdzWzFdW3BdICE9PSB0cnVlKSB7CiAgICAgICAgICAgICAgdGFyZ2V0LnBhcnRzLm9wYWNpdGllc1twXSA9IDE7CiAgICAgICAgICAgICAgc3RhY2tGbGFnc1sxXVtwXSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhcmdldC5wYXJ0cy5vcGFjaXRpZXNbcF0gPSBibGVuZCh0YXJnZXQucGFydHMub3BhY2l0aWVzW3BdLCBzYW1wbGUsIHQuZXZhbHVhdGUoMCksIHdlaWdodCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5tb2RlbFRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBpZiAoZ3JvdXBzICE9IG51bGwpIHsKICAgICAgICAgICAgdmFyIGcgPSBncm91cHMuZ2V0R3JvdXBCeUlkKHQudGFyZ2V0SWQpOwoKICAgICAgICAgICAgaWYgKGcgIT0gbnVsbCAmJiBnLnRhcmdldCA9PT0gJ1BhcmFtZXRlcicpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gZy5pZHM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgdGlkID0gX2FbX2ldOwogICAgICAgICAgICAgICAgdmFyIHAgPSB0YXJnZXQucGFyYW1ldGVycy5pZHMuaW5kZXhPZih0aWQpOwoKICAgICAgICAgICAgICAgIGlmIChwID49IDApIHsKICAgICAgICAgICAgICAgICAgdmFyIHNhbXBsZSA9IHQuZXZhbHVhdGUodGltZSk7CgogICAgICAgICAgICAgICAgICBpZiAoc3RhY2tGbGFnc1swXVtwXSAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldC5wYXJhbWV0ZXJzLnZhbHVlc1twXSA9IHRhcmdldC5wYXJhbWV0ZXJzLmRlZmF1bHRWYWx1ZXNbcF07CiAgICAgICAgICAgICAgICAgICAgc3RhY2tGbGFnc1swXVtwXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHRhcmdldC5wYXJhbWV0ZXJzLnZhbHVlc1twXSA9IGJsZW5kKHRhcmdldC5wYXJhbWV0ZXJzLnZhbHVlc1twXSwgc2FtcGxlLCB0LmV2YWx1YXRlKDApLCB3ZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAodGhpcy5fY2FsbGJhY2tGdW5jdGlvbnMgIT0gbnVsbCkgewogICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMudXNlckRhdGFCb2R5czsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIHVkID0gX2FbX2ldOwoKICAgICAgICAgICAgaWYgKHRoaXMuaXNFdmVudFRyaWdnZXJlZCh1ZC50aW1lLCB0aW1lLCB0aGlzLl9sYXN0VGltZSwgdGhpcy5kdXJhdGlvbikpIHsKICAgICAgICAgICAgICB0aGlzLmNhbGxBbmltYXRpb25DYWxsYmFjayh1ZC52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX2xhc3RUaW1lID0gdGltZTsKICAgICAgfTsKCiAgICAgIEFuaW1hdGlvbi5wcm90b3R5cGUuaXNFdmVudFRyaWdnZXJlZCA9IGZ1bmN0aW9uICh0aW1lRXZhbHVhdGUsIHRpbWVGb3J3YXJkLCB0aW1lQmFjaywgZHVyYXRpb24pIHsKICAgICAgICBpZiAodGltZUZvcndhcmQgPiB0aW1lQmFjaykgewogICAgICAgICAgaWYgKHRpbWVFdmFsdWF0ZSA+IHRpbWVCYWNrICYmIHRpbWVFdmFsdWF0ZSA8IHRpbWVGb3J3YXJkKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGltZUV2YWx1YXRlID4gMCAmJiB0aW1lRXZhbHVhdGUgPCB0aW1lRm9yd2FyZCB8fCB0aW1lRXZhbHVhdGUgPiB0aW1lQmFjayAmJiB0aW1lRXZhbHVhdGUgPCBkdXJhdGlvbikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfTsKCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbmltYXRpb24ucHJvdG90eXBlLCAnaXNWYWxpZCcsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybiBBbmltYXRpb247CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkFuaW1hdGlvbiA9IEFuaW1hdGlvbjsKCiAgICB2YXIgQnVpbHRpbkNyb3NzZmFkZVdlaWdodGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQnVpbHRpbkNyb3NzZmFkZVdlaWdodGVycygpIHt9CgogICAgICBCdWlsdGluQ3Jvc3NmYWRlV2VpZ2h0ZXJzLkxJTkVBUiA9IGZ1bmN0aW9uICh0aW1lLCBkdXJhdGlvbikgewogICAgICAgIHJldHVybiB0aW1lIC8gZHVyYXRpb247CiAgICAgIH07CgogICAgICByZXR1cm4gQnVpbHRpbkNyb3NzZmFkZVdlaWdodGVyczsKICAgIH0oKTsKCiAgICBMSVZFMkRDVUJJU01GUkFNRVdPUksuQnVpbHRpbkNyb3NzZmFkZVdlaWdodGVycyA9IEJ1aWx0aW5Dcm9zc2ZhZGVXZWlnaHRlcnM7CgogICAgdmFyIEFuaW1hdGlvblN0YXRlID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBbmltYXRpb25TdGF0ZSgpIHt9CgogICAgICByZXR1cm4gQW5pbWF0aW9uU3RhdGU7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkFuaW1hdGlvblN0YXRlID0gQW5pbWF0aW9uU3RhdGU7CgogICAgdmFyIEJ1aWx0aW5BbmltYXRpb25CbGVuZGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQnVpbHRpbkFuaW1hdGlvbkJsZW5kZXJzKCkge30KCiAgICAgIEJ1aWx0aW5BbmltYXRpb25CbGVuZGVycy5PVkVSUklERSA9IGZ1bmN0aW9uIChzb3VyY2UsIGRlc3RpbmF0aW9uLCBpbml0aWFsLCB3ZWlnaHQpIHsKICAgICAgICByZXR1cm4gZGVzdGluYXRpb24gKiB3ZWlnaHQgKyBzb3VyY2UgKiAoMSAtIHdlaWdodCk7CiAgICAgIH07CgogICAgICBCdWlsdGluQW5pbWF0aW9uQmxlbmRlcnMuQUREID0gZnVuY3Rpb24gKHNvdXJjZSwgZGVzdGluYXRpb24sIGluaXRpYWwsIHdlaWdodCkgewogICAgICAgIHJldHVybiBzb3VyY2UgKyAoZGVzdGluYXRpb24gLSBpbml0aWFsKSAqIHdlaWdodDsKICAgICAgfTsKCiAgICAgIEJ1aWx0aW5BbmltYXRpb25CbGVuZGVycy5NVUxUSVBMWSA9IGZ1bmN0aW9uIChzb3VyY2UsIGRlc3RpbmF0aW9uLCB3ZWlnaHQpIHsKICAgICAgICByZXR1cm4gc291cmNlICogKDEgKyAoZGVzdGluYXRpb24gLSAxKSAqIHdlaWdodCk7CiAgICAgIH07CgogICAgICByZXR1cm4gQnVpbHRpbkFuaW1hdGlvbkJsZW5kZXJzOwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5CdWlsdGluQW5pbWF0aW9uQmxlbmRlcnMgPSBCdWlsdGluQW5pbWF0aW9uQmxlbmRlcnM7CgogICAgdmFyIEFuaW1hdGlvbkxheWVyID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBbmltYXRpb25MYXllcigpIHsKICAgICAgICB0aGlzLndlaWdodCA9IDE7CiAgICAgIH0KCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbmltYXRpb25MYXllci5wcm90b3R5cGUsICdjdXJyZW50QW5pbWF0aW9uJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvbjsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQW5pbWF0aW9uTGF5ZXIucHJvdG90eXBlLCAnY3VycmVudFRpbWUnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZTsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CiAgICAgICAgICB0aGlzLl90aW1lID0gdmFsdWU7CiAgICAgICAgfSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFuaW1hdGlvbkxheWVyLnByb3RvdHlwZSwgJ2lzUGxheWluZycsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wbGF5OwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CgogICAgICBBbmltYXRpb25MYXllci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uIChhbmltYXRpb24sIGZhZGVEdXJhdGlvbikgewogICAgICAgIGlmIChmYWRlRHVyYXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZmFkZUR1cmF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLl9hbmltYXRpb24gJiYgZmFkZUR1cmF0aW9uID4gMCkgewogICAgICAgICAgdGhpcy5fZ29hbEFuaW1hdGlvbiA9IGFuaW1hdGlvbjsKICAgICAgICAgIHRoaXMuX2dvYWxUaW1lID0gMDsKICAgICAgICAgIHRoaXMuX2ZhZGVUaW1lID0gMDsKICAgICAgICAgIHRoaXMuX2ZhZGVEdXJhdGlvbiA9IGZhZGVEdXJhdGlvbjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5fYW5pbWF0aW9uID0gYW5pbWF0aW9uOwogICAgICAgICAgdGhpcy5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgICB0aGlzLl9wbGF5ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBBbmltYXRpb25MYXllci5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX3BsYXkgPSB0cnVlOwogICAgICB9OwoKICAgICAgQW5pbWF0aW9uTGF5ZXIucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX3BsYXkgPSBmYWxzZTsKICAgICAgfTsKCiAgICAgIEFuaW1hdGlvbkxheWVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX3BsYXkgPSBmYWxzZTsKICAgICAgICB0aGlzLmN1cnJlbnRUaW1lID0gMDsKICAgICAgfTsKCiAgICAgIEFuaW1hdGlvbkxheWVyLnByb3RvdHlwZS5fdXBkYXRlID0gZnVuY3Rpb24gKGRlbHRhVGltZSkgewogICAgICAgIGlmICghdGhpcy5fcGxheSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fdGltZSArPSBkZWx0YVRpbWU7CiAgICAgICAgdGhpcy5fZ29hbFRpbWUgKz0gZGVsdGFUaW1lOwogICAgICAgIHRoaXMuX2ZhZGVUaW1lICs9IGRlbHRhVGltZTsKCiAgICAgICAgaWYgKHRoaXMuX2FuaW1hdGlvbiA9PSBudWxsIHx8ICF0aGlzLl9hbmltYXRpb24ubG9vcCAmJiB0aGlzLl90aW1lID4gdGhpcy5fYW5pbWF0aW9uLmR1cmF0aW9uKSB7CiAgICAgICAgICB0aGlzLnN0b3AoKTsKICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IG51bGw7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgQW5pbWF0aW9uTGF5ZXIucHJvdG90eXBlLl9ldmFsdWF0ZSA9IGZ1bmN0aW9uICh0YXJnZXQsIHN0YWNrRmxhZ3MpIHsKICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9uID09IG51bGwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB3ZWlnaHQgPSB0aGlzLndlaWdodCA8IDEgPyB0aGlzLndlaWdodCA6IDE7CiAgICAgICAgdmFyIGFuaW1hdGlvbldlaWdodCA9IHRoaXMuX2dvYWxBbmltYXRpb24gIT0gbnVsbCA/IHdlaWdodCAqIHRoaXMud2VpZ2h0Q3Jvc3NmYWRlKHRoaXMuX2ZhZGVUaW1lLCB0aGlzLl9mYWRlRHVyYXRpb24pIDogd2VpZ2h0OwoKICAgICAgICB0aGlzLl9hbmltYXRpb24uZXZhbHVhdGUodGhpcy5fdGltZSwgYW5pbWF0aW9uV2VpZ2h0LCB0aGlzLmJsZW5kLCB0YXJnZXQsIHN0YWNrRmxhZ3MsIHRoaXMuZ3JvdXBzKTsKCiAgICAgICAgaWYgKHRoaXMuX2dvYWxBbmltYXRpb24gIT0gbnVsbCkgewogICAgICAgICAgYW5pbWF0aW9uV2VpZ2h0ID0gMSAtIHdlaWdodCAqIHRoaXMud2VpZ2h0Q3Jvc3NmYWRlKHRoaXMuX2ZhZGVUaW1lLCB0aGlzLl9mYWRlRHVyYXRpb24pOwoKICAgICAgICAgIHRoaXMuX2dvYWxBbmltYXRpb24uZXZhbHVhdGUodGhpcy5fZ29hbFRpbWUsIGFuaW1hdGlvbldlaWdodCwgdGhpcy5ibGVuZCwgdGFyZ2V0LCBzdGFja0ZsYWdzLCB0aGlzLmdyb3Vwcyk7CgogICAgICAgICAgaWYgKHRoaXMuX2ZhZGVUaW1lID4gdGhpcy5fZmFkZUR1cmF0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IHRoaXMuX2dvYWxBbmltYXRpb247CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSB0aGlzLl9nb2FsVGltZTsKICAgICAgICAgICAgdGhpcy5fZ29hbEFuaW1hdGlvbiA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgcmV0dXJuIEFuaW1hdGlvbkxheWVyOwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5BbmltYXRpb25MYXllciA9IEFuaW1hdGlvbkxheWVyOwoKICAgIHZhciBBbmltYXRvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQW5pbWF0b3IodGFyZ2V0LCB0aW1lU2NhbGUsIGxheWVycykgewogICAgICAgIHRoaXMuX3RhcmdldCA9IHRhcmdldDsKICAgICAgICB0aGlzLnRpbWVTY2FsZSA9IHRpbWVTY2FsZTsKICAgICAgICB0aGlzLl9sYXllcnMgPSBsYXllcnM7CiAgICAgIH0KCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbmltYXRvci5wcm90b3R5cGUsICd0YXJnZXQnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0OwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbmltYXRvci5wcm90b3R5cGUsICdpc1BsYXlpbmcnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgcmV0ID0gZmFsc2U7CgogICAgICAgICAgdGhpcy5fbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgaWYgKGwuaXNQbGF5aW5nKSB7CiAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgQW5pbWF0b3IucHJvdG90eXBlLmFkZExheWVyID0gZnVuY3Rpb24gKG5hbWUsIGJsZW5kZXIsIHdlaWdodCkgewogICAgICAgIGlmIChibGVuZGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGJsZW5kZXIgPSBCdWlsdGluQW5pbWF0aW9uQmxlbmRlcnMuT1ZFUlJJREU7CiAgICAgICAgfQoKICAgICAgICBpZiAod2VpZ2h0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHdlaWdodCA9IDE7CiAgICAgICAgfQoKICAgICAgICB2YXIgbGF5ZXIgPSBuZXcgQW5pbWF0aW9uTGF5ZXIoKTsKICAgICAgICBsYXllci5ibGVuZCA9IGJsZW5kZXI7CiAgICAgICAgbGF5ZXIud2VpZ2h0Q3Jvc3NmYWRlID0gQnVpbHRpbkNyb3NzZmFkZVdlaWdodGVycy5MSU5FQVI7CiAgICAgICAgbGF5ZXIud2VpZ2h0ID0gd2VpZ2h0OwogICAgICAgIGxheWVyLmdyb3VwcyA9IHRoaXMuZ3JvdXBzOwoKICAgICAgICB0aGlzLl9sYXllcnMuc2V0KG5hbWUsIGxheWVyKTsKICAgICAgfTsKCiAgICAgIEFuaW1hdG9yLnByb3RvdHlwZS5nZXRMYXllciA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xheWVycy5oYXMobmFtZSkgPyB0aGlzLl9sYXllcnMuZ2V0KG5hbWUpIDogbnVsbDsKICAgICAgfTsKCiAgICAgIEFuaW1hdG9yLnByb3RvdHlwZS5yZW1vdmVMYXllciA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xheWVycy5oYXMobmFtZSkgPyB0aGlzLl9sYXllcnNbImRlbGV0ZSJdKG5hbWUpIDogbnVsbDsKICAgICAgfTsKCiAgICAgIEFuaW1hdG9yLnByb3RvdHlwZS5jbGVhckxheWVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9sYXllcnMuY2xlYXIoKTsKICAgICAgfTsKCiAgICAgIEFuaW1hdG9yLnByb3RvdHlwZS51cGRhdGVBbmRFdmFsdWF0ZSA9IGZ1bmN0aW9uIChkZWx0YVRpbWUpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICBkZWx0YVRpbWUgKj0gdGhpcy50aW1lU2NhbGUgPiAwID8gdGhpcy50aW1lU2NhbGUgOiAwOwoKICAgICAgICBpZiAoZGVsdGFUaW1lID4gMC4wMDEpIHsKICAgICAgICAgIHRoaXMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7CiAgICAgICAgICAgIGwuX3VwZGF0ZShkZWx0YVRpbWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFyYW1TdGFja0ZsYWdzID0gbmV3IEFycmF5KHRoaXMuX3RhcmdldC5wYXJhbWV0ZXJzLmNvdW50KS5maWxsKGZhbHNlKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1hcnJheS1jb25zdHJ1Y3RvcgoKICAgICAgICB2YXIgcGFydHNTdGFja0ZsYWdzID0gbmV3IEFycmF5KHRoaXMuX3RhcmdldC5wYXJ0cy5jb3VudCkuZmlsbChmYWxzZSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tYXJyYXktY29uc3RydWN0b3IKCiAgICAgICAgdmFyIHN0YWNrRmxhZ3MgPSBuZXcgQXJyYXkocGFyYW1TdGFja0ZsYWdzLCBwYXJ0c1N0YWNrRmxhZ3MpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWFycmF5LWNvbnN0cnVjdG9yCgogICAgICAgIHRoaXMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7CiAgICAgICAgICBsLl9ldmFsdWF0ZShfdGhpcy5fdGFyZ2V0LCBzdGFja0ZsYWdzKTsKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIEFuaW1hdG9yLl9jcmVhdGUgPSBmdW5jdGlvbiAodGFyZ2V0LCB0aW1lU2NhbGUsIGxheWVycykgewogICAgICAgIHZhciBhbmltYXRvciA9IG5ldyBBbmltYXRvcih0YXJnZXQsIHRpbWVTY2FsZSwgbGF5ZXJzKTsKICAgICAgICByZXR1cm4gYW5pbWF0b3IuaXNWYWxpZCA/IGFuaW1hdG9yIDogbnVsbDsKICAgICAgfTsKCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbmltYXRvci5wcm90b3R5cGUsICdpc1ZhbGlkJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldCAhPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybiBBbmltYXRvcjsKICAgIH0oKTsKCiAgICBMSVZFMkRDVUJJU01GUkFNRVdPUksuQW5pbWF0b3IgPSBBbmltYXRvcjsKCiAgICB2YXIgQW5pbWF0b3JCdWlsZGVyID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBbmltYXRvckJ1aWxkZXIoKSB7CiAgICAgICAgdGhpcy5fdGltZVNjYWxlID0gMTsKICAgICAgICB0aGlzLl9sYXllck5hbWVzID0gW107CiAgICAgICAgdGhpcy5fbGF5ZXJCbGVuZGVycyA9IFtdOwogICAgICAgIHRoaXMuX2xheWVyQ3Jvc3NmYWRlV2VpZ2h0ZXJzID0gW107CiAgICAgICAgdGhpcy5fbGF5ZXJXZWlnaHRzID0gW107CiAgICAgIH0KCiAgICAgIEFuaW1hdG9yQnVpbGRlci5wcm90b3R5cGUuc2V0VGFyZ2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CgogICAgICBBbmltYXRvckJ1aWxkZXIucHJvdG90eXBlLnNldFRpbWVTY2FsZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHRoaXMuX3RpbWVTY2FsZSA9IHZhbHVlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwoKICAgICAgQW5pbWF0b3JCdWlsZGVyLnByb3RvdHlwZS5hZGRMYXllciA9IGZ1bmN0aW9uIChuYW1lLCBibGVuZGVyLCB3ZWlnaHQpIHsKICAgICAgICBpZiAoYmxlbmRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBibGVuZGVyID0gQnVpbHRpbkFuaW1hdGlvbkJsZW5kZXJzLk9WRVJSSURFOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdlaWdodCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB3ZWlnaHQgPSAxOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fbGF5ZXJOYW1lcy5wdXNoKG5hbWUpOwoKICAgICAgICB0aGlzLl9sYXllckJsZW5kZXJzLnB1c2goYmxlbmRlcik7CgogICAgICAgIHRoaXMuX2xheWVyQ3Jvc3NmYWRlV2VpZ2h0ZXJzLnB1c2goQnVpbHRpbkNyb3NzZmFkZVdlaWdodGVycy5MSU5FQVIpOwoKICAgICAgICB0aGlzLl9sYXllcldlaWdodHMucHVzaCh3ZWlnaHQpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKCiAgICAgIEFuaW1hdG9yQnVpbGRlci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxheWVycyA9IG5ldyBNYXAoKTsKCiAgICAgICAgZm9yICh2YXIgbCA9IDA7IGwgPCB0aGlzLl9sYXllck5hbWVzLmxlbmd0aDsgKytsKSB7CiAgICAgICAgICB2YXIgbGF5ZXIgPSBuZXcgQW5pbWF0aW9uTGF5ZXIoKTsKICAgICAgICAgIGxheWVyLmJsZW5kID0gdGhpcy5fbGF5ZXJCbGVuZGVyc1tsXTsKICAgICAgICAgIGxheWVyLndlaWdodENyb3NzZmFkZSA9IHRoaXMuX2xheWVyQ3Jvc3NmYWRlV2VpZ2h0ZXJzW2xdOwogICAgICAgICAgbGF5ZXIud2VpZ2h0ID0gdGhpcy5fbGF5ZXJXZWlnaHRzW2xdOwogICAgICAgICAgbGF5ZXJzLnNldCh0aGlzLl9sYXllck5hbWVzW2xdLCBsYXllcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gQW5pbWF0b3IuX2NyZWF0ZSh0aGlzLl90YXJnZXQsIHRoaXMuX3RpbWVTY2FsZSwgbGF5ZXJzKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBBbmltYXRvckJ1aWxkZXI7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkFuaW1hdG9yQnVpbGRlciA9IEFuaW1hdG9yQnVpbGRlcjsKCiAgICB2YXIgUGh5c2ljc1ZlY3RvcjIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBoeXNpY3NWZWN0b3IyKHgsIHkpIHsKICAgICAgICB0aGlzLnggPSB4OwogICAgICAgIHRoaXMueSA9IHk7CiAgICAgIH0KCiAgICAgIFBoeXNpY3NWZWN0b3IyLmRpc3RhbmNlID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gTWF0aC5hYnMoYS5zdWJzdHJhY3QoYikubGVuZ3RoKTsKICAgICAgfTsKCiAgICAgIFBoeXNpY3NWZWN0b3IyLmRvdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEueCAqIGIueCArIGEueSAqIGIueTsKICAgICAgfTsKCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQaHlzaWNzVmVjdG9yMi5wcm90b3R5cGUsICdsZW5ndGgnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KFBoeXNpY3NWZWN0b3IyLmRvdCh0aGlzLCB0aGlzKSk7CiAgICAgICAgfSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKCiAgICAgIFBoeXNpY3NWZWN0b3IyLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAodmVjdG9yMikgewogICAgICAgIHJldHVybiBuZXcgUGh5c2ljc1ZlY3RvcjIodGhpcy54ICsgdmVjdG9yMi54LCB0aGlzLnkgKyB2ZWN0b3IyLnkpOwogICAgICB9OwoKICAgICAgUGh5c2ljc1ZlY3RvcjIucHJvdG90eXBlLnN1YnN0cmFjdCA9IGZ1bmN0aW9uICh2ZWN0b3IyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQaHlzaWNzVmVjdG9yMih0aGlzLnggLSB2ZWN0b3IyLngsIHRoaXMueSAtIHZlY3RvcjIueSk7CiAgICAgIH07CgogICAgICBQaHlzaWNzVmVjdG9yMi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAodmVjdG9yMikgewogICAgICAgIHJldHVybiBuZXcgUGh5c2ljc1ZlY3RvcjIodGhpcy54ICogdmVjdG9yMi54LCB0aGlzLnkgKiB2ZWN0b3IyLnkpOwogICAgICB9OwoKICAgICAgUGh5c2ljc1ZlY3RvcjIucHJvdG90eXBlLm11bHRpcGx5QnlTY2FsYXIgPSBmdW5jdGlvbiAoc2NhbGFyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXVsdGlwbHkobmV3IFBoeXNpY3NWZWN0b3IyKHNjYWxhciwgc2NhbGFyKSk7CiAgICAgIH07CgogICAgICBQaHlzaWNzVmVjdG9yMi5wcm90b3R5cGUuZGl2aWRlID0gZnVuY3Rpb24gKHZlY3RvcjIpIHsKICAgICAgICByZXR1cm4gbmV3IFBoeXNpY3NWZWN0b3IyKHRoaXMueCAvIHZlY3RvcjIueCwgdGhpcy55IC8gdmVjdG9yMi55KTsKICAgICAgfTsKCiAgICAgIFBoeXNpY3NWZWN0b3IyLnByb3RvdHlwZS5kaXZpZGVCeVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5kaXZpZGUobmV3IFBoeXNpY3NWZWN0b3IyKHNjYWxhciwgc2NhbGFyKSk7CiAgICAgIH07CgogICAgICBQaHlzaWNzVmVjdG9yMi5wcm90b3R5cGUucm90YXRlQnlSYWRpYW5zID0gZnVuY3Rpb24gKHJhZGlhbnMpIHsKICAgICAgICB2YXIgeCA9IHRoaXMueCAqIE1hdGguY29zKHJhZGlhbnMpIC0gdGhpcy55ICogTWF0aC5zaW4ocmFkaWFucyk7CiAgICAgICAgdmFyIHkgPSB0aGlzLnggKiBNYXRoLnNpbihyYWRpYW5zKSArIHRoaXMueSAqIE1hdGguY29zKHJhZGlhbnMpOwogICAgICAgIHJldHVybiBuZXcgUGh5c2ljc1ZlY3RvcjIoeCwgeSk7CiAgICAgIH07CgogICAgICBQaHlzaWNzVmVjdG9yMi5wcm90b3R5cGUubm9ybWFsaXplID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgICAgICB2YXIgeCA9IHRoaXMueCAvIGxlbmd0aDsKICAgICAgICB2YXIgeSA9IHRoaXMueSAvIGxlbmd0aDsKICAgICAgICByZXR1cm4gbmV3IFBoeXNpY3NWZWN0b3IyKHgsIHkpOwogICAgICB9OwoKICAgICAgUGh5c2ljc1ZlY3RvcjIuemVybyA9IG5ldyBQaHlzaWNzVmVjdG9yMigwLCAwKTsKICAgICAgcmV0dXJuIFBoeXNpY3NWZWN0b3IyOwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5QaHlzaWNzVmVjdG9yMiA9IFBoeXNpY3NWZWN0b3IyOwoKICAgIHZhciBQaHlzaWNzID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQaHlzaWNzKCkge30KCiAgICAgIFBoeXNpY3MuY2xhbXBTY2FsYXIgPSBmdW5jdGlvbiAoc2NhbGFyLCBsb3dlciwgdXBwZXIpIHsKICAgICAgICBpZiAoc2NhbGFyIDwgbG93ZXIpIHsKICAgICAgICAgIHJldHVybiBsb3dlcjsKICAgICAgICB9CgogICAgICAgIGlmIChzY2FsYXIgPiB1cHBlcikgewogICAgICAgICAgcmV0dXJuIHVwcGVyOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNjYWxhcjsKICAgICAgfTsKCiAgICAgIFBoeXNpY3MuZGlyZWN0aW9uVG9EZWdyZWVzID0gZnVuY3Rpb24gKGZyb20sIHRvKSB7CiAgICAgICAgdmFyIHJhZGlhbnMgPSBQaHlzaWNzLmRpcmVjdGlvblRvUmFkaWFucyhmcm9tLCB0byk7CiAgICAgICAgdmFyIGRlZ3JlZXMgPSBQaHlzaWNzLnJhZGlhbnNUb0RlZ3JlZXMocmFkaWFucyk7CiAgICAgICAgcmV0dXJuIHRvLnggLSBmcm9tLnggPiAwID8gLWRlZ3JlZXMgOiBkZWdyZWVzOwogICAgICB9OwoKICAgICAgUGh5c2ljcy5yYWRpYW5zVG9EZWdyZWVzID0gZnVuY3Rpb24gKHJhZGlhbnMpIHsKICAgICAgICByZXR1cm4gcmFkaWFucyAqIDE4MCAvIE1hdGguUEk7CiAgICAgIH07CgogICAgICBQaHlzaWNzLnJhZGlhbnNUb0RpcmVjdGlvbiA9IGZ1bmN0aW9uIChyYWRpYW5zKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQaHlzaWNzVmVjdG9yMihNYXRoLnNpbihyYWRpYW5zKSwgTWF0aC5jb3MocmFkaWFucykpOwogICAgICB9OwoKICAgICAgUGh5c2ljcy5kZWdyZWVzVG9SYWRpYW5zID0gZnVuY3Rpb24gKGRlZ3JlZXMpIHsKICAgICAgICByZXR1cm4gZGVncmVlcyAvIDE4MCAqIE1hdGguUEk7CiAgICAgIH07CgogICAgICBQaHlzaWNzLmRpcmVjdGlvblRvUmFkaWFucyA9IGZ1bmN0aW9uIChmcm9tLCB0bykgewogICAgICAgIHZhciBkb3QgPSBQaHlzaWNzVmVjdG9yMi5kb3QoZnJvbSwgdG8pOwogICAgICAgIHZhciBtYWduaXR1ZGUgPSBmcm9tLmxlbmd0aCAqIHRvLmxlbmd0aDsKCiAgICAgICAgaWYgKG1hZ25pdHVkZSA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29zVGhldGEgPSBkb3QgLyBtYWduaXR1ZGU7CiAgICAgICAgcmV0dXJuIE1hdGguYWJzKGNvc1RoZXRhKSA8PSAxLjAgPyBNYXRoLmFjb3MoY29zVGhldGEpIDogMDsKICAgICAgfTsKCiAgICAgIFBoeXNpY3MuZ3Jhdml0eSA9IG5ldyBQaHlzaWNzVmVjdG9yMigwLCAtMSk7CiAgICAgIFBoeXNpY3Mud2luZCA9IG5ldyBQaHlzaWNzVmVjdG9yMigwLCAwKTsKICAgICAgUGh5c2ljcy5tYXhpbXVtV2VpZ2h0ID0gMTAwOwogICAgICBQaHlzaWNzLmFpclJlc2lzdGFuY2UgPSA1OwogICAgICBQaHlzaWNzLm1vdmVtZW50VGhyZXNob2xkID0gMC4wMDE7CiAgICAgIFBoeXNpY3MuY29ycmVjdEFuZ2xlcyA9IHRydWU7CiAgICAgIHJldHVybiBQaHlzaWNzOwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5QaHlzaWNzID0gUGh5c2ljczsKCiAgICB2YXIgUGh5c2ljc1BhcnRpY2xlID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQaHlzaWNzUGFydGljbGUoaW5pdGlhbFBvc2l0aW9uLCBtb2JpbGl0eSwgZGVsYXksIGFjY2VsZXJhdGlvbiwgcmFkaXVzKSB7CiAgICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSBpbml0aWFsUG9zaXRpb247CiAgICAgICAgdGhpcy5tb2JpbGl0eSA9IG1vYmlsaXR5OwogICAgICAgIHRoaXMuZGVsYXkgPSBkZWxheTsKICAgICAgICB0aGlzLmFjY2VsZXJhdGlvbiA9IGFjY2VsZXJhdGlvbjsKICAgICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1czsKICAgICAgICB0aGlzLnBvc2l0aW9uID0gaW5pdGlhbFBvc2l0aW9uOwogICAgICAgIHRoaXMubGFzdFBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbjsKICAgICAgICB0aGlzLmxhc3RHcmF2aXR5ID0gbmV3IFBoeXNpY3NWZWN0b3IyKDAsIC0xKTsKICAgICAgICB0aGlzLmZvcmNlID0gbmV3IFBoeXNpY3NWZWN0b3IyKDAsIDApOwogICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgUGh5c2ljc1ZlY3RvcjIoMCwgMCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBQaHlzaWNzUGFydGljbGU7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlBoeXNpY3NQYXJ0aWNsZSA9IFBoeXNpY3NQYXJ0aWNsZTsKCiAgICB2YXIgUGh5c2ljc0ZhY3RvclR1cGxlID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQaHlzaWNzRmFjdG9yVHVwbGUoeCwgeSwgYW5nbGUpIHsKICAgICAgICB0aGlzLnggPSB4OwogICAgICAgIHRoaXMueSA9IHk7CiAgICAgICAgdGhpcy5hbmdsZSA9IGFuZ2xlOwogICAgICB9CgogICAgICBQaHlzaWNzRmFjdG9yVHVwbGUucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChmYWN0b3IpIHsKICAgICAgICB2YXIgeCA9IHRoaXMueCArIGZhY3Rvci54OwogICAgICAgIHZhciB5ID0gdGhpcy55ICsgZmFjdG9yLnk7CiAgICAgICAgdmFyIGFuZ2xlID0gdGhpcy5hbmdsZSArIGZhY3Rvci5hbmdsZTsKICAgICAgICByZXR1cm4gbmV3IFBoeXNpY3NGYWN0b3JUdXBsZSh4LCB5LCBhbmdsZSk7CiAgICAgIH07CgogICAgICByZXR1cm4gUGh5c2ljc0ZhY3RvclR1cGxlOwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5QaHlzaWNzRmFjdG9yVHVwbGUgPSBQaHlzaWNzRmFjdG9yVHVwbGU7CgogICAgdmFyIFBoeXNpY3NOb3JtYWxpemF0aW9uVHVwbGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBoeXNpY3NOb3JtYWxpemF0aW9uVHVwbGUobWluaW11bSwgbWF4aW11bSwgZGVmKSB7CiAgICAgICAgdGhpcy5taW5pbXVtID0gbWluaW11bTsKICAgICAgICB0aGlzLm1heGltdW0gPSBtYXhpbXVtOwogICAgICAgIHRoaXMuZGVmID0gZGVmOwogICAgICB9CgogICAgICByZXR1cm4gUGh5c2ljc05vcm1hbGl6YXRpb25UdXBsZTsKICAgIH0oKTsKCiAgICBMSVZFMkRDVUJJU01GUkFNRVdPUksuUGh5c2ljc05vcm1hbGl6YXRpb25UdXBsZSA9IFBoeXNpY3NOb3JtYWxpemF0aW9uVHVwbGU7CgogICAgdmFyIFBoeXNpY3NOb3JtYWxpemF0aW9uT3B0aW9ucyA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUGh5c2ljc05vcm1hbGl6YXRpb25PcHRpb25zKHBvc2l0aW9uLCBhbmdsZSkgewogICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjsKICAgICAgICB0aGlzLmFuZ2xlID0gYW5nbGU7CiAgICAgIH0KCiAgICAgIHJldHVybiBQaHlzaWNzTm9ybWFsaXphdGlvbk9wdGlvbnM7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlBoeXNpY3NOb3JtYWxpemF0aW9uT3B0aW9ucyA9IFBoeXNpY3NOb3JtYWxpemF0aW9uT3B0aW9uczsKCiAgICB2YXIgUGh5c2ljc0lucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQaHlzaWNzSW5wdXQodGFyZ2V0SWQsIHdlaWdodCwgZmFjdG9yLCBpbnZlcnQpIHsKICAgICAgICB0aGlzLnRhcmdldElkID0gdGFyZ2V0SWQ7CiAgICAgICAgdGhpcy53ZWlnaHQgPSB3ZWlnaHQ7CiAgICAgICAgdGhpcy5mYWN0b3IgPSBmYWN0b3I7CiAgICAgICAgdGhpcy5pbnZlcnQgPSBpbnZlcnQ7CiAgICAgIH0KCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQaHlzaWNzSW5wdXQucHJvdG90eXBlLCAnbm9ybWFsaXplZFdlaWdodCcsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiBQaHlzaWNzLmNsYW1wU2NhbGFyKHRoaXMud2VpZ2h0IC8gUGh5c2ljcy5tYXhpbXVtV2VpZ2h0LCAwLCAxKTsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgUGh5c2ljc0lucHV0LnByb3RvdHlwZS5ldmFsdWF0ZUZhY3RvciA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJWYWx1ZSwgcGFyYW1ldGVyTWluaW11bSwgcGFyYW1ldGVyTWF4aW11bSwgcGFyYW1ldGVyRGVmYXVsdCwgbm9ybWFsaXphdGlvbikgewogICAgICAgIGNvbnNvbGUuYXNzZXJ0KHBhcmFtZXRlck1heGltdW0gPiBwYXJhbWV0ZXJNaW5pbXVtKTsKICAgICAgICB2YXIgcGFyYW1ldGVyTWlkZGxlID0gdGhpcy5nZXRNaWRkbGVWYWx1ZShwYXJhbWV0ZXJNaW5pbXVtLCBwYXJhbWV0ZXJNYXhpbXVtKTsKICAgICAgICB2YXIgdmFsdWUgPSBwYXJhbWV0ZXJWYWx1ZSAtIHBhcmFtZXRlck1pZGRsZTsKCiAgICAgICAgc3dpdGNoIChNYXRoLnNpZ24odmFsdWUpKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVyUmFuZ2UgPSBwYXJhbWV0ZXJNYXhpbXVtIC0gcGFyYW1ldGVyTWlkZGxlOwoKICAgICAgICAgICAgICBpZiAocGFyYW1ldGVyUmFuZ2UgPT09IDApIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXphdGlvbi5hbmdsZS5kZWY7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBub3JtYWxpemF0aW9uUmFuZ2UgPSBub3JtYWxpemF0aW9uLmFuZ2xlLm1heGltdW0gLSBub3JtYWxpemF0aW9uLmFuZ2xlLmRlZjsKCiAgICAgICAgICAgICAgICBpZiAobm9ybWFsaXphdGlvblJhbmdlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXphdGlvbi5hbmdsZS5tYXhpbXVtOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgKj0gTWF0aC5hYnMobm9ybWFsaXphdGlvblJhbmdlIC8gcGFyYW1ldGVyUmFuZ2UpOwogICAgICAgICAgICAgICAgICB2YWx1ZSArPSBub3JtYWxpemF0aW9uLmFuZ2xlLmRlZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAtMToKICAgICAgICAgICAgewogICAgICAgICAgICAgIHZhciBfcGFyYW1ldGVyUmFuZ2UgPSBwYXJhbWV0ZXJNaWRkbGUgLSBwYXJhbWV0ZXJNaW5pbXVtOwoKICAgICAgICAgICAgICBpZiAoX3BhcmFtZXRlclJhbmdlID09PSAwKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IG5vcm1hbGl6YXRpb24uYW5nbGUuZGVmOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgX25vcm1hbGl6YXRpb25SYW5nZSA9IG5vcm1hbGl6YXRpb24uYW5nbGUuZGVmIC0gbm9ybWFsaXphdGlvbi5hbmdsZS5taW5pbXVtOwoKICAgICAgICAgICAgICAgIGlmIChfbm9ybWFsaXphdGlvblJhbmdlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXphdGlvbi5hbmdsZS5taW5pbXVtOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgKj0gTWF0aC5hYnMoX25vcm1hbGl6YXRpb25SYW5nZSAvIF9wYXJhbWV0ZXJSYW5nZSk7CiAgICAgICAgICAgICAgICAgIHZhbHVlICs9IG5vcm1hbGl6YXRpb24uYW5nbGUuZGVmOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXphdGlvbi5hbmdsZS5kZWY7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgdmFyIHdlaWdodCA9IHRoaXMud2VpZ2h0IC8gUGh5c2ljcy5tYXhpbXVtV2VpZ2h0OwogICAgICAgIHZhbHVlICo9IHRoaXMuaW52ZXJ0ID8gMSA6IC0xOwogICAgICAgIHJldHVybiBuZXcgUGh5c2ljc0ZhY3RvclR1cGxlKHZhbHVlICogdGhpcy5mYWN0b3IueCAqIHdlaWdodCwgdmFsdWUgKiB0aGlzLmZhY3Rvci55ICogd2VpZ2h0LCB2YWx1ZSAqIHRoaXMuZmFjdG9yLmFuZ2xlICogd2VpZ2h0KTsKICAgICAgfTsKCiAgICAgIFBoeXNpY3NJbnB1dC5wcm90b3R5cGUuZ2V0UmFuZ2VWYWx1ZSA9IGZ1bmN0aW9uIChtaW4sIG1heCkgewogICAgICAgIHZhciBtYXhWYWx1ZSA9IE1hdGgubWF4KG1pbiwgbWF4KTsKICAgICAgICB2YXIgbWluVmFsdWUgPSBNYXRoLm1pbihtaW4sIG1heCk7CiAgICAgICAgcmV0dXJuIE1hdGguYWJzKG1heFZhbHVlIC0gbWluVmFsdWUpOwogICAgICB9OwoKICAgICAgUGh5c2ljc0lucHV0LnByb3RvdHlwZS5nZXRNaWRkbGVWYWx1ZSA9IGZ1bmN0aW9uIChtaW4sIG1heCkgewogICAgICAgIHZhciBtaW5WYWx1ZSA9IE1hdGgubWluKG1pbiwgbWF4KTsKICAgICAgICByZXR1cm4gbWluVmFsdWUgKyB0aGlzLmdldFJhbmdlVmFsdWUobWluLCBtYXgpIC8gMjsKICAgICAgfTsKCiAgICAgIHJldHVybiBQaHlzaWNzSW5wdXQ7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlBoeXNpY3NJbnB1dCA9IFBoeXNpY3NJbnB1dDsKCiAgICB2YXIgUGh5c2ljc091dHB1dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUGh5c2ljc091dHB1dCh0YXJnZXRJZCwgcGFydGljbGVJbmRleCwgd2VpZ2h0LCBhbmdsZVNjYWxlLCBmYWN0b3IsIGludmVydCkgewogICAgICAgIHRoaXMudGFyZ2V0SWQgPSB0YXJnZXRJZDsKICAgICAgICB0aGlzLnBhcnRpY2xlSW5kZXggPSBwYXJ0aWNsZUluZGV4OwogICAgICAgIHRoaXMud2VpZ2h0ID0gd2VpZ2h0OwogICAgICAgIHRoaXMuZmFjdG9yID0gZmFjdG9yOwogICAgICAgIHRoaXMuaW52ZXJ0ID0gaW52ZXJ0OwogICAgICAgIHRoaXMuZmFjdG9yLmFuZ2xlICo9IGFuZ2xlU2NhbGU7CiAgICAgIH0KCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQaHlzaWNzT3V0cHV0LnByb3RvdHlwZSwgJ25vcm1hbGl6ZWRXZWlnaHQnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gUGh5c2ljcy5jbGFtcFNjYWxhcih0aGlzLndlaWdodCAvIFBoeXNpY3MubWF4aW11bVdlaWdodCwgMCwgMSk7CiAgICAgICAgfSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKCiAgICAgIFBoeXNpY3NPdXRwdXQucHJvdG90eXBlLmV2YWx1YXRlVmFsdWUgPSBmdW5jdGlvbiAodHJhbnNsYXRpb24sIHBhcnRpY2xlcykgewogICAgICAgIHZhciB2YWx1ZSA9IHRyYW5zbGF0aW9uLnggKiB0aGlzLmZhY3Rvci54ICsgdHJhbnNsYXRpb24ueSAqIHRoaXMuZmFjdG9yLnk7CgogICAgICAgIGlmICh0aGlzLmZhY3Rvci5hbmdsZSA+IDApIHsKICAgICAgICAgIHZhciBwYXJlbnRHcmF2aXR5ID0gUGh5c2ljcy5ncmF2aXR5OwoKICAgICAgICAgIGlmIChQaHlzaWNzLmNvcnJlY3RBbmdsZXMgJiYgdGhpcy5wYXJ0aWNsZUluZGV4ID4gMSkgewogICAgICAgICAgICBwYXJlbnRHcmF2aXR5ID0gcGFydGljbGVzW3RoaXMucGFydGljbGVJbmRleCAtIDJdLnBvc2l0aW9uLnN1YnN0cmFjdChwYXJ0aWNsZXNbdGhpcy5wYXJ0aWNsZUluZGV4IC0gMV0ucG9zaXRpb24pOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBhbmdsZVJlc3VsdCA9IFBoeXNpY3MuZGlyZWN0aW9uVG9SYWRpYW5zKHBhcmVudEdyYXZpdHksIHRyYW5zbGF0aW9uKTsKICAgICAgICAgIHZhbHVlICs9ICh0cmFuc2xhdGlvbi54IC0gcGFyZW50R3Jhdml0eS54ID4gMCA/IC1hbmdsZVJlc3VsdCA6IGFuZ2xlUmVzdWx0KSAqIHRoaXMuZmFjdG9yLmFuZ2xlOwogICAgICAgIH0KCiAgICAgICAgdmFsdWUgKj0gdGhpcy5pbnZlcnQgPyAtMSA6IDE7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9OwoKICAgICAgcmV0dXJuIFBoeXNpY3NPdXRwdXQ7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlBoeXNpY3NPdXRwdXQgPSBQaHlzaWNzT3V0cHV0OwoKICAgIHZhciBQaHlzaWNzU3ViUmlnID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQaHlzaWNzU3ViUmlnKGlucHV0LCBvdXRwdXQsIHBhcnRpY2xlcywgbm9ybWFsaXphdGlvbikgewogICAgICAgIHRoaXMuaW5wdXQgPSBpbnB1dDsKICAgICAgICB0aGlzLm91dHB1dCA9IG91dHB1dDsKICAgICAgICB0aGlzLnBhcnRpY2xlcyA9IHBhcnRpY2xlczsKICAgICAgICB0aGlzLm5vcm1hbGl6YXRpb24gPSBub3JtYWxpemF0aW9uOwogICAgICB9CgogICAgICBQaHlzaWNzU3ViUmlnLnByb3RvdHlwZS5fdXBkYXRlID0gZnVuY3Rpb24gKGRlbHRhVGltZSwgdGFyZ2V0KSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIHBhcmFtZXRlcnMgPSB0YXJnZXQucGFyYW1ldGVyczsKICAgICAgICB2YXIgZmFjdG9yID0gbmV3IFBoeXNpY3NGYWN0b3JUdXBsZSgwLCAwLCAwKTsKICAgICAgICB0aGlzLmlucHV0LmZvckVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICAgIHZhciBwYXJhbWV0ZXJJbmRleCA9IHBhcmFtZXRlcnMuaWRzLmluZGV4T2YoaS50YXJnZXRJZCk7CgogICAgICAgICAgaWYgKHBhcmFtZXRlckluZGV4ID09PSAtMSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgZmFjdG9yID0gZmFjdG9yLmFkZChpLmV2YWx1YXRlRmFjdG9yKHBhcmFtZXRlcnMudmFsdWVzW3BhcmFtZXRlckluZGV4XSwgcGFyYW1ldGVycy5taW5pbXVtVmFsdWVzW3BhcmFtZXRlckluZGV4XSwgcGFyYW1ldGVycy5tYXhpbXVtVmFsdWVzW3BhcmFtZXRlckluZGV4XSwgcGFyYW1ldGVycy5kZWZhdWx0VmFsdWVzW3BhcmFtZXRlckluZGV4XSwgX3RoaXMubm9ybWFsaXphdGlvbikpOwogICAgICAgIH0pOwogICAgICAgIHZhciBhID0gUGh5c2ljcy5kZWdyZWVzVG9SYWRpYW5zKC1mYWN0b3IuYW5nbGUpOwogICAgICAgIHZhciB4eSA9IG5ldyBQaHlzaWNzVmVjdG9yMihmYWN0b3IueCwgZmFjdG9yLnkpLnJvdGF0ZUJ5UmFkaWFucyhhKTsKICAgICAgICBmYWN0b3IueCA9IHh5Lng7CiAgICAgICAgZmFjdG9yLnkgPSB4eS55OwogICAgICAgIHZhciBmYWN0b3JSYWRpYW5zID0gYTsKICAgICAgICB2YXIgZ3Jhdml0eURpcmVjdGlvbiA9IFBoeXNpY3MucmFkaWFuc1RvRGlyZWN0aW9uKGZhY3RvclJhZGlhbnMpLm5vcm1hbGl6ZSgpOwogICAgICAgIHRoaXMucGFydGljbGVzLmZvckVhY2goZnVuY3Rpb24gKHAsIGkpIHsKICAgICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgIHAucG9zaXRpb24gPSBuZXcgUGh5c2ljc1ZlY3RvcjIoZmFjdG9yLngsIGZhY3Rvci55KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHAuZm9yY2UgPSBncmF2aXR5RGlyZWN0aW9uLm11bHRpcGx5QnlTY2FsYXIocC5hY2NlbGVyYXRpb24pLmFkZChQaHlzaWNzLndpbmQpOwogICAgICAgICAgcC5sYXN0UG9zaXRpb24gPSBwLnBvc2l0aW9uOwogICAgICAgICAgdmFyIGRlbGF5ID0gcC5kZWxheSAqIGRlbHRhVGltZSAqIDMwOwogICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IHAucG9zaXRpb24uc3Vic3RyYWN0KF90aGlzLnBhcnRpY2xlc1tpIC0gMV0ucG9zaXRpb24pOwogICAgICAgICAgdmFyIGRpc3RhbmNlID0gUGh5c2ljc1ZlY3RvcjIuZGlzdGFuY2UoUGh5c2ljc1ZlY3RvcjIuemVybywgZGlyZWN0aW9uKTsKICAgICAgICAgIHZhciBhbmdsZSA9IFBoeXNpY3MuZGlyZWN0aW9uVG9EZWdyZWVzKHAubGFzdEdyYXZpdHksIGdyYXZpdHlEaXJlY3Rpb24pOwogICAgICAgICAgdmFyIHJhZGlhbnMgPSBQaHlzaWNzLmRlZ3JlZXNUb1JhZGlhbnMoYW5nbGUpIC8gUGh5c2ljcy5haXJSZXNpc3RhbmNlOwogICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uLnJvdGF0ZUJ5UmFkaWFucyhyYWRpYW5zKS5ub3JtYWxpemUoKTsKICAgICAgICAgIHAucG9zaXRpb24gPSBfdGhpcy5wYXJ0aWNsZXNbaSAtIDFdLnBvc2l0aW9uLmFkZChkaXJlY3Rpb24ubXVsdGlwbHlCeVNjYWxhcihkaXN0YW5jZSkpOwogICAgICAgICAgdmFyIHZlbG9jaXR5ID0gcC52ZWxvY2l0eS5tdWx0aXBseUJ5U2NhbGFyKGRlbGF5KTsKICAgICAgICAgIHZhciBmb3JjZSA9IHAuZm9yY2UubXVsdGlwbHlCeVNjYWxhcihkZWxheSkubXVsdGlwbHlCeVNjYWxhcihkZWxheSk7CiAgICAgICAgICBwLnBvc2l0aW9uID0gcC5wb3NpdGlvbi5hZGQodmVsb2NpdHkpLmFkZChmb3JjZSk7CiAgICAgICAgICB2YXIgbmV3RGlyZWN0aW9uID0gcC5wb3NpdGlvbi5zdWJzdHJhY3QoX3RoaXMucGFydGljbGVzW2kgLSAxXS5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICBwLnBvc2l0aW9uID0gX3RoaXMucGFydGljbGVzW2kgLSAxXS5wb3NpdGlvbi5hZGQobmV3RGlyZWN0aW9uLm11bHRpcGx5QnlTY2FsYXIocC5yYWRpdXMpKTsKCiAgICAgICAgICBpZiAoTWF0aC5hYnMocC5wb3NpdGlvbi54KSA8IFBoeXNpY3MubW92ZW1lbnRUaHJlc2hvbGQpIHsKICAgICAgICAgICAgcC5wb3NpdGlvbi54ID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGVsYXkgIT09IDApIHsKICAgICAgICAgICAgcC52ZWxvY2l0eSA9IHAucG9zaXRpb24uc3Vic3RyYWN0KHAubGFzdFBvc2l0aW9uKS5kaXZpZGVCeVNjYWxhcihkZWxheSkubXVsdGlwbHlCeVNjYWxhcihwLm1vYmlsaXR5KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHAudmVsb2NpdHkgPSBQaHlzaWNzVmVjdG9yMi56ZXJvOwogICAgICAgICAgfQoKICAgICAgICAgIHAuZm9yY2UgPSBQaHlzaWNzVmVjdG9yMi56ZXJvOwogICAgICAgICAgcC5sYXN0R3Jhdml0eSA9IGdyYXZpdHlEaXJlY3Rpb247CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBQaHlzaWNzU3ViUmlnLnByb3RvdHlwZS5fZXZhbHVhdGUgPSBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIHBhcmFtZXRlcnMgPSB0YXJnZXQucGFyYW1ldGVyczsKICAgICAgICB0aGlzLm91dHB1dC5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICBpZiAoby5wYXJ0aWNsZUluZGV4IDwgMSB8fCBvLnBhcnRpY2xlSW5kZXggPj0gX3RoaXMucGFydGljbGVzLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhcmFtZXRlckluZGV4ID0gcGFyYW1ldGVycy5pZHMuaW5kZXhPZihvLnRhcmdldElkKTsKCiAgICAgICAgICBpZiAocGFyYW1ldGVySW5kZXggPT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdHJhbnNsYXRpb24gPSBfdGhpcy5wYXJ0aWNsZXNbby5wYXJ0aWNsZUluZGV4IC0gMV0ucG9zaXRpb24uc3Vic3RyYWN0KF90aGlzLnBhcnRpY2xlc1tvLnBhcnRpY2xlSW5kZXhdLnBvc2l0aW9uKTsKCiAgICAgICAgICB2YXIgdmFsdWUgPSBQaHlzaWNzLmNsYW1wU2NhbGFyKG8uZXZhbHVhdGVWYWx1ZSh0cmFuc2xhdGlvbiwgX3RoaXMucGFydGljbGVzKSwgcGFyYW1ldGVycy5taW5pbXVtVmFsdWVzW3BhcmFtZXRlckluZGV4XSwgcGFyYW1ldGVycy5tYXhpbXVtVmFsdWVzW3BhcmFtZXRlckluZGV4XSk7CiAgICAgICAgICB2YXIgdW5jbGFtcGVkUGFyYW1ldGVyVmFsdWUgPSBwYXJhbWV0ZXJzLnZhbHVlc1twYXJhbWV0ZXJJbmRleF0gKiAoMSAtIG8ubm9ybWFsaXplZFdlaWdodCkgKyB2YWx1ZSAqIG8ubm9ybWFsaXplZFdlaWdodDsKICAgICAgICAgIHBhcmFtZXRlcnMudmFsdWVzW3BhcmFtZXRlckluZGV4XSA9IFBoeXNpY3MuY2xhbXBTY2FsYXIodW5jbGFtcGVkUGFyYW1ldGVyVmFsdWUsIHBhcmFtZXRlcnMubWluaW11bVZhbHVlc1twYXJhbWV0ZXJJbmRleF0sIHBhcmFtZXRlcnMubWF4aW11bVZhbHVlc1twYXJhbWV0ZXJJbmRleF0pOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgcmV0dXJuIFBoeXNpY3NTdWJSaWc7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlBoeXNpY3NTdWJSaWcgPSBQaHlzaWNzU3ViUmlnOwoKICAgIHZhciBQaHlzaWNzUmlnID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQaHlzaWNzUmlnKHRhcmdldCwgdGltZVNjYWxlLCBwaHlzaWNzM0pzb24pIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB0aGlzLnRpbWVTY2FsZSA9IDE7CiAgICAgICAgdGhpcy50aW1lU2NhbGUgPSB0aW1lU2NhbGU7CiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gdGFyZ2V0OwoKICAgICAgICBpZiAoIXRhcmdldCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fc3ViUmlncyA9IFtdOwogICAgICAgIHBoeXNpY3MzSnNvbi5QaHlzaWNzU2V0dGluZ3MuZm9yRWFjaChmdW5jdGlvbiAocikgewogICAgICAgICAgdmFyIGlucHV0ID0gW107CiAgICAgICAgICByLklucHV0LmZvckVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgdmFyIGZhY3RvciA9IG5ldyBQaHlzaWNzRmFjdG9yVHVwbGUoMSwgMCwgMCk7CgogICAgICAgICAgICBpZiAoaS5UeXBlID09PSAnWScpIHsKICAgICAgICAgICAgICBmYWN0b3IueCA9IDA7CiAgICAgICAgICAgICAgZmFjdG9yLnkgPSAxOwogICAgICAgICAgICB9IGVsc2UgaWYgKGkuVHlwZSA9PT0gJ0FuZ2xlJykgewogICAgICAgICAgICAgIGZhY3Rvci54ID0gMDsKICAgICAgICAgICAgICBmYWN0b3IuYW5nbGUgPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnB1dC5wdXNoKG5ldyBQaHlzaWNzSW5wdXQoaS5Tb3VyY2UuSWQsIGkuV2VpZ2h0LCBmYWN0b3IsIGkuUmVmbGVjdCkpOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3V0cHV0ID0gW107CiAgICAgICAgICByLk91dHB1dC5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICAgIHZhciBmYWN0b3IgPSBuZXcgUGh5c2ljc0ZhY3RvclR1cGxlKDEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKG8uVHlwZSA9PT0gJ1knKSB7CiAgICAgICAgICAgICAgZmFjdG9yLnggPSAwOwogICAgICAgICAgICAgIGZhY3Rvci55ID0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvLlR5cGUgPT09ICdBbmdsZScpIHsKICAgICAgICAgICAgICBmYWN0b3IueCA9IDA7CiAgICAgICAgICAgICAgZmFjdG9yLmFuZ2xlID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0cHV0LnB1c2gobmV3IFBoeXNpY3NPdXRwdXQoby5EZXN0aW5hdGlvbi5JZCwgby5WZXJ0ZXhJbmRleCwgby5XZWlnaHQsIG8uU2NhbGUsIGZhY3Rvciwgby5SZWZsZWN0KSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBwYXJ0aWNsZXMgPSBbXTsKICAgICAgICAgIHIuVmVydGljZXMuZm9yRWFjaChmdW5jdGlvbiAocCkgewogICAgICAgICAgICB2YXIgaW5pdGlhbFBvc2l0aW9uID0gbmV3IFBoeXNpY3NWZWN0b3IyKHAuUG9zaXRpb24uWCwgcC5Qb3NpdGlvbi5ZKTsKICAgICAgICAgICAgcGFydGljbGVzLnB1c2gobmV3IFBoeXNpY3NQYXJ0aWNsZShpbml0aWFsUG9zaXRpb24sIHAuTW9iaWxpdHksIHAuRGVsYXksIHAuQWNjZWxlcmF0aW9uLCBwLlJhZGl1cykpOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIganNvbk9wdGlvbnMgPSByLk5vcm1hbGl6YXRpb247CiAgICAgICAgICB2YXIgcG9zaXRpb25zT3B0aW9uID0gbmV3IFBoeXNpY3NOb3JtYWxpemF0aW9uVHVwbGUoanNvbk9wdGlvbnMuUG9zaXRpb24uTWluaW11bSwganNvbk9wdGlvbnMuUG9zaXRpb24uTWF4aW11bSwganNvbk9wdGlvbnMuUG9zaXRpb24uRGVmYXVsdCk7CiAgICAgICAgICB2YXIgYW5nbGVzT3B0aW9uID0gbmV3IFBoeXNpY3NOb3JtYWxpemF0aW9uVHVwbGUoanNvbk9wdGlvbnMuQW5nbGUuTWluaW11bSwganNvbk9wdGlvbnMuQW5nbGUuTWF4aW11bSwganNvbk9wdGlvbnMuQW5nbGUuRGVmYXVsdCk7CiAgICAgICAgICB2YXIgbm9ybWFsaXphdGlvbiA9IG5ldyBQaHlzaWNzTm9ybWFsaXphdGlvbk9wdGlvbnMocG9zaXRpb25zT3B0aW9uLCBhbmdsZXNPcHRpb24pOwoKICAgICAgICAgIF90aGlzLl9zdWJSaWdzLnB1c2gobmV3IFBoeXNpY3NTdWJSaWcoaW5wdXQsIG91dHB1dCwgcGFydGljbGVzLCBub3JtYWxpemF0aW9uKSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIFBoeXNpY3NSaWcucHJvdG90eXBlLnVwZGF0ZUFuZEV2YWx1YXRlID0gZnVuY3Rpb24gKGRlbHRhVGltZSkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIGRlbHRhVGltZSAqPSB0aGlzLnRpbWVTY2FsZSA+IDAgPyB0aGlzLnRpbWVTY2FsZSA6IDA7CgogICAgICAgIGlmIChkZWx0YVRpbWUgPiAwLjAxKSB7CiAgICAgICAgICB0aGlzLl9zdWJSaWdzLmZvckVhY2goZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgci5fdXBkYXRlKGRlbHRhVGltZSwgX3RoaXMuX3RhcmdldCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX3N1YlJpZ3MuZm9yRWFjaChmdW5jdGlvbiAocikgewogICAgICAgICAgci5fZXZhbHVhdGUoX3RoaXMuX3RhcmdldCk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBQaHlzaWNzUmlnLl9mcm9tUGh5c2ljczNKc29uID0gZnVuY3Rpb24gKHRhcmdldCwgdGltZVNjYWxlLCBwaHlzaWNzM0pzb24pIHsKICAgICAgICB2YXIgcmlnID0gbmV3IFBoeXNpY3NSaWcodGFyZ2V0LCB0aW1lU2NhbGUsIHBoeXNpY3MzSnNvbik7CiAgICAgICAgcmV0dXJuIHJpZy5faXNWYWxpZCA/IHJpZyA6IG51bGw7CiAgICAgIH07CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUGh5c2ljc1JpZy5wcm90b3R5cGUsICdfaXNWYWxpZCcsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90YXJnZXQgIT0gbnVsbDsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICByZXR1cm4gUGh5c2ljc1JpZzsKICAgIH0oKTsKCiAgICBMSVZFMkRDVUJJU01GUkFNRVdPUksuUGh5c2ljc1JpZyA9IFBoeXNpY3NSaWc7CgogICAgdmFyIFBoeXNpY3NSaWdCdWlsZGVyID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQaHlzaWNzUmlnQnVpbGRlcigpIHsKICAgICAgICB0aGlzLl90aW1lU2NhbGUgPSAxOwogICAgICB9CgogICAgICBQaHlzaWNzUmlnQnVpbGRlci5wcm90b3R5cGUuc2V0VGFyZ2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CgogICAgICBQaHlzaWNzUmlnQnVpbGRlci5wcm90b3R5cGUuc2V0VGltZVNjYWxlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fdGltZVNjYWxlID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CgogICAgICBQaHlzaWNzUmlnQnVpbGRlci5wcm90b3R5cGUuc2V0UGh5c2ljczNKc29uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdGhpcy5fcGh5c2ljczNKc29uID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CgogICAgICBQaHlzaWNzUmlnQnVpbGRlci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIFBoeXNpY3NSaWcuX2Zyb21QaHlzaWNzM0pzb24odGhpcy5fdGFyZ2V0LCB0aGlzLl90aW1lU2NhbGUsIHRoaXMuX3BoeXNpY3MzSnNvbik7CiAgICAgIH07CgogICAgICByZXR1cm4gUGh5c2ljc1JpZ0J1aWxkZXI7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlBoeXNpY3NSaWdCdWlsZGVyID0gUGh5c2ljc1JpZ0J1aWxkZXI7CgogICAgdmFyIFVzZXJEYXRhID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBVc2VyRGF0YSh0YXJnZXQsIHVzZXJEYXRhM0pzb24pIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB0aGlzLl90YXJnZXQgPSB0YXJnZXQ7CgogICAgICAgIGlmICghdGFyZ2V0KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLl92ZXJzaW9uID0gdXNlckRhdGEzSnNvbi5WZXJzaW9uOwogICAgICAgIHRoaXMuX3VzZXJEYXRhQ291bnQgPSB1c2VyRGF0YTNKc29uLk1ldGEuVXNlckRhdGFDb3VudDsKICAgICAgICB0aGlzLl90b3RhbFVzZXJEYXRhU2l6ZSA9IHVzZXJEYXRhM0pzb24uTWV0YS5Ub3RhbFVzZXJEYXRhU2l6ZTsKCiAgICAgICAgaWYgKHVzZXJEYXRhM0pzb24uVXNlckRhdGEgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5fdXNlckRhdGFCb2R5cyA9IFtdOwogICAgICAgICAgdXNlckRhdGEzSnNvbi5Vc2VyRGF0YS5mb3JFYWNoKGZ1bmN0aW9uICh1KSB7CiAgICAgICAgICAgIF90aGlzLl91c2VyRGF0YUJvZHlzLnB1c2gobmV3IFVzZXJEYXRhQm9keSh1LlRhcmdldCwgdS5JZCwgdS5WYWx1ZSkpOwogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zb2xlLmFzc2VydCh0aGlzLl91c2VyRGF0YUJvZHlzLmxlbmd0aCA9PT0gdGhpcy5fdXNlckRhdGFDb3VudCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBVc2VyRGF0YS5fZnJvbVVzZXJEYXRhM0pzb24gPSBmdW5jdGlvbiAodGFyZ2V0LCB1c2VyRGF0YTNKc29uKSB7CiAgICAgICAgdmFyIHVzZXJkYXRhID0gbmV3IFVzZXJEYXRhKHRhcmdldCwgdXNlckRhdGEzSnNvbik7CiAgICAgICAgcmV0dXJuIHVzZXJkYXRhLl9pc1ZhbGlkID8gdXNlcmRhdGEgOiBudWxsOwogICAgICB9OwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFVzZXJEYXRhLnByb3RvdHlwZSwgJ19pc1ZhbGlkJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldCAhPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShVc2VyRGF0YS5wcm90b3R5cGUsICd1c2VyRGF0YUNvdW50JywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgaWYgKHRoaXMuX3VzZXJEYXRhQm9keXMgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlckRhdGFDb3VudDsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVXNlckRhdGEucHJvdG90eXBlLCAndG90YWxVc2VyRGF0YVNpemUnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICBpZiAodGhpcy5fdXNlckRhdGFCb2R5cyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLl90b3RhbFVzZXJEYXRhU2l6ZTsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVXNlckRhdGEucHJvdG90eXBlLCAndXNlckRhdGFCb2R5cycsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIGlmICh0aGlzLl91c2VyRGF0YUJvZHlzID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhQm9keXM7CiAgICAgICAgfSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKCiAgICAgIFVzZXJEYXRhLnByb3RvdHlwZS5pc0V4aXN0VXNlckRhdGFCeUlkID0gZnVuY3Rpb24gKGlkXykgewogICAgICAgIGlmICh0aGlzLl91c2VyRGF0YUJvZHlzID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLl91c2VyRGF0YUJvZHlzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgdmFyIHVkID0gX2FbX2ldOwoKICAgICAgICAgIGlmICh1ZC5pZCA9PT0gaWRfKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9OwoKICAgICAgVXNlckRhdGEucHJvdG90eXBlLmdldFVzZXJEYXRhVmFsdWVCeUlkID0gZnVuY3Rpb24gKGlkXykgewogICAgICAgIGlmICh0aGlzLl91c2VyRGF0YUJvZHlzID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX3VzZXJEYXRhQm9keXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICB2YXIgdWQgPSBfYVtfaV07CgogICAgICAgICAgaWYgKHVkLmlkID09PSBpZF8pIHsKICAgICAgICAgICAgcmV0dXJuIHVkLnZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH07CgogICAgICBVc2VyRGF0YS5wcm90b3R5cGUuZ2V0VXNlckRhdGFUYXJnZXRCeUlkID0gZnVuY3Rpb24gKGlkXykgewogICAgICAgIGlmICh0aGlzLl91c2VyRGF0YUJvZHlzID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX3VzZXJEYXRhQm9keXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICB2YXIgdWQgPSBfYVtfaV07CgogICAgICAgICAgaWYgKHVkLmlkID09PSBpZF8pIHsKICAgICAgICAgICAgcmV0dXJuIHVkLnRhcmdldDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9OwoKICAgICAgVXNlckRhdGEucHJvdG90eXBlLmdldFVzZXJEYXRhQm9keUJ5SWQgPSBmdW5jdGlvbiAoaWRfKSB7CiAgICAgICAgaWYgKHRoaXMuX3VzZXJEYXRhQm9keXMgPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fdXNlckRhdGFCb2R5czsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgIHZhciB1ZCA9IF9hW19pXTsKCiAgICAgICAgICBpZiAodWQuaWQgPT09IGlkXykgewogICAgICAgICAgICByZXR1cm4gdWQ7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfTsKCiAgICAgIHJldHVybiBVc2VyRGF0YTsKICAgIH0oKTsKCiAgICBMSVZFMkRDVUJJU01GUkFNRVdPUksuVXNlckRhdGEgPSBVc2VyRGF0YTsKCiAgICB2YXIgVXNlckRhdGFCdWlsZGVyID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBVc2VyRGF0YUJ1aWxkZXIoKSB7fQoKICAgICAgVXNlckRhdGFCdWlsZGVyLnByb3RvdHlwZS5zZXRUYXJnZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB0aGlzLl90YXJnZXQgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKCiAgICAgIFVzZXJEYXRhQnVpbGRlci5wcm90b3R5cGUuc2V0VXNlckRhdGEzSnNvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHRoaXMuX3VzZXJEYXRhM0pzb24gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH07CgogICAgICBVc2VyRGF0YUJ1aWxkZXIucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBVc2VyRGF0YS5fZnJvbVVzZXJEYXRhM0pzb24odGhpcy5fdGFyZ2V0LCB0aGlzLl91c2VyRGF0YTNKc29uKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBVc2VyRGF0YUJ1aWxkZXI7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlVzZXJEYXRhQnVpbGRlciA9IFVzZXJEYXRhQnVpbGRlcjsKCiAgICB2YXIgVXNlckRhdGFCb2R5ID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBVc2VyRGF0YUJvZHkodGFyZ2V0LCBpZCwgdmFsdWUpIHsKICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDsKICAgICAgICB0aGlzLmlkID0gaWQ7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICB9CgogICAgICByZXR1cm4gVXNlckRhdGFCb2R5OwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5Vc2VyRGF0YUJvZHkgPSBVc2VyRGF0YUJvZHk7CiAgICB2YXIgVXNlckRhdGFUYXJnZXRUeXBlOwoKICAgIChmdW5jdGlvbiAoVXNlckRhdGFUYXJnZXRUeXBlKSB7CiAgICAgIFVzZXJEYXRhVGFyZ2V0VHlwZVtVc2VyRGF0YVRhcmdldFR5cGUuVU5LTk9XTiA9IDBdID0gJ1VOS05PV04nOwogICAgICBVc2VyRGF0YVRhcmdldFR5cGVbVXNlckRhdGFUYXJnZXRUeXBlLkFydE1lc2ggPSAxXSA9ICdBcnRNZXNoJzsKICAgIH0pKFVzZXJEYXRhVGFyZ2V0VHlwZSB8fCAoVXNlckRhdGFUYXJnZXRUeXBlID0ge30pKTsKCiAgICB2YXIgR3JvdXBzID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBHcm91cHMobW9kZWwzSnNvbikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIGlmICh0eXBlb2YgbW9kZWwzSnNvbi5Hcm91cHMgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICB0aGlzLl9ncm91cEJvZHlzID0gW107CiAgICAgICAgICBtb2RlbDNKc29uLkdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uICh1KSB7CiAgICAgICAgICAgIF90aGlzLl9ncm91cEJvZHlzLnB1c2gobmV3IEdyb3VwQm9keSh1LlRhcmdldCwgdS5OYW1lLCB1LklkcykpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX2dyb3VwQm9keXMgPSBudWxsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyb3Vwcy5wcm90b3R5cGUsICdkYXRhJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgaWYgKHRoaXMuX2dyb3VwQm9keXMgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXBCb2R5czsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgR3JvdXBzLmZyb21Nb2RlbDNKc29uID0gZnVuY3Rpb24gKG1vZGVsM0pzb24pIHsKICAgICAgICByZXR1cm4gbmV3IEdyb3Vwcyhtb2RlbDNKc29uKTsKICAgICAgfTsKCiAgICAgIEdyb3Vwcy5wcm90b3R5cGUuZ2V0R3JvdXBCeUlkID0gZnVuY3Rpb24gKHRhcmdldElkKSB7CiAgICAgICAgaWYgKHRoaXMuX2dyb3VwQm9keXMgIT0gbnVsbCkgewogICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2dyb3VwQm9keXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIHZhciBib2R5ID0gX2FbX2ldOwoKICAgICAgICAgICAgaWYgKGJvZHkubmFtZSA9PT0gdGFyZ2V0SWQpIHsKICAgICAgICAgICAgICByZXR1cm4gYm9keTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH07CgogICAgICByZXR1cm4gR3JvdXBzOwogICAgfSgpOwoKICAgIExJVkUyRENVQklTTUZSQU1FV09SSy5Hcm91cHMgPSBHcm91cHM7CgogICAgdmFyIEdyb3VwQm9keSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gR3JvdXBCb2R5KHRhcmdldCwgbmFtZSwgaWRzKSB7CiAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICB0aGlzLmlkcyA9IGlkczsKICAgICAgfQoKICAgICAgcmV0dXJuIEdyb3VwQm9keTsKICAgIH0oKTsKCiAgICBMSVZFMkRDVUJJU01GUkFNRVdPUksuR3JvdXBCb2R5ID0gR3JvdXBCb2R5OwogIH0pKExJVkUyRENVQklTTUZSQU1FV09SSyB8fCAoTElWRTJEQ1VCSVNNRlJBTUVXT1JLID0ge30pKTsKCiAgdmFyIF9fZXh0ZW5kcyA9IHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKCkgewogICAgdmFyIF9leHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gZXh0ZW5kU3RhdGljcyhkLCBiKSB7CiAgICAgIF9leHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IHsKICAgICAgICBfX3Byb3RvX186IFtdCiAgICAgIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGQuX19wcm90b19fID0gYjsKICAgICAgfSB8fCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXByb3RvCiAgICAgIGZ1bmN0aW9uIChkLCBiKSB7CiAgICAgICAgZm9yICh2YXIgcCBpbiBiKSB7CiAgICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07CiAgICAgICAgfQogICAgICB9OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXByb3RvdHlwZS1idWlsdGlucwoKCiAgICAgIHJldHVybiBfZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CgogICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CiAgICAgIF9leHRlbmRTdGF0aWNzKGQsIGIpOwoKICAgICAgZnVuY3Rpb24gX18oKSB7CiAgICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CiAgICAgIH0KCiAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07CiAgfSgpOwoKICB2YXIgTElWRTJEQ1VCSVNNUElYSTsKCiAgKGZ1bmN0aW9uIChMSVZFMkRDVUJJU01QSVhJKSB7CiAgICB2YXIgTW9kZWwgPSBmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgIF9fZXh0ZW5kcyhNb2RlbCwgX3N1cGVyKTsKCiAgICAgIGZ1bmN0aW9uIE1vZGVsKGNvcmVNb2RlbCwgdGV4dHVyZXMsIGFuaW1hdG9yLCBwaHlzaWNzUmlnLCB1c2VyRGF0YSwgZ3JvdXBzKSB7CiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKCiAgICAgICAgX3RoaXMuX2NvcmVNb2RlbCA9IGNvcmVNb2RlbDsKICAgICAgICBfdGhpcy5fdGV4dHVyZXMgPSB0ZXh0dXJlczsKICAgICAgICBfdGhpcy5fYW5pbWF0b3IgPSBhbmltYXRvcjsKICAgICAgICBfdGhpcy5fcGh5c2ljc1JpZyA9IHBoeXNpY3NSaWc7CiAgICAgICAgX3RoaXMuX3VzZXJEYXRhID0gdXNlckRhdGE7CiAgICAgICAgX3RoaXMuX2dyb3VwcyA9IGdyb3VwczsKICAgICAgICBfdGhpcy5fYW5pbWF0b3IuZ3JvdXBzID0gX3RoaXMuX2dyb3VwczsKCiAgICAgICAgaWYgKF90aGlzLl9jb3JlTW9kZWwgPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMuX21lc2hlcyA9IG5ldyBBcnJheShfdGhpcy5fY29yZU1vZGVsLmRyYXdhYmxlcy5pZHMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBfdGhpcy5fbWVzaGVzLmxlbmd0aDsgKyttKSB7CiAgICAgICAgICB2YXIgdXZzID0gX3RoaXMuX2NvcmVNb2RlbC5kcmF3YWJsZXMudmVydGV4VXZzW21dLnNsaWNlKDAsIF90aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLnZlcnRleFV2c1ttXS5sZW5ndGgpOwoKICAgICAgICAgIGZvciAodmFyIHYgPSAxOyB2IDwgdXZzLmxlbmd0aDsgdiArPSAyKSB7CiAgICAgICAgICAgIHV2c1t2XSA9IDEgLSB1dnNbdl07CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMuX21lc2hlc1ttXSA9IG5ldyBDdWJpc21NZXNoKHRleHR1cmVzW190aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLnRleHR1cmVJbmRpY2VzW21dXSwgX3RoaXMuX2NvcmVNb2RlbC5kcmF3YWJsZXMudmVydGV4UG9zaXRpb25zW21dLCB1dnMsIF90aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLmluZGljZXNbbV0sIFBJWEkuRFJBV19NT0RFUy5UUklBTkdMRVMpOwogICAgICAgICAgX3RoaXMuX21lc2hlc1ttXS5uYW1lID0gX3RoaXMuX2NvcmVNb2RlbC5kcmF3YWJsZXMuaWRzW21dOwogICAgICAgICAgX3RoaXMuX21lc2hlc1ttXS5zY2FsZS55ICo9IC0xOwogICAgICAgICAgX3RoaXMuX21lc2hlc1ttXS5pc0N1bGxpbmcgPSAhTGl2ZTJEQ3ViaXNtQ29yZS5VdGlscy5oYXNJc0RvdWJsZVNpZGVkQml0KF90aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLmNvbnN0YW50RmxhZ3NbbV0pOwoKICAgICAgICAgIGlmIChMaXZlMkRDdWJpc21Db3JlLlV0aWxzLmhhc0JsZW5kQWRkaXRpdmVCaXQoX3RoaXMuX2NvcmVNb2RlbC5kcmF3YWJsZXMuY29uc3RhbnRGbGFnc1ttXSkpIHsKICAgICAgICAgICAgaWYgKF90aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLm1hc2tDb3VudHNbbV0gPiAwKSB7CiAgICAgICAgICAgICAgdmFyIGFkZEZpbHRlciA9IG5ldyBQSVhJLkZpbHRlcigpOwogICAgICAgICAgICAgIGFkZEZpbHRlci5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLkFERDsKICAgICAgICAgICAgICBfdGhpcy5fbWVzaGVzW21dLmZpbHRlcnMgPSBbYWRkRmlsdGVyXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpcy5fbWVzaGVzW21dLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuQUREOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKExpdmUyREN1YmlzbUNvcmUuVXRpbHMuaGFzQmxlbmRNdWx0aXBsaWNhdGl2ZUJpdChfdGhpcy5fY29yZU1vZGVsLmRyYXdhYmxlcy5jb25zdGFudEZsYWdzW21dKSkgewogICAgICAgICAgICBpZiAoX3RoaXMuX2NvcmVNb2RlbC5kcmF3YWJsZXMubWFza0NvdW50c1ttXSA+IDApIHsKICAgICAgICAgICAgICB2YXIgbXVsdGlwbHlGaWx0ZXIgPSBuZXcgUElYSS5GaWx0ZXIoKTsKICAgICAgICAgICAgICBtdWx0aXBseUZpbHRlci5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLk1VTFRJUExZOwogICAgICAgICAgICAgIF90aGlzLl9tZXNoZXNbbV0uZmlsdGVycyA9IFttdWx0aXBseUZpbHRlcl07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMuX21lc2hlc1ttXS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLk1VTFRJUExZOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMuYWRkQ2hpbGQoX3RoaXMuX21lc2hlc1ttXSk7CiAgICAgICAgfQoKICAgICAgICA7CiAgICAgICAgX3RoaXMuX21hc2tTcHJpdGVDb250YWluZXIgPSBuZXcgTWFza1Nwcml0ZUNvbnRhaW5lcihjb3JlTW9kZWwsIF90aGlzKTsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgIH0KCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICdwYXJhbWV0ZXJzJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmVNb2RlbC5wYXJhbWV0ZXJzOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICdwYXJ0cycsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9jb3JlTW9kZWwucGFydHM7CiAgICAgICAgfSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZGVsLnByb3RvdHlwZSwgJ2RyYXdhYmxlcycsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICdjYW52YXNpbmZvJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmVNb2RlbC5jYW52YXNpbmZvOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICd0ZXh0dXJlcycsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlczsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTW9kZWwucHJvdG90eXBlLCAnYW5pbWF0b3InLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0b3I7CiAgICAgICAgfSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZGVsLnByb3RvdHlwZSwgJ3VzZXJEYXRhJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICdtZXNoZXMnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fbWVzaGVzOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICdtYXNrcycsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXNrU3ByaXRlQ29udGFpbmVyOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICdncm91cHMnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXBzOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CgogICAgICBNb2RlbC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGRlbHRhKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIGRlbHRhVGltZSA9IDAuMDE2ICogZGVsdGE7CgogICAgICAgIHRoaXMuX2FuaW1hdG9yLnVwZGF0ZUFuZEV2YWx1YXRlKGRlbHRhVGltZSk7CgogICAgICAgIGlmICh0aGlzLl9waHlzaWNzUmlnKSB7CiAgICAgICAgICB0aGlzLl9waHlzaWNzUmlnLnVwZGF0ZUFuZEV2YWx1YXRlKGRlbHRhVGltZSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9jb3JlTW9kZWwudXBkYXRlKCk7CgogICAgICAgIHZhciBzb3J0ID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgdGhpcy5fbWVzaGVzLmxlbmd0aDsgKyttKSB7CiAgICAgICAgICB0aGlzLl9tZXNoZXNbbV0uYWxwaGEgPSB0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLm9wYWNpdGllc1ttXTsKICAgICAgICAgIHRoaXMuX21lc2hlc1ttXS52aXNpYmxlID0gTGl2ZTJEQ3ViaXNtQ29yZS5VdGlscy5oYXNJc1Zpc2libGVCaXQodGhpcy5fY29yZU1vZGVsLmRyYXdhYmxlcy5keW5hbWljRmxhZ3NbbV0pOwoKICAgICAgICAgIGlmIChMaXZlMkRDdWJpc21Db3JlLlV0aWxzLmhhc1ZlcnRleFBvc2l0aW9uc0RpZENoYW5nZUJpdCh0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLmR5bmFtaWNGbGFnc1ttXSkpIHsKICAgICAgICAgICAgdGhpcy5fbWVzaGVzW21dLnZlcnRpY2VzID0gdGhpcy5fY29yZU1vZGVsLmRyYXdhYmxlcy52ZXJ0ZXhQb3NpdGlvbnNbbV07CiAgICAgICAgICAgIHRoaXMuX21lc2hlc1ttXS5kaXJ0eVZlcnRleCA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKExpdmUyREN1YmlzbUNvcmUuVXRpbHMuaGFzUmVuZGVyT3JkZXJEaWRDaGFuZ2VCaXQodGhpcy5fY29yZU1vZGVsLmRyYXdhYmxlcy5keW5hbWljRmxhZ3NbbV0pKSB7CiAgICAgICAgICAgIHNvcnQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNvcnQpIHsKICAgICAgICAgIHRoaXMuY2hpbGRyZW4uc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICB2YXIgYUluZGV4ID0gX3RoaXMuX21lc2hlcy5pbmRleE9mKGEpOwoKICAgICAgICAgICAgdmFyIGJJbmRleCA9IF90aGlzLl9tZXNoZXMuaW5kZXhPZihiKTsKCiAgICAgICAgICAgIHZhciBhUmVuZGVyT3JkZXIgPSBfdGhpcy5fY29yZU1vZGVsLmRyYXdhYmxlcy5yZW5kZXJPcmRlcnNbYUluZGV4XTsKICAgICAgICAgICAgdmFyIGJSZW5kZXJPcmRlciA9IF90aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLnJlbmRlck9yZGVyc1tiSW5kZXhdOwogICAgICAgICAgICByZXR1cm4gYVJlbmRlck9yZGVyIC0gYlJlbmRlck9yZGVyOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLnJlc2V0RHluYW1pY0ZsYWdzKCk7CiAgICAgIH07CgogICAgICBNb2RlbC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgaWYgKHRoaXMuX2NvcmVNb2RlbCAhPT0gbnVsbCkgewogICAgICAgICAgdGhpcy5fY29yZU1vZGVsLnJlbGVhc2UoKTsKICAgICAgICB9CgogICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgICB0aGlzLm1hc2tzLmRlc3Ryb3koKTsKCiAgICAgICAgdGhpcy5fbWVzaGVzLmZvckVhY2goZnVuY3Rpb24gKG0pIHsKICAgICAgICAgIG0uZGVzdHJveSgpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAob3B0aW9ucyA9PT0gdHJ1ZSB8fCBvcHRpb25zLnRleHR1cmUpIHsKICAgICAgICAgIHRoaXMuX3RleHR1cmVzLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdC5kZXN0cm95KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBNb2RlbC5wcm90b3R5cGUuZ2V0TW9kZWxNZXNoQnlJZCA9IGZ1bmN0aW9uIChpZCkgewogICAgICAgIGlmICh0aGlzLl9tZXNoZXMgPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fbWVzaGVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgdmFyIG1lc2ggPSBfYVtfaV07CgogICAgICAgICAgaWYgKG1lc2gubmFtZSA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIG1lc2g7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfTsKCiAgICAgIE1vZGVsLnByb3RvdHlwZS5hZGRQYXJhbWV0ZXJWYWx1ZUJ5SWQgPSBmdW5jdGlvbiAoaWQsIHZhbHVlKSB7CiAgICAgICAgdmFyIHAgPSB0aGlzLl9jb3JlTW9kZWwucGFyYW1ldGVycy5pZHMuaW5kZXhPZihpZCk7CgogICAgICAgIGlmIChwID09PSAtMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fY29yZU1vZGVsLnBhcmFtZXRlcnMudmFsdWVzW3BdID0gdGhpcy5fY29yZU1vZGVsLnBhcmFtZXRlcnMudmFsdWVzW3BdICsgdmFsdWU7CiAgICAgIH07CgogICAgICBNb2RlbC5fY3JlYXRlID0gZnVuY3Rpb24gKGNvcmVNb2RlbCwgdGV4dHVyZXMsIGFuaW1hdG9yLCBwaHlzaWNzUmlnLCB1c2VyRGF0YSwgZ3JvdXBzKSB7CiAgICAgICAgaWYgKHBoeXNpY3NSaWcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcGh5c2ljc1JpZyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAodXNlckRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdXNlckRhdGEgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKGdyb3VwcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBncm91cHMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1vZGVsID0gbmV3IE1vZGVsKGNvcmVNb2RlbCwgdGV4dHVyZXMsIGFuaW1hdG9yLCBwaHlzaWNzUmlnLCB1c2VyRGF0YSwgZ3JvdXBzKTsKCiAgICAgICAgaWYgKCFtb2RlbC5pc1ZhbGlkKSB7CiAgICAgICAgICBtb2RlbC5kZXN0cm95KCk7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtb2RlbDsKICAgICAgfTsKCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2RlbC5wcm90b3R5cGUsICdpc1ZhbGlkJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmVNb2RlbCAhPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybiBNb2RlbDsKICAgIH0oUElYSS5Db250YWluZXIpOwoKICAgIExJVkUyRENVQklTTVBJWEkuTW9kZWwgPSBNb2RlbDsKCiAgICB2YXIgTWFza1Nwcml0ZUNvbnRhaW5lciA9IGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgX19leHRlbmRzKE1hc2tTcHJpdGVDb250YWluZXIsIF9zdXBlcik7CgogICAgICBmdW5jdGlvbiBNYXNrU3ByaXRlQ29udGFpbmVyKGNvcmVNb2RlbCwgcGl4aU1vZGVsKSB7CiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKCiAgICAgICAgX3RoaXMuX21hc2tTaGFkZXJWZXJ0U3JjID0gJ1xuICAgICAgICAgICAgYXR0cmlidXRlIHZlYzIgYVZlcnRleFBvc2l0aW9uO1xuICAgICAgICAgICAgYXR0cmlidXRlIHZlYzIgYVRleHR1cmVDb29yZDtcbiAgICAgICAgICAgIHVuaWZvcm0gbWF0MyBwcm9qZWN0aW9uTWF0cml4O1xuICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZUZXh0dXJlQ29vcmQ7XG4gICAgICAgICAgICB2b2lkIG1haW4odm9pZCl7XG4gICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSB2ZWM0KChwcm9qZWN0aW9uTWF0cml4ICogdmVjMyhhVmVydGV4UG9zaXRpb24sIDEuMCkpLnh5LCAwLjAsIDEuMCk7XG4gICAgICAgICAgICAgICAgdlRleHR1cmVDb29yZCA9IGFUZXh0dXJlQ29vcmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAnOwogICAgICAgIF90aGlzLl9tYXNrU2hhZGVyRnJhZ1NyYyA9ICdcbiAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2VGV4dHVyZUNvb3JkO1xuICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVNhbXBsZXI7XG4gICAgICAgICAgICB2b2lkIG1haW4odm9pZCl7XG4gICAgICAgICAgICAgICAgdmVjNCBjID0gdGV4dHVyZTJEKHVTYW1wbGVyLCB2VGV4dHVyZUNvb3JkKTtcbiAgICAgICAgICAgICAgICBjLnIgPSBjLmE7XG4gICAgICAgICAgICAgICAgYy5nID0gMC4wO1xuICAgICAgICAgICAgICAgIGMuYiA9IDAuMDtcbiAgICAgICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSBjO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJzsKICAgICAgICBfdGhpcy5fbWFza1NoYWRlciA9IG5ldyBQSVhJLkZpbHRlcihfdGhpcy5fbWFza1NoYWRlclZlcnRTcmMudG9TdHJpbmcoKSwgX3RoaXMuX21hc2tTaGFkZXJGcmFnU3JjLnRvU3RyaW5nKCkpOwogICAgICAgIHZhciBfbWFza0NvdW50cyA9IGNvcmVNb2RlbC5kcmF3YWJsZXMubWFza0NvdW50czsKICAgICAgICB2YXIgX21hc2tSZWxhdGlvbkxpc3QgPSBjb3JlTW9kZWwuZHJhd2FibGVzLm1hc2tzOwogICAgICAgIF90aGlzLl9tYXNrTWVzaENvbnRhaW5lcnMgPSBbXTsKICAgICAgICBfdGhpcy5fbWFza1RleHR1cmVzID0gW107CiAgICAgICAgX3RoaXMuX21hc2tTcHJpdGVzID0gW107CgogICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgcGl4aU1vZGVsLm1lc2hlcy5sZW5ndGg7ICsrbSkgewogICAgICAgICAgaWYgKF9tYXNrQ291bnRzW21dID4gMCkgewogICAgICAgICAgICB2YXIgbmV3Q29udGFpbmVyID0gbmV3IFBJWEkuQ29udGFpbmVyKCk7CgogICAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IF9tYXNrUmVsYXRpb25MaXN0W21dLmxlbmd0aDsgKytuKSB7CiAgICAgICAgICAgICAgdmFyIG1lc2hNYXNrSUQgPSBjb3JlTW9kZWwuZHJhd2FibGVzLm1hc2tzW21dW25dOwogICAgICAgICAgICAgIHZhciBtYXNrTWVzaCA9IG5ldyBDdWJpc21NZXNoKHBpeGlNb2RlbC5tZXNoZXNbbWVzaE1hc2tJRF0udGV4dHVyZSwgcGl4aU1vZGVsLm1lc2hlc1ttZXNoTWFza0lEXS52ZXJ0aWNlcywgcGl4aU1vZGVsLm1lc2hlc1ttZXNoTWFza0lEXS51dnMsIHBpeGlNb2RlbC5tZXNoZXNbbWVzaE1hc2tJRF0uaW5kaWNlcywgUElYSS5EUkFXX01PREVTLlRSSUFOR0xFUyk7CiAgICAgICAgICAgICAgbWFza01lc2gubmFtZSA9IHBpeGlNb2RlbC5tZXNoZXNbbWVzaE1hc2tJRF0ubmFtZTsKICAgICAgICAgICAgICBtYXNrTWVzaC50cmFuc2Zvcm0gPSBwaXhpTW9kZWwubWVzaGVzW21lc2hNYXNrSURdLnRyYW5zZm9ybTsKICAgICAgICAgICAgICBtYXNrTWVzaC53b3JsZFRyYW5zZm9ybSA9IHBpeGlNb2RlbC5tZXNoZXNbbWVzaE1hc2tJRF0ud29ybGRUcmFuc2Zvcm07CiAgICAgICAgICAgICAgbWFza01lc2gubG9jYWxUcmFuc2Zvcm0gPSBwaXhpTW9kZWwubWVzaGVzW21lc2hNYXNrSURdLmxvY2FsVHJhbnNmb3JtOwogICAgICAgICAgICAgIG1hc2tNZXNoLmlzQ3VsbGluZyA9IHBpeGlNb2RlbC5tZXNoZXNbbWVzaE1hc2tJRF0uaXNDdWxsaW5nOwogICAgICAgICAgICAgIG1hc2tNZXNoLmlzTWFza01lc2ggPSB0cnVlOwogICAgICAgICAgICAgIG1hc2tNZXNoLmZpbHRlcnMgPSBbX3RoaXMuX21hc2tTaGFkZXJdOwogICAgICAgICAgICAgIG5ld0NvbnRhaW5lci5hZGRDaGlsZChtYXNrTWVzaCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5ld0NvbnRhaW5lci50cmFuc2Zvcm0gPSBwaXhpTW9kZWwudHJhbnNmb3JtOwogICAgICAgICAgICBuZXdDb250YWluZXIud29ybGRUcmFuc2Zvcm0gPSBwaXhpTW9kZWwud29ybGRUcmFuc2Zvcm07CiAgICAgICAgICAgIG5ld0NvbnRhaW5lci5sb2NhbFRyYW5zZm9ybSA9IHBpeGlNb2RlbC5sb2NhbFRyYW5zZm9ybTsKCiAgICAgICAgICAgIF90aGlzLl9tYXNrTWVzaENvbnRhaW5lcnMucHVzaChuZXdDb250YWluZXIpOwoKICAgICAgICAgICAgdmFyIG5ld1RleHR1cmUgPSBQSVhJLlJlbmRlclRleHR1cmUuY3JlYXRlKDAsIDApOwoKICAgICAgICAgICAgX3RoaXMuX21hc2tUZXh0dXJlcy5wdXNoKG5ld1RleHR1cmUpOwoKICAgICAgICAgICAgdmFyIG5ld1Nwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZShuZXdUZXh0dXJlKTsKCiAgICAgICAgICAgIF90aGlzLl9tYXNrU3ByaXRlcy5wdXNoKG5ld1Nwcml0ZSk7CgogICAgICAgICAgICBfdGhpcy5hZGRDaGlsZChuZXdTcHJpdGUpOwoKICAgICAgICAgICAgcGl4aU1vZGVsLm1lc2hlc1ttXS5tYXNrID0gbmV3U3ByaXRlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICB9CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWFza1Nwcml0ZUNvbnRhaW5lci5wcm90b3R5cGUsICdtYXNrU3ByaXRlcycsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXNrU3ByaXRlczsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWFza1Nwcml0ZUNvbnRhaW5lci5wcm90b3R5cGUsICdtYXNrTWVzaGVzJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX21hc2tNZXNoQ29udGFpbmVyczsKICAgICAgICB9LAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgTWFza1Nwcml0ZUNvbnRhaW5lci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5fbWFza1Nwcml0ZXMuZm9yRWFjaChmdW5jdGlvbiAobSkgewogICAgICAgICAgbS5kZXN0cm95KCk7CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuX21hc2tUZXh0dXJlcy5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICBtLmRlc3Ryb3koKTsKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5fbWFza01lc2hDb250YWluZXJzLmZvckVhY2goZnVuY3Rpb24gKG0pIHsKICAgICAgICAgIG0uZGVzdHJveSgpOwogICAgICAgIH0pOwoKICAgICAgICB0aGlzLl9tYXNrU2hhZGVyID0gbnVsbDsKICAgICAgfTsKCiAgICAgIE1hc2tTcHJpdGVDb250YWluZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChhcHBSZW5kZXJlcikgewogICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgdGhpcy5fbWFza1Nwcml0ZXMubGVuZ3RoOyArK20pIHsKICAgICAgICAgIGFwcFJlbmRlcmVyLnJlbmRlcih0aGlzLl9tYXNrTWVzaENvbnRhaW5lcnNbbV0sIHRoaXMuX21hc2tUZXh0dXJlc1ttXSwgdHJ1ZSwgbnVsbCwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIE1hc2tTcHJpdGVDb250YWluZXIucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uICh2aWV3V2lkdGgsIHZpZXdIZWlnaHQpIHsKICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IHRoaXMuX21hc2tUZXh0dXJlcy5sZW5ndGg7ICsrbSkgewogICAgICAgICAgdGhpcy5fbWFza1RleHR1cmVzW21dLnJlc2l6ZSh2aWV3V2lkdGgsIHZpZXdIZWlnaHQsIGZhbHNlKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gTWFza1Nwcml0ZUNvbnRhaW5lcjsKICAgIH0oUElYSS5Db250YWluZXIpOwoKICAgIExJVkUyRENVQklTTVBJWEkuTWFza1Nwcml0ZUNvbnRhaW5lciA9IE1hc2tTcHJpdGVDb250YWluZXI7CgogICAgdmFyIE1vZGVsQnVpbGRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gTW9kZWxCdWlsZGVyKCkgewogICAgICAgIHRoaXMuX3RleHR1cmVzID0gW107CiAgICAgICAgdGhpcy5fdGltZVNjYWxlID0gMTsKICAgICAgICB0aGlzLl9hbmltYXRvckJ1aWxkZXIgPSBuZXcgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkFuaW1hdG9yQnVpbGRlcigpOwogICAgICB9CgogICAgICBNb2RlbEJ1aWxkZXIucHJvdG90eXBlLnNldE1vYyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHRoaXMuX21vYyA9IHZhbHVlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwoKICAgICAgTW9kZWxCdWlsZGVyLnByb3RvdHlwZS5zZXRUaW1lU2NhbGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB0aGlzLl90aW1lU2NhbGUgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKCiAgICAgIE1vZGVsQnVpbGRlci5wcm90b3R5cGUuc2V0UGh5c2ljczNKc29uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKCF0aGlzLl9waHlzaWNzUmlnQnVpbGRlcikgewogICAgICAgICAgdGhpcy5fcGh5c2ljc1JpZ0J1aWxkZXIgPSBuZXcgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlBoeXNpY3NSaWdCdWlsZGVyKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9waHlzaWNzUmlnQnVpbGRlci5zZXRQaHlzaWNzM0pzb24odmFsdWUpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKCiAgICAgIE1vZGVsQnVpbGRlci5wcm90b3R5cGUuc2V0VXNlckRhdGEzSnNvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIGlmICghdGhpcy5fdXNlckRhdGFCdWlsZGVyKSB7CiAgICAgICAgICB0aGlzLl91c2VyRGF0YUJ1aWxkZXIgPSBuZXcgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLlVzZXJEYXRhQnVpbGRlcigpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fdXNlckRhdGFCdWlsZGVyLnNldFVzZXJEYXRhM0pzb24odmFsdWUpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKCiAgICAgIE1vZGVsQnVpbGRlci5wcm90b3R5cGUuYWRkVGV4dHVyZSA9IGZ1bmN0aW9uIChpbmRleCwgdGV4dHVyZSkgewogICAgICAgIHRoaXMuX3RleHR1cmVzLnNwbGljZShpbmRleCwgMCwgdGV4dHVyZSk7CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwoKICAgICAgTW9kZWxCdWlsZGVyLnByb3RvdHlwZS5hZGRBbmltYXRvckxheWVyID0gZnVuY3Rpb24gKG5hbWUsIGJsZW5kZXIsIHdlaWdodCkgewogICAgICAgIGlmIChibGVuZGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGJsZW5kZXIgPSBMSVZFMkRDVUJJU01GUkFNRVdPUksuQnVpbHRpbkFuaW1hdGlvbkJsZW5kZXJzLk9WRVJSSURFOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdlaWdodCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB3ZWlnaHQgPSAxOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fYW5pbWF0b3JCdWlsZGVyLmFkZExheWVyKG5hbWUsIGJsZW5kZXIsIHdlaWdodCk7CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwoKICAgICAgTW9kZWxCdWlsZGVyLnByb3RvdHlwZS5hZGRHcm91cHMgPSBmdW5jdGlvbiAoZ3JvdXBzKSB7CiAgICAgICAgdGhpcy5fZ3JvdXBzID0gZ3JvdXBzOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwoKICAgICAgTW9kZWxCdWlsZGVyLnByb3RvdHlwZS5idWlsZEZyb21Nb2RlbDNKc29uID0gZnVuY3Rpb24gKGxvYWRlciwgbW9kZWwzT2JqLCBjYWxsYmFja0Z1bmMpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB2YXIgbW9kZWwzVVJMID0gbW9kZWwzT2JqLnVybDsKICAgICAgICB2YXIgbW9kZWxEaXIgPSBtb2RlbDNVUkwuc3Vic3RyaW5nKDAsIG1vZGVsM1VSTC5sYXN0SW5kZXhPZignLycpICsgMSk7CiAgICAgICAgdmFyIHRleHR1cmVDb3VudCA9IDA7CgogICAgICAgIGlmICh0eXBlb2YgbW9kZWwzT2JqLmRhdGEuRmlsZVJlZmVyZW5jZXMuTW9jICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgbG9hZGVyLmFkZCgnbW9jJywgbW9kZWxEaXIgKyBtb2RlbDNPYmouZGF0YS5GaWxlUmVmZXJlbmNlcy5Nb2MsIHsKICAgICAgICAgICAgeGhyVHlwZTogUElYSS5sb2FkZXJzLlJlc291cmNlLlhIUl9SRVNQT05TRV9UWVBFLkJVRkZFUgogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIG1vZGVsM09iai5kYXRhLkZpbGVSZWZlcmVuY2VzLlRleHR1cmVzICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgbW9kZWwzT2JqLmRhdGEuRmlsZVJlZmVyZW5jZXMuVGV4dHVyZXMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgICAgICBsb2FkZXIuYWRkKCd0ZXh0dXJlJyArIHRleHR1cmVDb3VudCwgbW9kZWxEaXIgKyBlbGVtZW50KTsKICAgICAgICAgICAgdGV4dHVyZUNvdW50Kys7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgbW9kZWwzT2JqLmRhdGEuRmlsZVJlZmVyZW5jZXMuUGh5c2ljcyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIGxvYWRlci5hZGQoJ3BoeXNpY3MnLCBtb2RlbERpciArIG1vZGVsM09iai5kYXRhLkZpbGVSZWZlcmVuY2VzLlBoeXNpY3MsIHsKICAgICAgICAgICAgeGhyVHlwZTogUElYSS5sb2FkZXJzLlJlc291cmNlLlhIUl9SRVNQT05TRV9UWVBFLkpTT04KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBtb2RlbDNPYmouZGF0YS5GaWxlUmVmZXJlbmNlcy5Vc2VyRGF0YSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIGxvYWRlci5hZGQoJ3VzZXJkYXRhJywgbW9kZWxEaXIgKyBtb2RlbDNPYmouZGF0YS5GaWxlUmVmZXJlbmNlcy5Vc2VyRGF0YSwgewogICAgICAgICAgICB4aHJUeXBlOiBQSVhJLmxvYWRlcnMuUmVzb3VyY2UuWEhSX1JFU1BPTlNFX1RZUEUuSlNPTgogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIG1vZGVsM09iai5kYXRhLkdyb3VwcyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHRoaXMuX2dyb3VwcyA9IExJVkUyRENVQklTTUZSQU1FV09SSy5Hcm91cHMuZnJvbU1vZGVsM0pzb24obW9kZWwzT2JqLmRhdGEpOwogICAgICAgIH0KCiAgICAgICAgbG9hZGVyLmxvYWQoZnVuY3Rpb24gKGxvYWRlciwgcmVzb3VyY2VzKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHJlc291cmNlcy5tb2MgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIF90aGlzLnNldE1vYyhMaXZlMkRDdWJpc21Db3JlLk1vYy5mcm9tQXJyYXlCdWZmZXIocmVzb3VyY2VzLm1vYy5kYXRhKSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHR5cGVvZiByZXNvdXJjZXNbJ3RleHR1cmUnICsgMF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dHVyZUNvdW50OyBpKyspIHsKICAgICAgICAgICAgICBfdGhpcy5hZGRUZXh0dXJlKGksIHJlc291cmNlc1sndGV4dHVyZScgKyBpXS50ZXh0dXJlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0eXBlb2YgcmVzb3VyY2VzLnBoeXNpY3MgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIF90aGlzLnNldFBoeXNpY3MzSnNvbihyZXNvdXJjZXMucGh5c2ljcy5kYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodHlwZW9mIHJlc291cmNlcy51c2VyZGF0YSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgX3RoaXMuc2V0VXNlckRhdGEzSnNvbihyZXNvdXJjZXMudXNlcmRhdGEuZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG1vZGVsID0gX3RoaXMuYnVpbGQoKTsKCiAgICAgICAgICBjYWxsYmFja0Z1bmMobW9kZWwpOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgTW9kZWxCdWlsZGVyLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgY29yZU1vZGVsID0gTGl2ZTJEQ3ViaXNtQ29yZS5Nb2RlbC5mcm9tTW9jKHRoaXMuX21vYyk7CgogICAgICAgIGlmIChjb3JlTW9kZWwgPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICB2YXIgYW5pbWF0b3IgPSB0aGlzLl9hbmltYXRvckJ1aWxkZXIuc2V0VGFyZ2V0KGNvcmVNb2RlbCkuc2V0VGltZVNjYWxlKHRoaXMuX3RpbWVTY2FsZSkuYnVpbGQoKTsKCiAgICAgICAgdmFyIHBoeXNpY3NSaWcgPSBudWxsOwoKICAgICAgICBpZiAodGhpcy5fcGh5c2ljc1JpZ0J1aWxkZXIpIHsKICAgICAgICAgIHBoeXNpY3NSaWcgPSB0aGlzLl9waHlzaWNzUmlnQnVpbGRlci5zZXRUYXJnZXQoY29yZU1vZGVsKS5zZXRUaW1lU2NhbGUodGhpcy5fdGltZVNjYWxlKS5idWlsZCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHVzZXJEYXRhID0gbnVsbDsKCiAgICAgICAgaWYgKHRoaXMuX3VzZXJEYXRhQnVpbGRlcikgewogICAgICAgICAgdXNlckRhdGEgPSB0aGlzLl91c2VyRGF0YUJ1aWxkZXIuc2V0VGFyZ2V0KGNvcmVNb2RlbCkuYnVpbGQoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBNb2RlbC5fY3JlYXRlKGNvcmVNb2RlbCwgdGhpcy5fdGV4dHVyZXMsIGFuaW1hdG9yLCBwaHlzaWNzUmlnLCB1c2VyRGF0YSwgdGhpcy5fZ3JvdXBzKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBNb2RlbEJ1aWxkZXI7CiAgICB9KCk7CgogICAgTElWRTJEQ1VCSVNNUElYSS5Nb2RlbEJ1aWxkZXIgPSBNb2RlbEJ1aWxkZXI7CgogICAgdmFyIEN1YmlzbU1lc2ggPSBmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgIF9fZXh0ZW5kcyhDdWJpc21NZXNoLCBfc3VwZXIpOwoKICAgICAgZnVuY3Rpb24gQ3ViaXNtTWVzaCgpIHsKICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCiAgICAgICAgX3RoaXMuaXNDdWxsaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMuaXNNYXNrTWVzaCA9IGZhbHNlOwogICAgICAgIHJldHVybiBfdGhpczsKICAgICAgfQoKICAgICAgQ3ViaXNtTWVzaC5wcm90b3R5cGUuX3JlbmRlcldlYkdMID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7CiAgICAgICAgaWYgKHRoaXMuaXNNYXNrTWVzaCA9PT0gdHJ1ZSkgewogICAgICAgICAgcmVuZGVyZXIuc3RhdGUuc2V0RnJvbnRGYWNlKDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZW5kZXJlci5zdGF0ZS5zZXRGcm9udEZhY2UoMCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5pc0N1bGxpbmcgPT09IHRydWUpIHsKICAgICAgICAgIHJlbmRlcmVyLnN0YXRlLnNldEN1bGxGYWNlKDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZW5kZXJlci5zdGF0ZS5zZXRDdWxsRmFjZSgwKTsKICAgICAgICB9CgogICAgICAgIF9zdXBlci5wcm90b3R5cGUuX3JlbmRlcldlYkdMLmNhbGwodGhpcywgcmVuZGVyZXIpOwoKICAgICAgICByZW5kZXJlci5zdGF0ZS5zZXRGcm9udEZhY2UoMCk7CiAgICAgIH07CgogICAgICByZXR1cm4gQ3ViaXNtTWVzaDsKICAgIH0oUElYSS5tZXNoLk1lc2gpOwoKICAgIExJVkUyRENVQklTTVBJWEkuQ3ViaXNtTWVzaCA9IEN1YmlzbU1lc2g7CiAgfSkoTElWRTJEQ1VCSVNNUElYSSB8fCAoTElWRTJEQ1VCSVNNUElYSSA9IHt9KSk7CgogIHZhciBMMkQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIEwyRChiYXNlUGF0aCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTDJEKTsKCiAgICAgIHRoaXMuYmFzZVBhdGggPSBiYXNlUGF0aDsKICAgICAgdGhpcy5sb2FkZXIgPSBuZXcgUElYSS5sb2FkZXJzLkxvYWRlcih0aGlzLmJhc2VQYXRoKTsKICAgICAgdGhpcy5hbmltYXRvckJ1aWxkZXIgPSBuZXcgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkFuaW1hdG9yQnVpbGRlcigpOwogICAgICB0aGlzLnRpbWVTY2FsZSA9IDE7CiAgICAgIHRoaXMubW9kZWxzID0ge307CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKEwyRCwgW3sKICAgICAga2V5OiAic2V0UGh5c2ljczNKc29uIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldFBoeXNpY3MzSnNvbih2YWx1ZSkgewogICAgICAgIGlmICghdGhpcy5waHlzaWNzUmlnQnVpbGRlcikgewogICAgICAgICAgdGhpcy5waHlzaWNzUmlnQnVpbGRlciA9IG5ldyBMSVZFMkRDVUJJU01GUkFNRVdPUksuUGh5c2ljc1JpZ0J1aWxkZXIoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGh5c2ljc1JpZ0J1aWxkZXIuc2V0UGh5c2ljczNKc29uKHZhbHVlKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJsb2FkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWQobmFtZSwgdikgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICBpZiAoIXRoaXMubW9kZWxzW25hbWVdKSB7CiAgICAgICAgICB2YXIgbW9kZWxEaXIgPSBuYW1lICsgJy8nOwogICAgICAgICAgdmFyIG1vZGVsUGF0aCA9IG5hbWUgKyAnLm1vZGVsMy5qc29uJzsKICAgICAgICAgIHZhciB0ZXh0dXJlcyA9IFtdOwogICAgICAgICAgdmFyIHRleHR1cmVDb3VudCA9IDA7CiAgICAgICAgICB2YXIgbW90aW9uTmFtZXMgPSBbXTsKICAgICAgICAgIHZhciBtb2RlbE5hbWVzID0gW107IC8vIGlmICghbW9kZWxOYW1lcy5pbmNsdWRlcyhuYW1lKydfbW9kZWwnKSl7CgogICAgICAgICAgdGhpcy5sb2FkZXIuYWRkKG5hbWUgKyAnX21vZGVsJywgbW9kZWxEaXIgKyBtb2RlbFBhdGgsIHsKICAgICAgICAgICAgeGhyVHlwZTogUElYSS5sb2FkZXJzLlJlc291cmNlLlhIUl9SRVNQT05TRV9UWVBFLkpTT04KICAgICAgICAgIH0pOwogICAgICAgICAgbW9kZWxOYW1lcy5wdXNoKG5hbWUgKyAnX21vZGVsJyk7IC8vIH0KCiAgICAgICAgICB0aGlzLmxvYWRlci5sb2FkKGZ1bmN0aW9uIChsb2FkZXIsIHJlc291cmNlcykgewogICAgICAgICAgICB2YXIgbW9kZWwzT2JqID0gcmVzb3VyY2VzW25hbWUgKyAnX21vZGVsJ10uZGF0YTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgbW9kZWwzT2JqLkZpbGVSZWZlcmVuY2VzLk1vYyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICBsb2FkZXIuYWRkKG5hbWUgKyAnX21vYycsIG1vZGVsRGlyICsgbW9kZWwzT2JqLkZpbGVSZWZlcmVuY2VzLk1vYywgewogICAgICAgICAgICAgICAgeGhyVHlwZTogUElYSS5sb2FkZXJzLlJlc291cmNlLlhIUl9SRVNQT05TRV9UWVBFLkJVRkZFUgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIG1vZGVsM09iai5GaWxlUmVmZXJlbmNlcy5UZXh0dXJlcyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICBtb2RlbDNPYmouRmlsZVJlZmVyZW5jZXMuVGV4dHVyZXMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgICAgICAgICAgbG9hZGVyLmFkZChuYW1lICsgJ190ZXh0dXJlJyArIHRleHR1cmVDb3VudCwgbW9kZWxEaXIgKyBlbGVtZW50KTsKICAgICAgICAgICAgICAgIHRleHR1cmVDb3VudCsrOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIG1vZGVsM09iai5GaWxlUmVmZXJlbmNlcy5QaHlzaWNzICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIGxvYWRlci5hZGQobmFtZSArICdfcGh5c2ljcycsIG1vZGVsRGlyICsgbW9kZWwzT2JqLkZpbGVSZWZlcmVuY2VzLlBoeXNpY3MsIHsKICAgICAgICAgICAgICAgIHhoclR5cGU6IFBJWEkubG9hZGVycy5SZXNvdXJjZS5YSFJfUkVTUE9OU0VfVFlQRS5KU09OCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlb2YgbW9kZWwzT2JqLkZpbGVSZWZlcmVuY2VzLk1vdGlvbnMgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgZ3JvdXAgaW4gbW9kZWwzT2JqLkZpbGVSZWZlcmVuY2VzLk1vdGlvbnMpIHsKICAgICAgICAgICAgICAgIG1vZGVsM09iai5GaWxlUmVmZXJlbmNlcy5Nb3Rpb25zW2dyb3VwXS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgIHZhciBtb3Rpb25OYW1lID0gZWxlbWVudC5GaWxlLnNwbGl0KCcvJykucG9wKCkuc3BsaXQoJy4nKS5zaGlmdCgpOwoKICAgICAgICAgICAgICAgICAgaWYgKCFtb3Rpb25OYW1lcy5pbmNsdWRlcyhuYW1lICsgJ18nICsgbW90aW9uTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBsb2FkZXIuYWRkKG5hbWUgKyAnXycgKyBtb3Rpb25OYW1lLCBtb2RlbERpciArIGVsZW1lbnQuRmlsZSwgewogICAgICAgICAgICAgICAgICAgICAgeGhyVHlwZTogUElYSS5sb2FkZXJzLlJlc291cmNlLlhIUl9SRVNQT05TRV9UWVBFLkpTT04KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBtb3Rpb25OYW1lcy5wdXNoKG5hbWUgKyAnXycgKyBtb3Rpb25OYW1lKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IG5hbWUgKyAnXycgKyBtb3Rpb25OYW1lICsgU3RyaW5nKERhdGUubm93KCkpOwogICAgICAgICAgICAgICAgICAgIGxvYWRlci5hZGQobiwgbW9kZWxEaXIgKyBlbGVtZW50LkZpbGUsIHsKICAgICAgICAgICAgICAgICAgICAgIHhoclR5cGU6IFBJWEkubG9hZGVycy5SZXNvdXJjZS5YSFJfUkVTUE9OU0VfVFlQRS5KU09OCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgbW90aW9uTmFtZXMucHVzaChuYW1lICsgJ18nICsgbW90aW9uTmFtZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGdyb3VwcyA9IG51bGw7CgogICAgICAgICAgICBpZiAodHlwZW9mIG1vZGVsM09iai5Hcm91cHMgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgZ3JvdXBzID0gTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkdyb3Vwcy5mcm9tTW9kZWwzSnNvbihtb2RlbDNPYmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2FkZXIubG9hZChmdW5jdGlvbiAobCwgcikgewogICAgICAgICAgICAgIHZhciBtb2MgPSBudWxsOwoKICAgICAgICAgICAgICBpZiAodHlwZW9mIHJbbmFtZSArICdfbW9jJ10gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICBtb2MgPSBMaXZlMkRDdWJpc21Db3JlLk1vYy5mcm9tQXJyYXlCdWZmZXIocltuYW1lICsgJ19tb2MnXS5kYXRhKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgcltuYW1lICsgJ190ZXh0dXJlJyArIDBdICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0dXJlQ291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgICB0ZXh0dXJlcy5zcGxpY2UoaSwgMCwgcltuYW1lICsgJ190ZXh0dXJlJyArIGldLnRleHR1cmUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiByW25hbWUgKyAnX3BoeXNpY3MnXSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgIF90aGlzMi5zZXRQaHlzaWNzM0pzb24ocltuYW1lICsgJ19waHlzaWNzJ10uZGF0YSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbW90aW9ucyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICBtb3Rpb25OYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IGVsZW1lbnQuc3BsaXQobmFtZSArICdfJykucG9wKCk7CiAgICAgICAgICAgICAgICBtb3Rpb25zLnNldChuLCBMSVZFMkRDVUJJU01GUkFNRVdPUksuQW5pbWF0aW9uLmZyb21Nb3Rpb24zSnNvbihyW2VsZW1lbnRdLmRhdGEpKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBudWxsOwogICAgICAgICAgICAgIHZhciBjb3JlTW9kZWwgPSBMaXZlMkRDdWJpc21Db3JlLk1vZGVsLmZyb21Nb2MobW9jKTsKCiAgICAgICAgICAgICAgaWYgKGNvcmVNb2RlbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgYW5pbWF0b3IgPSBfdGhpczIuYW5pbWF0b3JCdWlsZGVyLnNldFRhcmdldChjb3JlTW9kZWwpLnNldFRpbWVTY2FsZShfdGhpczIudGltZVNjYWxlKS5idWlsZCgpOwoKICAgICAgICAgICAgICB2YXIgcGh5c2ljc1JpZyA9IF90aGlzMi5waHlzaWNzUmlnQnVpbGRlci5zZXRUYXJnZXQoY29yZU1vZGVsKS5zZXRUaW1lU2NhbGUoX3RoaXMyLnRpbWVTY2FsZSkuYnVpbGQoKTsKCiAgICAgICAgICAgICAgdmFyIHVzZXJEYXRhID0gbnVsbDsKICAgICAgICAgICAgICBtb2RlbCA9IExJVkUyRENVQklTTVBJWEkuTW9kZWwuX2NyZWF0ZShjb3JlTW9kZWwsIHRleHR1cmVzLCBhbmltYXRvciwgcGh5c2ljc1JpZywgdXNlckRhdGEsIGdyb3Vwcyk7CiAgICAgICAgICAgICAgbW9kZWwubW90aW9ucyA9IG1vdGlvbnM7CiAgICAgICAgICAgICAgX3RoaXMyLm1vZGVsc1tuYW1lXSA9IG1vZGVsOwogICAgICAgICAgICAgIHYuY2hhbmdlQ2FudmFzKG1vZGVsKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdi5jaGFuZ2VDYW52YXModGhpcy5tb2RlbHNbbmFtZV0pOwogICAgICAgIH0KICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBMMkQ7CiAgfSgpOwoKICB2YXIgTGl2ZTJkVjMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnMKICAgIGZ1bmN0aW9uIExpdmUyZFYzKF9yZWYpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgYmFzZVBhdGggPSBfcmVmLmJhc2VQYXRoLAogICAgICAgICAgbW9kZWxOYW1lID0gX3JlZi5tb2RlbE5hbWUsCiAgICAgICAgICBfcmVmJHdpZHRoID0gX3JlZi53aWR0aCwKICAgICAgICAgIHdpZHRoID0gX3JlZiR3aWR0aCA9PT0gdm9pZCAwID8gNTAwIDogX3JlZiR3aWR0aCwKICAgICAgICAgIF9yZWYkaGVpZ2h0ID0gX3JlZi5oZWlnaHQsCiAgICAgICAgICBoZWlnaHQgPSBfcmVmJGhlaWdodCA9PT0gdm9pZCAwID8gMzAwIDogX3JlZiRoZWlnaHQsCiAgICAgICAgICBlbCA9IF9yZWYuZWwsCiAgICAgICAgICBzaXplTGltaXQgPSBfcmVmLnNpemVMaW1pdCwKICAgICAgICAgIG1vYmlsZUxpbWl0ID0gX3JlZi5tb2JpbGVMaW1pdCwKICAgICAgICAgIHNvdW5kcyA9IF9yZWYuc291bmRzOwoKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExpdmUyZFYzKTsKCiAgICAgIGlmICh0eXBlb2YgTGl2ZTJEQ3ViaXNtQ29yZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdsaXZlMmR2MyBmYWlsZWQgdG8gbG9hZDpcbk1pc3NpbmcgbGl2ZTJkY3ViaXNtY29yZS5qc1xuUGxlYXNlIGFkZCAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL0hDTG9uZWx5L0xpdmUyZFYzL2pzL2xpdmUyZGN1YmlzbWNvcmUubWluLmpzIiB0byB0aGUgIjxzY3JpcHQ+IiB0YWcuXG5Mb29rIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9IQ0xvbmVseS9MaXZlMmRWMycpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBQSVhJID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ2xpdmUyZHYzIGZhaWxlZCB0byBsb2FkOlxuTWlzc2luZyBwaXhpLmpzXG5QbGVhc2UgYWRkICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3BpeGkuanNANC42LjEvZGlzdC9waXhpLm1pbi5qcyIgdG8gdGhlICI8c2NyaXB0PiIgdGFnLlxuTG9vayBhdCBodHRwczovL2dpdGh1Yi5jb20vSENMb25lbHkvTGl2ZTJkVjMnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghZWwpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCciZWwiIHBhcmFtZXRlciBpcyByZXF1aXJlZCcpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmlzRG9tKGVsKSkgewogICAgICAgIGlmIChlbC5sZW5ndGggPiAwKSB7CiAgICAgICAgICBpZiAodGhpcy5pc0RvbShlbFswXSkpIHsKICAgICAgICAgICAgZWwgPSBlbFswXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2xpdmUyZHYzIGZhaWxlZCB0byBsb2FkOlxuJywgZWxbMF0sICdpcyBub3QgYSBIVE1MRWxlbWVudCBvYmplY3QnKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdsaXZlMmR2MyBmYWlsZWQgdG8gbG9hZDpcbicsIGVsLCAnaXMgbm90IGEgSFRNTEVsZW1lbnQgb2JqZWN0Jyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc2l6ZUxpbWl0ICYmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPCB3aWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IDwgaGVpZ2h0KSkgcmV0dXJuOwogICAgICBpZiAobW9iaWxlTGltaXQgJiYgL01vYmlsZXxNYWMgT1N8QW5kcm9pZHxpUGhvbmV8aVBhZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHJldHVybjsKICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdMaXZlMmRWMzogbG9hZGluZyBtb2RlbCAiJyArIG1vZGVsTmFtZSArICciJyk7CiAgICAgIHRoaXMubDJkID0gbmV3IEwyRChiYXNlUGF0aCk7CiAgICAgIHRoaXMuY2FudmFzID0gZWw7CgogICAgICBpZiAobW9kZWxOYW1lKSB7CiAgICAgICAgdGhpcy5tb2RlbE5hbWUgPSBtb2RlbE5hbWU7CiAgICAgICAgdGhpcy5sMmQubG9hZChtb2RlbE5hbWUsIHRoaXMpOwogICAgICB9CgogICAgICB0aGlzLmFwcCA9IG5ldyBQSVhJLkFwcGxpY2F0aW9uKHdpZHRoLCBoZWlnaHQsIHsKICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5jYW52YXMuYXBwZW5kQ2hpbGQodGhpcy5hcHAudmlldyk7CiAgICAgIHRoaXMuYXBwLnRpY2tlci5hZGQoZnVuY3Rpb24gKGRlbHRhVGltZSkgewogICAgICAgIGlmICghX3RoaXMzLm1vZGVsKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpczMubW9kZWwudXBkYXRlKGRlbHRhVGltZSk7CgogICAgICAgIF90aGlzMy5tb2RlbC5tYXNrcy51cGRhdGUoX3RoaXMzLmFwcC5yZW5kZXJlcik7CiAgICAgIH0pOwoKICAgICAgd2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgaWYgKGV2ZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGV2ZW50ID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIF90aGlzMy5hcHAudmlldy5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4JzsKICAgICAgICBfdGhpczMuYXBwLnZpZXcuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JzsKCiAgICAgICAgX3RoaXMzLmFwcC5yZW5kZXJlci5yZXNpemUod2lkdGgsIGhlaWdodCk7CgogICAgICAgIGlmIChfdGhpczMubW9kZWwpIHsKICAgICAgICAgIF90aGlzMy5tb2RlbC5wb3NpdGlvbiA9IG5ldyBQSVhJLlBvaW50KHdpZHRoICogMC41LCBoZWlnaHQgKiAwLjUpOwogICAgICAgICAgX3RoaXMzLm1vZGVsLnNjYWxlID0gbmV3IFBJWEkuUG9pbnQoX3RoaXMzLm1vZGVsLnBvc2l0aW9uLnggKiAwLjA2LCBfdGhpczMubW9kZWwucG9zaXRpb24ueCAqIDAuMDYpOwoKICAgICAgICAgIF90aGlzMy5tb2RlbC5tYXNrcy5yZXNpemUoX3RoaXMzLmFwcC52aWV3LndpZHRoLCBfdGhpczMuYXBwLnZpZXcuaGVpZ2h0KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB0aGlzLmlzQ2xpY2sgPSBmYWxzZTsKICAgICAgdGhpcy5hcHAudmlldy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBfdGhpczMuaXNDbGljayA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLmFwcC52aWV3LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGlmIChfdGhpczMuaXNDbGljaykgewogICAgICAgICAgX3RoaXMzLmlzQ2xpY2sgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoX3RoaXMzLm1vZGVsKSB7CiAgICAgICAgICAgIF90aGlzMy5tb2RlbC5pbkRyYWcgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKF90aGlzMy5tb2RlbCkgewogICAgICAgICAgdmFyIG1vdXNlWCA9IF90aGlzMy5tb2RlbC5wb3NpdGlvbi54IC0gZXZlbnQub2Zmc2V0WDsKICAgICAgICAgIHZhciBtb3VzZVkgPSBfdGhpczMubW9kZWwucG9zaXRpb24ueSAtIGV2ZW50Lm9mZnNldFk7CiAgICAgICAgICBfdGhpczMubW9kZWwucG9pbnRlclggPSAtbW91c2VYIC8gX3RoaXMzLmFwcC52aWV3LmhlaWdodDsKICAgICAgICAgIF90aGlzMy5tb2RlbC5wb2ludGVyWSA9IC1tb3VzZVkgLyBfdGhpczMuYXBwLnZpZXcud2lkdGg7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5hcHAudmlldy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgaWYgKCFfdGhpczMubW9kZWwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChfdGhpczMuaXNDbGljaykgewogICAgICAgICAgaWYgKF90aGlzMy5pc0hpdCgnVG91Y2hIZWFkJywgZXZlbnQub2Zmc2V0WCwgZXZlbnQub2Zmc2V0WSkpIHsKICAgICAgICAgICAgX3RoaXMzLnN0YXJ0QW5pbWF0aW9uKCd0b3VjaF9oZWFkJywgJ2Jhc2UnKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMzLmlzSGl0KCdUb3VjaFNwZWNpYWwnLCBldmVudC5vZmZzZXRYLCBldmVudC5vZmZzZXRZKSkgewogICAgICAgICAgICBfdGhpczMuc3RhcnRBbmltYXRpb24oJ3RvdWNoX3NwZWNpYWwnLCAnYmFzZScpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGJvZHlNb3Rpb25zID0gWyd0b3VjaF9ib2R5JywgJ21haW5fMScsICdtYWluXzInLCAnbWFpbl8zJ107CiAgICAgICAgICAgIHZhciBjdXJyZW50TW90aW9uID0gYm9keU1vdGlvbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYm9keU1vdGlvbnMubGVuZ3RoKV07CgogICAgICAgICAgICBfdGhpczMuc3RhcnRBbmltYXRpb24oY3VycmVudE1vdGlvbiwgJ2Jhc2UnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc291bmRzICYmIHNvdW5kcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBzb3VuZEZpbGUgPSBzb3VuZHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc291bmRzLmxlbmd0aCldOwogICAgICAgICAgICB2YXIgZmlsZVBhdGggPSAvXmh0dHBzPzpcL1wvLy50ZXN0KHNvdW5kRmlsZSkgPyBzb3VuZEZpbGUgOiBbYmFzZVBhdGgsIG1vZGVsTmFtZSwgc291bmRGaWxlXS5qb2luKCcvJykucmVwbGFjZSgvKD88ITopXC9cLy9nLCAnLycpOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBIb3dsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIG5ldyBIb3dsKHsKICAgICAgICAgICAgICAgIHNyYzogW2ZpbGVQYXRoXQogICAgICAgICAgICAgIH0pLnBsYXkoKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgQXVkaW8gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgbmV3IEF1ZGlvKGZpbGVQYXRoKS5wbGF5KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ3VycmVudCBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgcGxheWluZyBzb3VuZC4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3RoaXMzLmlzQ2xpY2sgPSBmYWxzZTsKICAgICAgICBfdGhpczMubW9kZWwuaW5EcmFnID0gZmFsc2U7CiAgICAgIH0pOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhMaXZlMmRWMywgW3sKICAgICAga2V5OiAiY2hhbmdlQ2FudmFzIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNoYW5nZUNhbnZhcyhtb2RlbCkgewogICAgICAgIHRoaXMuYXBwLnN0YWdlLnJlbW92ZUNoaWxkcmVuKCk7CiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsOwogICAgICAgIHRoaXMubW9kZWwudXBkYXRlID0gdGhpcy5vblVwZGF0ZTsKICAgICAgICB0aGlzLm1vZGVsLmFuaW1hdG9yLmFkZExheWVyKCdiYXNlJywgTElWRTJEQ1VCSVNNRlJBTUVXT1JLLkJ1aWx0aW5BbmltYXRpb25CbGVuZGVycy5PVkVSUklERSwgMSk7CiAgICAgICAgdGhpcy5hcHAuc3RhZ2UuYWRkQ2hpbGQodGhpcy5tb2RlbCk7CiAgICAgICAgdGhpcy5hcHAuc3RhZ2UuYWRkQ2hpbGQodGhpcy5tb2RlbC5tYXNrcyk7CiAgICAgICAgd2luZG93Lm9ucmVzaXplKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAib25VcGRhdGUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gb25VcGRhdGUoZGVsdGEpIHsKICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgICAgdmFyIGRlbHRhVGltZSA9IDAuMDE2ICogZGVsdGE7CgogICAgICAgIGlmICghdGhpcy5hbmltYXRvci5pc1BsYXlpbmcpIHsKICAgICAgICAgIHZhciBtID0gdGhpcy5tb3Rpb25zLmdldCgnaWRsZScpOwogICAgICAgICAgdGhpcy5hbmltYXRvci5nZXRMYXllcignYmFzZScpLnBsYXkobSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9hbmltYXRvci51cGRhdGVBbmRFdmFsdWF0ZShkZWx0YVRpbWUpOwoKICAgICAgICBpZiAodGhpcy5pbkRyYWcpIHsKICAgICAgICAgIHRoaXMuYWRkUGFyYW1ldGVyVmFsdWVCeUlkKCdQYXJhbUFuZ2xlWCcsIHRoaXMucG9pbnRlclggKiAzMCk7CiAgICAgICAgICB0aGlzLmFkZFBhcmFtZXRlclZhbHVlQnlJZCgnUGFyYW1BbmdsZVknLCAtdGhpcy5wb2ludGVyWSAqIDMwKTsKICAgICAgICAgIHRoaXMuYWRkUGFyYW1ldGVyVmFsdWVCeUlkKCdQYXJhbUJvZHlBbmdsZVgnLCB0aGlzLnBvaW50ZXJYICogMTApOwogICAgICAgICAgdGhpcy5hZGRQYXJhbWV0ZXJWYWx1ZUJ5SWQoJ1BhcmFtQm9keUFuZ2xlWScsIC10aGlzLnBvaW50ZXJZICogMTApOwogICAgICAgICAgdGhpcy5hZGRQYXJhbWV0ZXJWYWx1ZUJ5SWQoJ1BhcmFtRXllQmFsbFgnLCB0aGlzLnBvaW50ZXJYKTsKICAgICAgICAgIHRoaXMuYWRkUGFyYW1ldGVyVmFsdWVCeUlkKCdQYXJhbUV5ZUJhbGxZJywgLXRoaXMucG9pbnRlclkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuX3BoeXNpY3NSaWcpIHsKICAgICAgICAgIHRoaXMuX3BoeXNpY3NSaWcudXBkYXRlQW5kRXZhbHVhdGUoZGVsdGFUaW1lKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2NvcmVNb2RlbC51cGRhdGUoKTsKCiAgICAgICAgdmFyIHNvcnQgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgX20gPSAwOyBfbSA8IHRoaXMuX21lc2hlcy5sZW5ndGg7ICsrX20pIHsKICAgICAgICAgIHRoaXMuX21lc2hlc1tfbV0uYWxwaGEgPSB0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLm9wYWNpdGllc1tfbV07CiAgICAgICAgICB0aGlzLl9tZXNoZXNbX21dLnZpc2libGUgPSBMaXZlMkRDdWJpc21Db3JlLlV0aWxzLmhhc0lzVmlzaWJsZUJpdCh0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLmR5bmFtaWNGbGFnc1tfbV0pOwoKICAgICAgICAgIGlmIChMaXZlMkRDdWJpc21Db3JlLlV0aWxzLmhhc1ZlcnRleFBvc2l0aW9uc0RpZENoYW5nZUJpdCh0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLmR5bmFtaWNGbGFnc1tfbV0pKSB7CiAgICAgICAgICAgIHRoaXMuX21lc2hlc1tfbV0udmVydGljZXMgPSB0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLnZlcnRleFBvc2l0aW9uc1tfbV07CiAgICAgICAgICAgIHRoaXMuX21lc2hlc1tfbV0uZGlydHlWZXJ0ZXggPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChMaXZlMkRDdWJpc21Db3JlLlV0aWxzLmhhc1JlbmRlck9yZGVyRGlkQ2hhbmdlQml0KHRoaXMuX2NvcmVNb2RlbC5kcmF3YWJsZXMuZHluYW1pY0ZsYWdzW19tXSkpIHsKICAgICAgICAgICAgc29ydCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc29ydCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHZhciBhSW5kZXggPSBfdGhpczQuX21lc2hlcy5pbmRleE9mKGEpOwoKICAgICAgICAgICAgdmFyIGJJbmRleCA9IF90aGlzNC5fbWVzaGVzLmluZGV4T2YoYik7CgogICAgICAgICAgICB2YXIgYVJlbmRlck9yZGVyID0gX3RoaXM0Ll9jb3JlTW9kZWwuZHJhd2FibGVzLnJlbmRlck9yZGVyc1thSW5kZXhdOwogICAgICAgICAgICB2YXIgYlJlbmRlck9yZGVyID0gX3RoaXM0Ll9jb3JlTW9kZWwuZHJhd2FibGVzLnJlbmRlck9yZGVyc1tiSW5kZXhdOwogICAgICAgICAgICByZXR1cm4gYVJlbmRlck9yZGVyIC0gYlJlbmRlck9yZGVyOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9jb3JlTW9kZWwuZHJhd2FibGVzLnJlc2V0RHluYW1pY0ZsYWdzKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic3RhcnRBbmltYXRpb24iLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc3RhcnRBbmltYXRpb24obW90aW9uSWQsIGxheWVySWQpIHsKICAgICAgICBpZiAoIXRoaXMubW9kZWwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBtID0gdGhpcy5tb2RlbC5tb3Rpb25zLmdldChtb3Rpb25JZCk7CgogICAgICAgIGlmICghbSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGwgPSB0aGlzLm1vZGVsLmFuaW1hdG9yLmdldExheWVyKGxheWVySWQpOwoKICAgICAgICBpZiAoIWwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGwucGxheShtKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJpc0hpdCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc0hpdChpZCwgcG9zWCwgcG9zWSkgewogICAgICAgIGlmICghdGhpcy5tb2RlbCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIG0gPSB0aGlzLm1vZGVsLmdldE1vZGVsTWVzaEJ5SWQoaWQpOwoKICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciB2ZXJ0ZXhPZmZzZXQgPSAwOwogICAgICAgIHZhciB2ZXJ0ZXhTdGVwID0gMjsKICAgICAgICB2YXIgdmVydGljZXMgPSBtLnZlcnRpY2VzOwogICAgICAgIHZhciBsZWZ0ID0gdmVydGljZXNbMF07CiAgICAgICAgdmFyIHJpZ2h0ID0gdmVydGljZXNbMF07CiAgICAgICAgdmFyIHRvcCA9IHZlcnRpY2VzWzFdOwogICAgICAgIHZhciBib3R0b20gPSB2ZXJ0aWNlc1sxXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCA0OyArK2kpIHsKICAgICAgICAgIHZhciB4ID0gdmVydGljZXNbdmVydGV4T2Zmc2V0ICsgaSAqIHZlcnRleFN0ZXBdOwogICAgICAgICAgdmFyIHkgPSB2ZXJ0aWNlc1t2ZXJ0ZXhPZmZzZXQgKyBpICogdmVydGV4U3RlcCArIDFdOwoKICAgICAgICAgIGlmICh4IDwgbGVmdCkgewogICAgICAgICAgICBsZWZ0ID0geDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoeCA+IHJpZ2h0KSB7CiAgICAgICAgICAgIHJpZ2h0ID0geDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoeSA8IHRvcCkgewogICAgICAgICAgICB0b3AgPSB5OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh5ID4gYm90dG9tKSB7CiAgICAgICAgICAgIGJvdHRvbSA9IHk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgbW91c2VYID0gbS53b3JsZFRyYW5zZm9ybS50eCAtIHBvc1g7CiAgICAgICAgdmFyIG1vdXNlWSA9IG0ud29ybGRUcmFuc2Zvcm0udHkgLSBwb3NZOwogICAgICAgIHZhciB0eCA9IC1tb3VzZVggLyBtLndvcmxkVHJhbnNmb3JtLmE7CiAgICAgICAgdmFyIHR5ID0gLW1vdXNlWSAvIG0ud29ybGRUcmFuc2Zvcm0uZDsKICAgICAgICByZXR1cm4gbGVmdCA8PSB0eCAmJiB0eCA8PSByaWdodCAmJiB0b3AgPD0gdHkgJiYgdHkgPD0gYm90dG9tOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImlzRG9tIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzRG9tKGUpIHsKICAgICAgICBpZiAoKHR5cGVvZiBIVE1MRWxlbWVudCA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoSFRNTEVsZW1lbnQpKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBlICYmIF90eXBlb2YoZSkgPT09ICdvYmplY3QnICYmIGUubm9kZVR5cGUgPT09IDEgJiYgdHlwZW9mIGUubm9kZU5hbWUgPT09ICdzdHJpbmcnOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJsb2FkTW9kZWwiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZE1vZGVsKG1vZGVsTmFtZSkgewogICAgICAgIHRoaXMubDJkLmxvYWQobW9kZWxOYW1lIHx8IHRoaXMubW9kZWxOYW1lLCB0aGlzKTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBMaXZlMmRWMzsKICB9KCk7CgogIHZhciBWRVJTSU9OID0gJzEuMi4yJzsKCiAgdmFyIF9hOwoKICBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2Nocm9tZScpID4gLTEpIHsKICAgIHZhciBhcmdzID0gWyJcblxuICAgICAgICVjICVjICVjIFx1MjczMCBMaXZlMmRWMyAiICsgVkVSU0lPTiArICIgXHUyNzMwICAlYyAgXG4lYyAgaHR0cHM6Ly9naXRodWIuY29tL0hDTG9uZWx5L0xpdmUyZFYzICAlY1xuXG4iLCAnYmFja2dyb3VuZDogI2ZmNjZhNTsgcGFkZGluZzo1cHggMDsnLCAnYmFja2dyb3VuZDogI2ZmNjZhNTsgcGFkZGluZzo1cHggMDsnLCAnY29sb3I6ICNmZjY2YTU7IGJhY2tncm91bmQ6ICMwMzAzMDc7IHBhZGRpbmc6NXB4IDA7JywgJ2JhY2tncm91bmQ6ICNmZjY2YTU7IHBhZGRpbmc6NXB4IDA7JywgJ2JhY2tncm91bmQ6ICNmZmMzZGM7IHBhZGRpbmc6NXB4IDA7JywgJ2JhY2tncm91bmQ6ICNmZjY2YTU7IHBhZGRpbmc6NXB4IDA7J107CgogICAgKF9hID0gd2luZG93LmNvbnNvbGUpLmxvZy5hcHBseShfYSwgYXJncyk7CiAgfSBlbHNlIGlmICh3aW5kb3cuY29uc29sZSkgewogICAgd2luZG93LmNvbnNvbGUubG9nKCdMaXZlMmRWMyAnICsgVkVSU0lPTiArICcgLSBodHRwczovL2dpdGh1Yi5jb20vSENMb25lbHkvTGl2ZTJkVjMnKTsKICB9CgogIHdpbmRvdy5sMmRWaWV3ZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgcmV0dXJuIG5ldyBMaXZlMmRWMyhvcHRpb25zKTsKICB9Owp9KSgpOw=="},{"version":3,"sources":["C:/Users/12503/Desktop/myblog/docs/.vuepress/plugins/live2d/bin/assets/js/live2dv3.js"],"names":["LIVE2DCUBISMFRAMEWORK","AnimationPoint","time","value","AnimationUserDataBody","BuiltinAnimationSegmentEvaluators","lerp","a","b","t","LINEAR","points","offset","p0","p1","BEZIER","p01","p12","p23","p012","p123","STEPPED","INVERSE_STEPPED","AnimationSegment","evaluate","AnimationTrack","targetId","segments","prototype","s","lastS","length","Animation","motion3Json","_this","modelTracks","parameterTracks","partOpacityTracks","userDataBodys","duration","Meta","Duration","fps","Fps","loop","Loop","userDataCount","UserDataCount","totalUserDataSize","TotalUserDataSize","UserData","forEach","u","push","Time","Value","console","assert","Curves","c","Segments","type","track","Id","Target","fromMotion3Json","animation","isValid","addAnimationCallback","callbackFunc","_callbackFunctions","removeAnimationCallback","_target","_index","splice","clearAnimationCallback","callAnimationCallback","func","weight","blend","target","stackFlags","groups","undefined","p","parameters","ids","indexOf","sample","values","defaultValues","parts","opacities","g","getGroupById","_i","_a","tid","ud","isEventTriggered","_lastTime","timeEvaluate","timeForward","timeBack","Object","defineProperty","get","enumerable","configurable","BuiltinCrossfadeWeighters","AnimationState","BuiltinAnimationBlenders","OVERRIDE","source","destination","initial","ADD","MULTIPLY","AnimationLayer","_animation","_time","set","_play","play","fadeDuration","_goalAnimation","_goalTime","_fadeTime","_fadeDuration","currentTime","resume","pause","stop","_update","deltaTime","_evaluate","animationWeight","weightCrossfade","Animator","timeScale","layers","_layers","ret","l","isPlaying","addLayer","name","blender","layer","getLayer","has","removeLayer","clearLayers","clear","updateAndEvaluate","paramStackFlags","Array","count","fill","partsStackFlags","_create","animator","AnimatorBuilder","_timeScale","_layerNames","_layerBlenders","_layerCrossfadeWeighters","_layerWeights","setTarget","setTimeScale","build","Map","PhysicsVector2","x","y","distance","Math","abs","substract","dot","sqrt","add","vector2","multiply","multiplyByScalar","scalar","divide","divideByScalar","rotateByRadians","radians","cos","sin","normalize","zero","Physics","clampScalar","lower","upper","directionToDegrees","from","to","directionToRadians","degrees","radiansToDegrees","PI","radiansToDirection","degreesToRadians","magnitude","cosTheta","acos","gravity","wind","maximumWeight","airResistance","movementThreshold","correctAngles","PhysicsParticle","initialPosition","mobility","delay","acceleration","radius","position","lastPosition","lastGravity","force","velocity","PhysicsFactorTuple","angle","factor","PhysicsNormalizationTuple","minimum","maximum","def","PhysicsNormalizationOptions","PhysicsInput","invert","evaluateFactor","parameterValue","parameterMinimum","parameterMaximum","parameterDefault","normalization","parameterMiddle","getMiddleValue","sign","parameterRange","normalizationRange","getRangeValue","min","max","maxValue","minValue","PhysicsOutput","particleIndex","angleScale","evaluateValue","translation","particles","parentGravity","angleResult","PhysicsSubRig","input","output","i","parameterIndex","minimumValues","maximumValues","xy","factorRadians","gravityDirection","direction","newDirection","o","unclampedParameterValue","normalizedWeight","PhysicsRig","physics3Json","_subRigs","PhysicsSettings","r","Input","Type","Source","Weight","Reflect","Output","Destination","VertexIndex","Scale","Vertices","Position","X","Y","Mobility","Delay","Acceleration","Radius","jsonOptions","Normalization","positionsOption","Minimum","Maximum","Default","anglesOption","Angle","_fromPhysics3Json","rig","_isValid","PhysicsRigBuilder","setPhysics3Json","_physics3Json","userData3Json","_version","Version","_userDataCount","_totalUserDataSize","_userDataBodys","UserDataBody","_fromUserData3Json","userdata","isExistUserDataById","id_","id","getUserDataValueById","getUserDataTargetById","getUserDataBodyById","UserDataBuilder","setUserData3Json","_userData3Json","UserDataTargetType","UNKNOWN","ArtMesh","Groups","model3Json","_groupBodys","GroupBody","Name","Ids","fromModel3Json","body","__extends","extendStatics","d","setPrototypeOf","__proto__","hasOwnProperty","__","constructor","create","LIVE2DCUBISMPIXI","Model","_super","coreModel","textures","physicsRig","userData","call","_coreModel","_textures","_animator","_physicsRig","_userData","_groups","_meshes","drawables","m","uvs","vertexUvs","slice","v","CubismMesh","textureIndices","vertexPositions","indices","PIXI","DRAW_MODES","TRIANGLES","scale","isCulling","Live2DCubismCore","Utils","hasIsDoubleSidedBit","constantFlags","hasBlendAdditiveBit","maskCounts","addFilter","Filter","blendMode","BLEND_MODES","filters","hasBlendMultiplicativeBit","multiplyFilter","addChild","_maskSpriteContainer","MaskSpriteContainer","canvasinfo","update","delta","sort","alpha","visible","hasIsVisibleBit","dynamicFlags","hasVertexPositionsDidChangeBit","vertices","dirtyVertex","hasRenderOrderDidChangeBit","children","aIndex","bIndex","aRenderOrder","renderOrders","bRenderOrder","resetDynamicFlags","destroy","options","release","masks","texture","getModelMeshById","mesh","addParameterValueById","model","Container","pixiModel","_maskShaderVertSrc","_maskShaderFragSrc","_maskShader","toString","_maskCounts","_maskRelationList","_maskMeshContainers","_maskTextures","_maskSprites","meshes","newContainer","n","meshMaskID","maskMesh","transform","worldTransform","localTransform","isMaskMesh","newTexture","RenderTexture","newSprite","Sprite","mask","appRenderer","render","resize","viewWidth","viewHeight","ModelBuilder","_animatorBuilder","setMoc","_moc","_physicsRigBuilder","_userDataBuilder","addTexture","index","addAnimatorLayer","addGroups","buildFromModel3Json","loader","model3Obj","model3URL","url","modelDir","substring","lastIndexOf","textureCount","data","FileReferences","Moc","xhrType","loaders","Resource","XHR_RESPONSE_TYPE","BUFFER","Textures","element","JSON","load","resources","moc","fromArrayBuffer","physics","fromMoc","apply","arguments","_renderWebGL","renderer","state","setFrontFace","setCullFace","Mesh","L2D","basePath","Loader","animatorBuilder","models","physicsRigBuilder","modelPath","motionNames","modelNames","Motions","group","motionName","File","split","pop","shift","includes","String","Date","now","motions","changeCanvas","Live2dV3","modelName","width","height","el","sizeLimit","mobileLimit","sounds","error","isDom","document","documentElement","clientWidth","clientHeight","test","navigator","userAgent","window","log","l2d","canvas","app","Application","transparent","appendChild","view","ticker","onresize","event","style","Point","isClick","addEventListener","inDrag","mouseX","offsetX","mouseY","offsetY","pointerX","pointerY","isHit","startAnimation","bodyMotions","currentMotion","floor","random","soundFile","filePath","join","replace","Howl","src","Audio","stage","removeChildren","onUpdate","motionId","layerId","posX","posY","vertexOffset","vertexStep","left","right","top","bottom","tx","ty","e","HTMLElement","nodeType","nodeName","VERSION","toLowerCase","args","l2dViewer"],"mappings":"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","sourcesContent":["(function () {\n  var LIVE2DCUBISMFRAMEWORK;\n  (function (LIVE2DCUBISMFRAMEWORK) {\n    var AnimationPoint = (function () {\n      function AnimationPoint (time, value) {\n        this.time = time\n        this.value = value\n      }\n      return AnimationPoint\n    }())\n    LIVE2DCUBISMFRAMEWORK.AnimationPoint = AnimationPoint\n    var AnimationUserDataBody = (function () {\n      function AnimationUserDataBody (time, value) {\n        this.time = time\n        this.value = value\n      }\n      ;\n      return AnimationUserDataBody\n    }())\n    LIVE2DCUBISMFRAMEWORK.AnimationUserDataBody = AnimationUserDataBody\n    var BuiltinAnimationSegmentEvaluators = (function () {\n      function BuiltinAnimationSegmentEvaluators () {\n      }\n      BuiltinAnimationSegmentEvaluators.lerp = function (a, b, t) {\n        return new AnimationPoint((a.time + ((b.time - a.time) * t)), (a.value + ((b.value - a.value) * t)))\n      }\n      BuiltinAnimationSegmentEvaluators.LINEAR = function (points, offset, time) {\n        var p0 = points[offset + 0]\n        var p1 = points[offset + 1]\n        var t = (time - p0.time) / (p1.time - p0.time)\n        return (p0.value + ((p1.value - p0.value) * t))\n      }\n      BuiltinAnimationSegmentEvaluators.BEZIER = function (points, offset, time) {\n        var t = (time - points[offset + 0].time) / (points[offset + 3].time - points[offset].time)\n        var p01 = BuiltinAnimationSegmentEvaluators.lerp(points[offset + 0], points[offset + 1], t)\n        var p12 = BuiltinAnimationSegmentEvaluators.lerp(points[offset + 1], points[offset + 2], t)\n        var p23 = BuiltinAnimationSegmentEvaluators.lerp(points[offset + 2], points[offset + 3], t)\n        var p012 = BuiltinAnimationSegmentEvaluators.lerp(p01, p12, t)\n        var p123 = BuiltinAnimationSegmentEvaluators.lerp(p12, p23, t)\n        return BuiltinAnimationSegmentEvaluators.lerp(p012, p123, t).value\n      }\n      BuiltinAnimationSegmentEvaluators.STEPPED = function (points, offset, time) {\n        return points[offset + 0].value\n      }\n      BuiltinAnimationSegmentEvaluators.INVERSE_STEPPED = function (points, offset, time) {\n        return points[offset + 1].value\n      }\n      return BuiltinAnimationSegmentEvaluators\n    }())\n    LIVE2DCUBISMFRAMEWORK.BuiltinAnimationSegmentEvaluators = BuiltinAnimationSegmentEvaluators\n    var AnimationSegment = (function () {\n      function AnimationSegment (offset, evaluate) {\n        this.offset = offset\n        this.evaluate = evaluate\n      }\n      return AnimationSegment\n    }())\n    LIVE2DCUBISMFRAMEWORK.AnimationSegment = AnimationSegment\n    var AnimationTrack = (function () {\n      function AnimationTrack (targetId, points, segments) {\n        this.targetId = targetId\n        this.points = points\n        this.segments = segments\n      }\n      AnimationTrack.prototype.evaluate = function (time) {\n        var s = 0\n        var lastS = this.segments.length - 1\n        for (; s < lastS; ++s) {\n          if (this.points[this.segments[s + 1].offset].time < time) {\n            continue\n          }\n          break\n        }\n        return this.segments[s].evaluate(this.points, this.segments[s].offset, time)\n      }\n      return AnimationTrack\n    }())\n    LIVE2DCUBISMFRAMEWORK.AnimationTrack = AnimationTrack\n    var Animation = (function () {\n      function Animation (motion3Json) {\n        var _this = this\n        this.modelTracks = []\n        this.parameterTracks = []\n        this.partOpacityTracks = []\n        this.userDataBodys = []\n        this.duration = motion3Json.Meta.Duration\n        this.fps = motion3Json.Meta.Fps\n        this.loop = motion3Json.Meta.Loop\n        this.userDataCount = motion3Json.Meta.UserDataCount\n        this.totalUserDataSize = motion3Json.Meta.TotalUserDataSize\n        if (motion3Json.UserData != null) {\n          motion3Json.UserData.forEach(function (u) {\n            _this.userDataBodys.push(new AnimationUserDataBody(u.Time, u.Value))\n          })\n          console.assert(this.userDataBodys.length === this.userDataCount)\n        }\n        motion3Json.Curves.forEach(function (c) {\n          var s = c.Segments\n          var points = []\n          var segments = []\n          points.push(new AnimationPoint(s[0], s[1]))\n          for (var t = 2; t < s.length; t += 3) {\n            var offset = points.length - 1\n            var evaluate = BuiltinAnimationSegmentEvaluators.LINEAR\n            var type = s[t]\n            if (type === 1) {\n              evaluate = BuiltinAnimationSegmentEvaluators.BEZIER\n              points.push(new AnimationPoint(s[t + 1], s[t + 2]))\n              points.push(new AnimationPoint(s[t + 3], s[t + 4]))\n              t += 4\n            } else if (type === 2) {\n              evaluate = BuiltinAnimationSegmentEvaluators.STEPPED\n            } else if (type === 3) {\n              evaluate = BuiltinAnimationSegmentEvaluators.INVERSE_STEPPED\n            } else if (type !== 0) {\n            }\n            points.push(new AnimationPoint(s[t + 1], s[t + 2]))\n            segments.push(new AnimationSegment(offset, evaluate))\n          }\n          var track = new AnimationTrack(c.Id, points, segments)\n          if (c.Target === 'Model') {\n            _this.modelTracks.push(track)\n          } else if (c.Target === 'Parameter') {\n            _this.parameterTracks.push(track)\n          } else if (c.Target === 'PartOpacity') {\n            _this.partOpacityTracks.push(track)\n          } else {\n          }\n        })\n      }\n      Animation.fromMotion3Json = function (motion3Json) {\n        if (motion3Json == null) {\n          return null\n        }\n        var animation = new Animation(motion3Json)\n        return (animation.isValid)\n          ? animation\n          : null\n      }\n      Animation.prototype.addAnimationCallback = function (callbackFunc) {\n        if (this._callbackFunctions == null) { this._callbackFunctions = [] }\n        this._callbackFunctions.push(callbackFunc)\n      }\n      Animation.prototype.removeAnimationCallback = function (callbackFunc) {\n        if (this._callbackFunctions != null) {\n          var _target = -1\n          for (var _index = 0; _index < this._callbackFunctions.length; _index++) {\n            if (this._callbackFunctions[_index] === callbackFunc) {\n              _target = _index\n              break\n            }\n          }\n          if (_target >= 0) { this._callbackFunctions.splice(_target, 1) }\n        }\n      }\n      Animation.prototype.clearAnimationCallback = function () {\n        this._callbackFunctions = []\n      }\n      Animation.prototype.callAnimationCallback = function (value) {\n        if (this._callbackFunctions.length > 0) { this._callbackFunctions.forEach(function (func) { func(value) }) }\n      }\n      Animation.prototype.evaluate = function (time, weight, blend, target, stackFlags, groups) {\n        if (groups === undefined) { groups = null }\n        if (weight <= 0.01) {\n          return\n        }\n        if (this.loop) {\n          while (time > this.duration) {\n            time -= this.duration\n          }\n        }\n        this.parameterTracks.forEach(function (t) {\n          var p = target.parameters.ids.indexOf(t.targetId)\n          if (p >= 0) {\n            var sample = t.evaluate(time)\n            if (stackFlags[0][p] !== true) {\n              target.parameters.values[p] = target.parameters.defaultValues[p]\n              stackFlags[0][p] = true\n            }\n            target.parameters.values[p] = blend(target.parameters.values[p], sample, t.evaluate(0), weight)\n          }\n        })\n        this.partOpacityTracks.forEach(function (t) {\n          var p = target.parts.ids.indexOf(t.targetId)\n          if (p >= 0) {\n            var sample = t.evaluate(time)\n            if (stackFlags[1][p] !== true) {\n              target.parts.opacities[p] = 1\n              stackFlags[1][p] = true\n            }\n            target.parts.opacities[p] = blend(target.parts.opacities[p], sample, t.evaluate(0), weight)\n          }\n        })\n        this.modelTracks.forEach(function (t) {\n          if (groups != null) {\n            var g = groups.getGroupById(t.targetId)\n            if (g != null && g.target === 'Parameter') {\n              for (var _i = 0, _a = g.ids; _i < _a.length; _i++) {\n                var tid = _a[_i]\n                var p = target.parameters.ids.indexOf(tid)\n                if (p >= 0) {\n                  var sample = t.evaluate(time)\n                  if (stackFlags[0][p] !== true) {\n                    target.parameters.values[p] = target.parameters.defaultValues[p]\n                    stackFlags[0][p] = true\n                  }\n                  target.parameters.values[p] = blend(target.parameters.values[p], sample, t.evaluate(0), weight)\n                }\n              }\n            }\n          }\n        })\n        if (this._callbackFunctions != null) {\n          for (var _i = 0, _a = this.userDataBodys; _i < _a.length; _i++) {\n            var ud = _a[_i]\n            if (this.isEventTriggered(ud.time, time, this._lastTime, this.duration)) { this.callAnimationCallback(ud.value) }\n          }\n        }\n        this._lastTime = time\n      }\n      Animation.prototype.isEventTriggered = function (timeEvaluate, timeForward, timeBack, duration) {\n        if (timeForward > timeBack) {\n          if (timeEvaluate > timeBack && timeEvaluate < timeForward) { return true }\n        } else {\n          if ((timeEvaluate > 0 && timeEvaluate < timeForward) || (timeEvaluate > timeBack && timeEvaluate < duration)) { return true }\n        }\n        return false\n      }\n      Object.defineProperty(Animation.prototype, 'isValid', {\n        get: function () {\n          return true\n        },\n        enumerable: true,\n        configurable: true\n      })\n      return Animation\n    }())\n    LIVE2DCUBISMFRAMEWORK.Animation = Animation\n    var BuiltinCrossfadeWeighters = (function () {\n      function BuiltinCrossfadeWeighters () {\n      }\n      BuiltinCrossfadeWeighters.LINEAR = function (time, duration) {\n        return (time / duration)\n      }\n      return BuiltinCrossfadeWeighters\n    }())\n    LIVE2DCUBISMFRAMEWORK.BuiltinCrossfadeWeighters = BuiltinCrossfadeWeighters\n    var AnimationState = (function () {\n      function AnimationState () {\n      }\n      return AnimationState\n    }())\n    LIVE2DCUBISMFRAMEWORK.AnimationState = AnimationState\n    var BuiltinAnimationBlenders = (function () {\n      function BuiltinAnimationBlenders () {\n      }\n      BuiltinAnimationBlenders.OVERRIDE = function (source, destination, initial, weight) {\n        return ((destination * weight) + source * (1 - weight))\n      }\n      BuiltinAnimationBlenders.ADD = function (source, destination, initial, weight) {\n        return (source + ((destination - initial) * weight))\n      }\n      BuiltinAnimationBlenders.MULTIPLY = function (source, destination, weight) {\n        return (source * (1 + ((destination - 1) * weight)))\n      }\n      return BuiltinAnimationBlenders\n    }())\n    LIVE2DCUBISMFRAMEWORK.BuiltinAnimationBlenders = BuiltinAnimationBlenders\n    var AnimationLayer = (function () {\n      function AnimationLayer () {\n        this.weight = 1\n      }\n      Object.defineProperty(AnimationLayer.prototype, 'currentAnimation', {\n        get: function () {\n          return this._animation\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(AnimationLayer.prototype, 'currentTime', {\n        get: function () {\n          return this._time\n        },\n        set: function (value) {\n          this._time = value\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(AnimationLayer.prototype, 'isPlaying', {\n        get: function () {\n          return this._play\n        },\n        enumerable: true,\n        configurable: true\n      })\n      AnimationLayer.prototype.play = function (animation, fadeDuration) {\n        if (fadeDuration === undefined) { fadeDuration = 0 }\n        if (this._animation && fadeDuration > 0) {\n          this._goalAnimation = animation\n          this._goalTime = 0\n          this._fadeTime = 0\n          this._fadeDuration = fadeDuration\n        } else {\n          this._animation = animation\n          this.currentTime = 0\n          this._play = true\n        }\n      }\n      AnimationLayer.prototype.resume = function () {\n        this._play = true\n      }\n      AnimationLayer.prototype.pause = function () {\n        this._play = false\n      }\n      AnimationLayer.prototype.stop = function () {\n        this._play = false\n        this.currentTime = 0\n      }\n      AnimationLayer.prototype._update = function (deltaTime) {\n        if (!this._play) {\n          return\n        }\n        this._time += deltaTime\n        this._goalTime += deltaTime\n        this._fadeTime += deltaTime\n        if (this._animation == null || (!this._animation.loop && this._time > this._animation.duration)) {\n          this.stop()\n          this._animation = null\n        }\n      }\n      AnimationLayer.prototype._evaluate = function (target, stackFlags) {\n        if (this._animation == null) {\n          return\n        }\n        var weight = (this.weight < 1)\n          ? this.weight\n          : 1\n        var animationWeight = (this._goalAnimation != null)\n          ? (weight * this.weightCrossfade(this._fadeTime, this._fadeDuration))\n          : weight\n        this._animation.evaluate(this._time, animationWeight, this.blend, target, stackFlags, this.groups)\n        if (this._goalAnimation != null) {\n          animationWeight = 1 - (weight * this.weightCrossfade(this._fadeTime, this._fadeDuration))\n          this._goalAnimation.evaluate(this._goalTime, animationWeight, this.blend, target, stackFlags, this.groups)\n          if (this._fadeTime > this._fadeDuration) {\n            this._animation = this._goalAnimation\n            this._time = this._goalTime\n            this._goalAnimation = null\n          }\n        }\n      }\n      return AnimationLayer\n    }())\n    LIVE2DCUBISMFRAMEWORK.AnimationLayer = AnimationLayer\n    var Animator = (function () {\n      function Animator (target, timeScale, layers) {\n        this._target = target\n        this.timeScale = timeScale\n        this._layers = layers\n      }\n      Object.defineProperty(Animator.prototype, 'target', {\n        get: function () {\n          return this._target\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Animator.prototype, 'isPlaying', {\n        get: function () {\n          var ret = false\n          this._layers.forEach(function (l) {\n            if (l.isPlaying) {\n              ret = true\n            }\n          })\n          return ret\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Animator.prototype.addLayer = function (name, blender, weight) {\n        if (blender === undefined) { blender = BuiltinAnimationBlenders.OVERRIDE }\n        if (weight === undefined) { weight = 1 }\n        var layer = new AnimationLayer()\n        layer.blend = blender\n        layer.weightCrossfade = BuiltinCrossfadeWeighters.LINEAR\n        layer.weight = weight\n        layer.groups = this.groups\n        this._layers.set(name, layer)\n      }\n      Animator.prototype.getLayer = function (name) {\n        return this._layers.has(name)\n          ? this._layers.get(name)\n          : null\n      }\n      Animator.prototype.removeLayer = function (name) {\n        return this._layers.has(name)\n          ? this._layers.delete(name)\n          : null\n      }\n      Animator.prototype.clearLayers = function () {\n        this._layers.clear()\n      }\n      Animator.prototype.updateAndEvaluate = function (deltaTime) {\n        var _this = this\n        deltaTime *= ((this.timeScale > 0)\n          ? this.timeScale\n          : 0)\n        if (deltaTime > 0.001) {\n          this._layers.forEach(function (l) {\n            l._update(deltaTime)\n          })\n        }\n        var paramStackFlags = new Array(this._target.parameters.count).fill(false) // eslint-disable-line no-array-constructor\n        var partsStackFlags = new Array(this._target.parts.count).fill(false) // eslint-disable-line no-array-constructor\n        var stackFlags = new Array(paramStackFlags, partsStackFlags) // eslint-disable-line no-array-constructor\n        this._layers.forEach(function (l) {\n          l._evaluate(_this._target, stackFlags)\n        })\n      }\n      Animator._create = function (target, timeScale, layers) {\n        var animator = new Animator(target, timeScale, layers)\n        return animator.isValid\n          ? animator\n          : null\n      }\n      Object.defineProperty(Animator.prototype, 'isValid', {\n        get: function () {\n          return this._target != null\n        },\n        enumerable: true,\n        configurable: true\n      })\n      return Animator\n    }())\n    LIVE2DCUBISMFRAMEWORK.Animator = Animator\n    var AnimatorBuilder = (function () {\n      function AnimatorBuilder () {\n        this._timeScale = 1\n        this._layerNames = []\n        this._layerBlenders = []\n        this._layerCrossfadeWeighters = []\n        this._layerWeights = []\n      }\n      AnimatorBuilder.prototype.setTarget = function (value) {\n        this._target = value\n        return this\n      }\n      AnimatorBuilder.prototype.setTimeScale = function (value) {\n        this._timeScale = value\n        return this\n      }\n      AnimatorBuilder.prototype.addLayer = function (name, blender, weight) {\n        if (blender === undefined) { blender = BuiltinAnimationBlenders.OVERRIDE }\n        if (weight === undefined) { weight = 1 }\n        this._layerNames.push(name)\n        this._layerBlenders.push(blender)\n        this._layerCrossfadeWeighters.push(BuiltinCrossfadeWeighters.LINEAR)\n        this._layerWeights.push(weight)\n        return this\n      }\n      AnimatorBuilder.prototype.build = function () {\n        var layers = new Map()\n        for (var l = 0; l < this._layerNames.length; ++l) {\n          var layer = new AnimationLayer()\n          layer.blend = this._layerBlenders[l]\n          layer.weightCrossfade = this._layerCrossfadeWeighters[l]\n          layer.weight = this._layerWeights[l]\n          layers.set(this._layerNames[l], layer)\n        }\n        return Animator._create(this._target, this._timeScale, layers)\n      }\n      return AnimatorBuilder\n    }())\n    LIVE2DCUBISMFRAMEWORK.AnimatorBuilder = AnimatorBuilder\n    var PhysicsVector2 = (function () {\n      function PhysicsVector2 (x, y) {\n        this.x = x\n        this.y = y\n      }\n      PhysicsVector2.distance = function (a, b) {\n        return Math.abs(a.substract(b).length)\n      }\n      PhysicsVector2.dot = function (a, b) {\n        return ((a.x * b.x) + (a.y * b.y))\n      }\n      Object.defineProperty(PhysicsVector2.prototype, 'length', {\n        get: function () {\n          return Math.sqrt(PhysicsVector2.dot(this, this))\n        },\n        enumerable: true,\n        configurable: true\n      })\n      PhysicsVector2.prototype.add = function (vector2) {\n        return new PhysicsVector2(this.x + vector2.x, this.y + vector2.y)\n      }\n      PhysicsVector2.prototype.substract = function (vector2) {\n        return new PhysicsVector2(this.x - vector2.x, this.y - vector2.y)\n      }\n      PhysicsVector2.prototype.multiply = function (vector2) {\n        return new PhysicsVector2(this.x * vector2.x, this.y * vector2.y)\n      }\n      PhysicsVector2.prototype.multiplyByScalar = function (scalar) {\n        return this.multiply(new PhysicsVector2(scalar, scalar))\n      }\n      PhysicsVector2.prototype.divide = function (vector2) {\n        return new PhysicsVector2(this.x / vector2.x, this.y / vector2.y)\n      }\n      PhysicsVector2.prototype.divideByScalar = function (scalar) {\n        return this.divide(new PhysicsVector2(scalar, scalar))\n      }\n      PhysicsVector2.prototype.rotateByRadians = function (radians) {\n        var x = (this.x * Math.cos(radians)) - (this.y * Math.sin(radians))\n        var y = (this.x * Math.sin(radians)) + (this.y * Math.cos(radians))\n        return new PhysicsVector2(x, y)\n      }\n      PhysicsVector2.prototype.normalize = function () {\n        var length = this.length\n        var x = this.x / length\n        var y = this.y / length\n        return new PhysicsVector2(x, y)\n      }\n      PhysicsVector2.zero = new PhysicsVector2(0, 0)\n      return PhysicsVector2\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsVector2 = PhysicsVector2\n    var Physics = (function () {\n      function Physics () {\n      }\n      Physics.clampScalar = function (scalar, lower, upper) {\n        if (scalar < lower) {\n          return lower\n        }\n        if (scalar > upper) {\n          return upper\n        }\n        return scalar\n      }\n      Physics.directionToDegrees = function (from, to) {\n        var radians = Physics.directionToRadians(from, to)\n        var degrees = Physics.radiansToDegrees(radians)\n        return ((to.x - from.x) > 0)\n          ? -degrees\n          : degrees\n      }\n      Physics.radiansToDegrees = function (radians) {\n        return ((radians * 180) / Math.PI)\n      }\n      Physics.radiansToDirection = function (radians) {\n        return new PhysicsVector2(Math.sin(radians), Math.cos(radians))\n      }\n      Physics.degreesToRadians = function (degrees) {\n        return ((degrees / 180) * Math.PI)\n      }\n      Physics.directionToRadians = function (from, to) {\n        var dot = PhysicsVector2.dot(from, to)\n        var magnitude = from.length * to.length\n        if (magnitude === 0) {\n          return 0\n        }\n        var cosTheta = (dot / magnitude)\n        return (Math.abs(cosTheta) <= 1.0)\n          ? Math.acos(cosTheta)\n          : 0\n      }\n      Physics.gravity = new PhysicsVector2(0, -1)\n      Physics.wind = new PhysicsVector2(0, 0)\n      Physics.maximumWeight = 100\n      Physics.airResistance = 5\n      Physics.movementThreshold = 0.001\n      Physics.correctAngles = true\n      return Physics\n    }())\n    LIVE2DCUBISMFRAMEWORK.Physics = Physics\n    var PhysicsParticle = (function () {\n      function PhysicsParticle (initialPosition, mobility, delay, acceleration, radius) {\n        this.initialPosition = initialPosition\n        this.mobility = mobility\n        this.delay = delay\n        this.acceleration = acceleration\n        this.radius = radius\n        this.position = initialPosition\n        this.lastPosition = this.position\n        this.lastGravity = new PhysicsVector2(0, -1)\n        this.force = new PhysicsVector2(0, 0)\n        this.velocity = new PhysicsVector2(0, 0)\n      }\n      return PhysicsParticle\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsParticle = PhysicsParticle\n    var PhysicsFactorTuple = (function () {\n      function PhysicsFactorTuple (x, y, angle) {\n        this.x = x\n        this.y = y\n        this.angle = angle\n      }\n      PhysicsFactorTuple.prototype.add = function (factor) {\n        var x = this.x + factor.x\n        var y = this.y + factor.y\n        var angle = this.angle + factor.angle\n        return new PhysicsFactorTuple(x, y, angle)\n      }\n      return PhysicsFactorTuple\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsFactorTuple = PhysicsFactorTuple\n    var PhysicsNormalizationTuple = (function () {\n      function PhysicsNormalizationTuple (minimum, maximum, def) {\n        this.minimum = minimum\n        this.maximum = maximum\n        this.def = def\n      }\n      return PhysicsNormalizationTuple\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsNormalizationTuple = PhysicsNormalizationTuple\n    var PhysicsNormalizationOptions = (function () {\n      function PhysicsNormalizationOptions (position, angle) {\n        this.position = position\n        this.angle = angle\n      }\n      return PhysicsNormalizationOptions\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsNormalizationOptions = PhysicsNormalizationOptions\n    var PhysicsInput = (function () {\n      function PhysicsInput (targetId, weight, factor, invert) {\n        this.targetId = targetId\n        this.weight = weight\n        this.factor = factor\n        this.invert = invert\n      }\n      Object.defineProperty(PhysicsInput.prototype, 'normalizedWeight', {\n        get: function () {\n          return Physics.clampScalar(this.weight / Physics.maximumWeight, 0, 1)\n        },\n        enumerable: true,\n        configurable: true\n      })\n      PhysicsInput.prototype.evaluateFactor = function (parameterValue, parameterMinimum, parameterMaximum, parameterDefault, normalization) {\n        console.assert(parameterMaximum > parameterMinimum)\n        var parameterMiddle = this.getMiddleValue(parameterMinimum, parameterMaximum)\n        var value = parameterValue - parameterMiddle\n        switch (Math.sign(value)) {\n          case 1:\n            {\n              const parameterRange = parameterMaximum - parameterMiddle\n              if (parameterRange === 0) {\n                value = normalization.angle.def\n              } else {\n                const normalizationRange = normalization.angle.maximum - normalization.angle.def\n                if (normalizationRange === 0) {\n                  value = normalization.angle.maximum\n                } else {\n                  value *= Math.abs(normalizationRange / parameterRange)\n                  value += normalization.angle.def\n                }\n              }\n            }\n            break\n          case -1:\n            {\n              const parameterRange = parameterMiddle - parameterMinimum\n              if (parameterRange === 0) {\n                value = normalization.angle.def\n              } else {\n                const normalizationRange = normalization.angle.def - normalization.angle.minimum\n                if (normalizationRange === 0) {\n                  value = normalization.angle.minimum\n                } else {\n                  value *= Math.abs(normalizationRange / parameterRange)\n                  value += normalization.angle.def\n                }\n              }\n            }\n            break\n          case 0:\n            value = normalization.angle.def\n            break\n        }\n        var weight = (this.weight / Physics.maximumWeight)\n        value *= (this.invert) ? 1 : -1\n        return new PhysicsFactorTuple(value * this.factor.x * weight, value * this.factor.y * weight, value * this.factor.angle * weight)\n      }\n      PhysicsInput.prototype.getRangeValue = function (min, max) {\n        var maxValue = Math.max(min, max)\n        var minValue = Math.min(min, max)\n        return Math.abs(maxValue - minValue)\n      }\n      PhysicsInput.prototype.getMiddleValue = function (min, max) {\n        var minValue = Math.min(min, max)\n        return minValue + (this.getRangeValue(min, max) / 2)\n      }\n      return PhysicsInput\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsInput = PhysicsInput\n    var PhysicsOutput = (function () {\n      function PhysicsOutput (targetId, particleIndex, weight, angleScale, factor, invert) {\n        this.targetId = targetId\n        this.particleIndex = particleIndex\n        this.weight = weight\n        this.factor = factor\n        this.invert = invert\n        this.factor.angle *= angleScale\n      }\n      Object.defineProperty(PhysicsOutput.prototype, 'normalizedWeight', {\n        get: function () {\n          return Physics.clampScalar(this.weight / Physics.maximumWeight, 0, 1)\n        },\n        enumerable: true,\n        configurable: true\n      })\n      PhysicsOutput.prototype.evaluateValue = function (translation, particles) {\n        var value = (translation.x * this.factor.x) + (translation.y * this.factor.y)\n        if (this.factor.angle > 0) {\n          var parentGravity = Physics.gravity\n          if (Physics.correctAngles && this.particleIndex > 1) {\n            parentGravity = particles[this.particleIndex - 2].position\n              .substract(particles[this.particleIndex - 1].position)\n          }\n          var angleResult = (Physics.directionToRadians(parentGravity, translation))\n          value += (((translation.x - parentGravity.x) > 0) ? -angleResult : angleResult) * this.factor.angle\n        }\n        value *= ((this.invert)\n          ? -1\n          : 1)\n        return value\n      }\n      return PhysicsOutput\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsOutput = PhysicsOutput\n    var PhysicsSubRig = (function () {\n      function PhysicsSubRig (input, output, particles, normalization) {\n        this.input = input\n        this.output = output\n        this.particles = particles\n        this.normalization = normalization\n      }\n      PhysicsSubRig.prototype._update = function (deltaTime, target) {\n        var _this = this\n        var parameters = target.parameters\n        var factor = new PhysicsFactorTuple(0, 0, 0)\n        this.input.forEach(function (i) {\n          var parameterIndex = parameters.ids.indexOf(i.targetId)\n          if (parameterIndex === -1) {\n            return\n          }\n          factor = factor.add(i.evaluateFactor(parameters.values[parameterIndex], parameters.minimumValues[parameterIndex], parameters.maximumValues[parameterIndex], parameters.defaultValues[parameterIndex], _this.normalization))\n        })\n        var a = Physics.degreesToRadians(-factor.angle)\n        var xy = new PhysicsVector2(factor.x, factor.y).rotateByRadians(a)\n        factor.x = xy.x\n        factor.y = xy.y\n        var factorRadians = a\n        var gravityDirection = Physics\n          .radiansToDirection(factorRadians)\n          .normalize()\n        this.particles.forEach(function (p, i) {\n          if (i === 0) {\n            p.position = new PhysicsVector2(factor.x, factor.y)\n            return\n          }\n          p.force = gravityDirection.multiplyByScalar(p.acceleration).add(Physics.wind)\n          p.lastPosition = p.position\n          var delay = p.delay * deltaTime * 30\n          var direction = p.position.substract(_this.particles[i - 1].position)\n          var distance = PhysicsVector2.distance(PhysicsVector2.zero, direction)\n          var angle = Physics.directionToDegrees(p.lastGravity, gravityDirection)\n          var radians = Physics.degreesToRadians(angle) / Physics.airResistance\n          direction = direction\n            .rotateByRadians(radians)\n            .normalize()\n          p.position = _this.particles[i - 1].position.add(direction.multiplyByScalar(distance))\n          var velocity = p.velocity.multiplyByScalar(delay)\n          var force = p.force\n            .multiplyByScalar(delay)\n            .multiplyByScalar(delay)\n          p.position = p.position\n            .add(velocity)\n            .add(force)\n          var newDirection = p.position\n            .substract(_this.particles[i - 1].position)\n            .normalize()\n          p.position = _this.particles[i - 1].position.add(newDirection.multiplyByScalar(p.radius))\n          if (Math.abs(p.position.x) < Physics.movementThreshold) {\n            p.position.x = 0\n          }\n          if (delay !== 0) {\n            p.velocity = p.position\n              .substract(p.lastPosition)\n              .divideByScalar(delay)\n              .multiplyByScalar(p.mobility)\n          } else {\n            p.velocity = PhysicsVector2.zero\n          }\n          p.force = PhysicsVector2.zero\n          p.lastGravity = gravityDirection\n        })\n      }\n      PhysicsSubRig.prototype._evaluate = function (target) {\n        var _this = this\n        var parameters = target.parameters\n        this.output.forEach(function (o) {\n          if (o.particleIndex < 1 || o.particleIndex >= _this.particles.length) {\n            return\n          }\n          var parameterIndex = parameters.ids.indexOf(o.targetId)\n          if (parameterIndex === -1) {\n            return\n          }\n          var translation = _this.particles[o.particleIndex - 1].position.substract(_this.particles[o.particleIndex].position)\n          var value = Physics.clampScalar(o.evaluateValue(translation, _this.particles), parameters.minimumValues[parameterIndex], parameters.maximumValues[parameterIndex])\n          var unclampedParameterValue = (parameters.values[parameterIndex] * (1 - o.normalizedWeight)) + (value * o.normalizedWeight)\n          parameters.values[parameterIndex] = Physics.clampScalar(unclampedParameterValue, parameters.minimumValues[parameterIndex], parameters.maximumValues[parameterIndex])\n        })\n      }\n      return PhysicsSubRig\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsSubRig = PhysicsSubRig\n    var PhysicsRig = (function () {\n      function PhysicsRig (target, timeScale, physics3Json) {\n        var _this = this\n        this.timeScale = 1\n        this.timeScale = timeScale\n        this._target = target\n        if (!target) {\n          return\n        }\n        this._subRigs = []\n        physics3Json.PhysicsSettings.forEach(function (r) {\n          var input = []\n          r.Input.forEach(function (i) {\n            var factor = new PhysicsFactorTuple(1, 0, 0)\n            if (i.Type === 'Y') {\n              factor.x = 0\n              factor.y = 1\n            } else if (i.Type === 'Angle') {\n              factor.x = 0\n              factor.angle = 1\n            }\n            input.push(new PhysicsInput(i.Source.Id, i.Weight, factor, i.Reflect))\n          })\n          var output = []\n          r.Output.forEach(function (o) {\n            var factor = new PhysicsFactorTuple(1, 0, 0)\n            if (o.Type === 'Y') {\n              factor.x = 0\n              factor.y = 1\n            } else if (o.Type === 'Angle') {\n              factor.x = 0\n              factor.angle = 1\n            }\n            output.push(new PhysicsOutput(o.Destination.Id, o.VertexIndex, o.Weight, o.Scale, factor, o.Reflect))\n          })\n          var particles = []\n          r.Vertices.forEach(function (p) {\n            var initialPosition = new PhysicsVector2(p.Position.X, p.Position.Y)\n            particles.push(new PhysicsParticle(initialPosition, p.Mobility, p.Delay, p.Acceleration, p.Radius))\n          })\n          var jsonOptions = r.Normalization\n          var positionsOption = new PhysicsNormalizationTuple(jsonOptions.Position.Minimum, jsonOptions.Position.Maximum, jsonOptions.Position.Default)\n          var anglesOption = new PhysicsNormalizationTuple(jsonOptions.Angle.Minimum, jsonOptions.Angle.Maximum, jsonOptions.Angle.Default)\n          var normalization = new PhysicsNormalizationOptions(positionsOption, anglesOption)\n          _this._subRigs.push(new PhysicsSubRig(input, output, particles, normalization))\n        })\n      }\n      PhysicsRig.prototype.updateAndEvaluate = function (deltaTime) {\n        var _this = this\n        deltaTime *= ((this.timeScale > 0)\n          ? this.timeScale\n          : 0)\n        if (deltaTime > 0.01) {\n          this._subRigs.forEach(function (r) {\n            r._update(deltaTime, _this._target)\n          })\n        }\n        this._subRigs.forEach(function (r) {\n          r._evaluate(_this._target)\n        })\n      }\n      PhysicsRig._fromPhysics3Json = function (target, timeScale, physics3Json) {\n        var rig = new PhysicsRig(target, timeScale, physics3Json)\n        return (rig._isValid)\n          ? rig\n          : null\n      }\n      Object.defineProperty(PhysicsRig.prototype, '_isValid', {\n        get: function () {\n          return this._target != null\n        },\n        enumerable: true,\n        configurable: true\n      })\n      return PhysicsRig\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsRig = PhysicsRig\n    var PhysicsRigBuilder = (function () {\n      function PhysicsRigBuilder () {\n        this._timeScale = 1\n      }\n      PhysicsRigBuilder.prototype.setTarget = function (value) {\n        this._target = value\n        return this\n      }\n      PhysicsRigBuilder.prototype.setTimeScale = function (value) {\n        this._timeScale = value\n        return this\n      }\n      PhysicsRigBuilder.prototype.setPhysics3Json = function (value) {\n        this._physics3Json = value\n        return this\n      }\n      PhysicsRigBuilder.prototype.build = function () {\n        return PhysicsRig._fromPhysics3Json(this._target, this._timeScale, this._physics3Json)\n      }\n      return PhysicsRigBuilder\n    }())\n    LIVE2DCUBISMFRAMEWORK.PhysicsRigBuilder = PhysicsRigBuilder\n    var UserData = (function () {\n      function UserData (target, userData3Json) {\n        var _this = this\n        this._target = target\n        if (!target) {\n          return\n        }\n        this._version = userData3Json.Version\n        this._userDataCount = userData3Json.Meta.UserDataCount\n        this._totalUserDataSize = userData3Json.Meta.TotalUserDataSize\n        if (userData3Json.UserData != null) {\n          this._userDataBodys = []\n          userData3Json.UserData.forEach(function (u) {\n            _this._userDataBodys.push(new UserDataBody(u.Target, u.Id, u.Value))\n          })\n          console.assert(this._userDataBodys.length === this._userDataCount)\n        }\n      }\n      UserData._fromUserData3Json = function (target, userData3Json) {\n        var userdata = new UserData(target, userData3Json)\n        return (userdata._isValid)\n          ? userdata\n          : null\n      }\n      Object.defineProperty(UserData.prototype, '_isValid', {\n        get: function () {\n          return this._target != null\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(UserData.prototype, 'userDataCount', {\n        get: function () {\n          if (this._userDataBodys == null) { return 0 }\n          return this._userDataCount\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(UserData.prototype, 'totalUserDataSize', {\n        get: function () {\n          if (this._userDataBodys == null) { return 0 }\n          return this._totalUserDataSize\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(UserData.prototype, 'userDataBodys', {\n        get: function () {\n          if (this._userDataBodys == null) { return null }\n          return this._userDataBodys\n        },\n        enumerable: true,\n        configurable: true\n      })\n      UserData.prototype.isExistUserDataById = function (id_) {\n        if (this._userDataBodys == null) { return false }\n        for (var _i = 0, _a = this._userDataBodys; _i < _a.length; _i++) {\n          var ud = _a[_i]\n          if (ud.id === id_) { return true }\n        }\n        return false\n      }\n      UserData.prototype.getUserDataValueById = function (id_) {\n        if (this._userDataBodys == null) { return null }\n        for (var _i = 0, _a = this._userDataBodys; _i < _a.length; _i++) {\n          var ud = _a[_i]\n          if (ud.id === id_) { return ud.value }\n        }\n        return null\n      }\n      UserData.prototype.getUserDataTargetById = function (id_) {\n        if (this._userDataBodys == null) { return null }\n        for (var _i = 0, _a = this._userDataBodys; _i < _a.length; _i++) {\n          var ud = _a[_i]\n          if (ud.id === id_) { return ud.target }\n        }\n        return null\n      }\n      UserData.prototype.getUserDataBodyById = function (id_) {\n        if (this._userDataBodys == null) { return null }\n        for (var _i = 0, _a = this._userDataBodys; _i < _a.length; _i++) {\n          var ud = _a[_i]\n          if (ud.id === id_) { return ud }\n        }\n        return null\n      }\n      return UserData\n    }())\n    LIVE2DCUBISMFRAMEWORK.UserData = UserData\n    var UserDataBuilder = (function () {\n      function UserDataBuilder () {\n      }\n      UserDataBuilder.prototype.setTarget = function (value) {\n        this._target = value\n        return this\n      }\n      UserDataBuilder.prototype.setUserData3Json = function (value) {\n        this._userData3Json = value\n        return value\n      }\n      UserDataBuilder.prototype.build = function () {\n        return UserData._fromUserData3Json(this._target, this._userData3Json)\n      }\n      return UserDataBuilder\n    }())\n    LIVE2DCUBISMFRAMEWORK.UserDataBuilder = UserDataBuilder\n    var UserDataBody = (function () {\n      function UserDataBody (target, id, value) {\n        this.target = target\n        this.id = id\n        this.value = value\n      }\n      return UserDataBody\n    }())\n    LIVE2DCUBISMFRAMEWORK.UserDataBody = UserDataBody\n    var UserDataTargetType;\n    (function (UserDataTargetType) {\n      UserDataTargetType[UserDataTargetType.UNKNOWN = 0] = 'UNKNOWN'\n      UserDataTargetType[UserDataTargetType.ArtMesh = 1] = 'ArtMesh'\n    })(UserDataTargetType || (UserDataTargetType = {}))\n    var Groups = (function () {\n      function Groups (model3Json) {\n        var _this = this\n        if (typeof (model3Json.Groups) !== 'undefined') {\n          this._groupBodys = []\n          model3Json.Groups.forEach(function (u) {\n            _this._groupBodys.push(new GroupBody(u.Target, u.Name, u.Ids))\n          })\n        } else {\n          this._groupBodys = null\n        }\n      }\n      Object.defineProperty(Groups.prototype, 'data', {\n        get: function () {\n          if (this._groupBodys == null) { return null }\n          return this._groupBodys\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Groups.fromModel3Json = function (model3Json) {\n        return new Groups(model3Json)\n      }\n      Groups.prototype.getGroupById = function (targetId) {\n        if (this._groupBodys != null) {\n          for (var _i = 0, _a = this._groupBodys; _i < _a.length; _i++) {\n            var body = _a[_i]\n            if (body.name === targetId) { return body }\n          }\n        }\n        return null\n      }\n      return Groups\n    }())\n    LIVE2DCUBISMFRAMEWORK.Groups = Groups\n    var GroupBody = (function () {\n      function GroupBody (target, name, ids) {\n        this.target = target\n        this.name = name\n        this.ids = ids\n      }\n      return GroupBody\n    }())\n    LIVE2DCUBISMFRAMEWORK.GroupBody = GroupBody\n  })(LIVE2DCUBISMFRAMEWORK || (LIVE2DCUBISMFRAMEWORK = {}))\n\n  var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n      extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b }) || // eslint-disable-line no-proto\n      function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p] } // eslint-disable-line no-prototype-builtins\n      return extendStatics(d, b)\n    }\n    return function (d, b) {\n      extendStatics(d, b)\n      function __ () { this.constructor = d }\n      d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __())\n    }\n  })()\n  var LIVE2DCUBISMPIXI;\n  (function (LIVE2DCUBISMPIXI) {\n    var Model = (function (_super) {\n      __extends(Model, _super)\n      function Model (coreModel, textures, animator, physicsRig, userData, groups) {\n        var _this = _super.call(this) || this\n        _this._coreModel = coreModel\n        _this._textures = textures\n        _this._animator = animator\n        _this._physicsRig = physicsRig\n        _this._userData = userData\n        _this._groups = groups\n        _this._animator.groups = _this._groups\n        if (_this._coreModel == null) {\n          return _this\n        }\n        _this._meshes = new Array(_this._coreModel.drawables.ids.length)\n        for (var m = 0; m < _this._meshes.length; ++m) {\n          var uvs = _this._coreModel.drawables.vertexUvs[m].slice(0, _this._coreModel.drawables.vertexUvs[m].length)\n          for (var v = 1; v < uvs.length; v += 2) {\n            uvs[v] = 1 - uvs[v]\n          }\n          _this._meshes[m] = new CubismMesh(textures[_this._coreModel.drawables.textureIndices[m]], _this._coreModel.drawables.vertexPositions[m], uvs, _this._coreModel.drawables.indices[m], PIXI.DRAW_MODES.TRIANGLES)\n          _this._meshes[m].name = _this._coreModel.drawables.ids[m]\n          _this._meshes[m].scale.y *= -1\n          _this._meshes[m].isCulling = !Live2DCubismCore.Utils.hasIsDoubleSidedBit(_this._coreModel.drawables.constantFlags[m])\n          if (Live2DCubismCore.Utils.hasBlendAdditiveBit(_this._coreModel.drawables.constantFlags[m])) {\n            if (_this._coreModel.drawables.maskCounts[m] > 0) {\n              var addFilter = new PIXI.Filter()\n              addFilter.blendMode = PIXI.BLEND_MODES.ADD\n              _this._meshes[m].filters = [addFilter]\n            } else {\n              _this._meshes[m].blendMode = PIXI.BLEND_MODES.ADD\n            }\n          } else if (Live2DCubismCore.Utils.hasBlendMultiplicativeBit(_this._coreModel.drawables.constantFlags[m])) {\n            if (_this._coreModel.drawables.maskCounts[m] > 0) {\n              var multiplyFilter = new PIXI.Filter()\n              multiplyFilter.blendMode = PIXI.BLEND_MODES.MULTIPLY\n              _this._meshes[m].filters = [multiplyFilter]\n            } else {\n              _this._meshes[m].blendMode = PIXI.BLEND_MODES.MULTIPLY\n            }\n          }\n          _this.addChild(_this._meshes[m])\n        }\n        ;\n        _this._maskSpriteContainer = new MaskSpriteContainer(coreModel, _this)\n        return _this\n      }\n      Object.defineProperty(Model.prototype, 'parameters', {\n        get: function () {\n          return this._coreModel.parameters\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'parts', {\n        get: function () {\n          return this._coreModel.parts\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'drawables', {\n        get: function () {\n          return this._coreModel.drawables\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'canvasinfo', {\n        get: function () {\n          return this._coreModel.canvasinfo\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'textures', {\n        get: function () {\n          return this._textures\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'animator', {\n        get: function () {\n          return this._animator\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'userData', {\n        get: function () {\n          return this._userData\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'meshes', {\n        get: function () {\n          return this._meshes\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'masks', {\n        get: function () {\n          return this._maskSpriteContainer\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(Model.prototype, 'groups', {\n        get: function () {\n          return this._groups\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Model.prototype.update = function (delta) {\n        var _this = this\n        var deltaTime = 0.016 * delta\n        this._animator.updateAndEvaluate(deltaTime)\n        if (this._physicsRig) {\n          this._physicsRig.updateAndEvaluate(deltaTime)\n        }\n        this._coreModel.update()\n        var sort = false\n        for (var m = 0; m < this._meshes.length; ++m) {\n          this._meshes[m].alpha = this._coreModel.drawables.opacities[m]\n          this._meshes[m].visible = Live2DCubismCore.Utils.hasIsVisibleBit(this._coreModel.drawables.dynamicFlags[m])\n          if (Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(this._coreModel.drawables.dynamicFlags[m])) {\n            this._meshes[m].vertices = this._coreModel.drawables.vertexPositions[m]\n            this._meshes[m].dirtyVertex = true\n          }\n          if (Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(this._coreModel.drawables.dynamicFlags[m])) {\n            sort = true\n          }\n        }\n        if (sort) {\n          this.children.sort(function (a, b) {\n            var aIndex = _this._meshes.indexOf(a)\n            var bIndex = _this._meshes.indexOf(b)\n            var aRenderOrder = _this._coreModel.drawables.renderOrders[aIndex]\n            var bRenderOrder = _this._coreModel.drawables.renderOrders[bIndex]\n            return aRenderOrder - bRenderOrder\n          })\n        }\n        this._coreModel.drawables.resetDynamicFlags()\n      }\n      Model.prototype.destroy = function (options) {\n        if (this._coreModel !== null) {\n          this._coreModel.release()\n        }\n        _super.prototype.destroy.call(this, options)\n        this.masks.destroy()\n        this._meshes.forEach(function (m) {\n          m.destroy()\n        })\n        if (options === true || options.texture) {\n          this._textures.forEach(function (t) {\n            t.destroy()\n          })\n        }\n      }\n      Model.prototype.getModelMeshById = function (id) {\n        if (this._meshes == null) { return null }\n        for (var _i = 0, _a = this._meshes; _i < _a.length; _i++) {\n          var mesh = _a[_i]\n          if (mesh.name === id) { return mesh }\n        }\n        return null\n      }\n      Model.prototype.addParameterValueById = function (id, value) {\n        var p = this._coreModel.parameters.ids.indexOf(id)\n        if (p === -1) {\n          return\n        }\n        this._coreModel.parameters.values[p] = this._coreModel.parameters.values[p] + value\n      }\n      Model._create = function (coreModel, textures, animator, physicsRig, userData, groups) {\n        if (physicsRig === undefined) { physicsRig = null }\n        if (userData === undefined) { userData = null }\n        if (groups === undefined) { groups = null }\n        var model = new Model(coreModel, textures, animator, physicsRig, userData, groups)\n        if (!model.isValid) {\n          model.destroy()\n          return null\n        }\n        return model\n      }\n      Object.defineProperty(Model.prototype, 'isValid', {\n        get: function () {\n          return this._coreModel != null\n        },\n        enumerable: true,\n        configurable: true\n      })\n      return Model\n    }(PIXI.Container))\n    LIVE2DCUBISMPIXI.Model = Model\n    var MaskSpriteContainer = (function (_super) {\n      __extends(MaskSpriteContainer, _super)\n      function MaskSpriteContainer (coreModel, pixiModel) {\n        var _this = _super.call(this) || this\n        _this._maskShaderVertSrc = '\\n            attribute vec2 aVertexPosition;\\n            attribute vec2 aTextureCoord;\\n            uniform mat3 projectionMatrix;\\n            varying vec2 vTextureCoord;\\n            void main(void){\\n                gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\\n                vTextureCoord = aTextureCoord;\\n            }\\n            '\n        _this._maskShaderFragSrc = '\\n            varying vec2 vTextureCoord;\\n            uniform sampler2D uSampler;\\n            void main(void){\\n                vec4 c = texture2D(uSampler, vTextureCoord);\\n                c.r = c.a;\\n                c.g = 0.0;\\n                c.b = 0.0;\\n                gl_FragColor = c;\\n            }\\n            '\n        _this._maskShader = new PIXI.Filter(_this._maskShaderVertSrc.toString(), _this._maskShaderFragSrc.toString())\n        var _maskCounts = coreModel.drawables.maskCounts\n        var _maskRelationList = coreModel.drawables.masks\n        _this._maskMeshContainers = []\n        _this._maskTextures = []\n        _this._maskSprites = []\n        for (var m = 0; m < pixiModel.meshes.length; ++m) {\n          if (_maskCounts[m] > 0) {\n            var newContainer = new PIXI.Container()\n            for (var n = 0; n < _maskRelationList[m].length; ++n) {\n              var meshMaskID = coreModel.drawables.masks[m][n]\n              var maskMesh = new CubismMesh(pixiModel.meshes[meshMaskID].texture, pixiModel.meshes[meshMaskID].vertices, pixiModel.meshes[meshMaskID].uvs, pixiModel.meshes[meshMaskID].indices, PIXI.DRAW_MODES.TRIANGLES)\n              maskMesh.name = pixiModel.meshes[meshMaskID].name\n              maskMesh.transform = pixiModel.meshes[meshMaskID].transform\n              maskMesh.worldTransform = pixiModel.meshes[meshMaskID].worldTransform\n              maskMesh.localTransform = pixiModel.meshes[meshMaskID].localTransform\n              maskMesh.isCulling = pixiModel.meshes[meshMaskID].isCulling\n              maskMesh.isMaskMesh = true\n              maskMesh.filters = [_this._maskShader]\n              newContainer.addChild(maskMesh)\n            }\n            newContainer.transform = pixiModel.transform\n            newContainer.worldTransform = pixiModel.worldTransform\n            newContainer.localTransform = pixiModel.localTransform\n            _this._maskMeshContainers.push(newContainer)\n            var newTexture = PIXI.RenderTexture.create(0, 0)\n            _this._maskTextures.push(newTexture)\n            var newSprite = new PIXI.Sprite(newTexture)\n            _this._maskSprites.push(newSprite)\n            _this.addChild(newSprite)\n            pixiModel.meshes[m].mask = newSprite\n          }\n        }\n        return _this\n      }\n      Object.defineProperty(MaskSpriteContainer.prototype, 'maskSprites', {\n        get: function () {\n          return this._maskSprites\n        },\n        enumerable: true,\n        configurable: true\n      })\n      Object.defineProperty(MaskSpriteContainer.prototype, 'maskMeshes', {\n        get: function () {\n          return this._maskMeshContainers\n        },\n        enumerable: true,\n        configurable: true\n      })\n      MaskSpriteContainer.prototype.destroy = function (options) {\n        this._maskSprites.forEach(function (m) {\n          m.destroy()\n        })\n        this._maskTextures.forEach(function (m) {\n          m.destroy()\n        })\n        this._maskMeshContainers.forEach(function (m) {\n          m.destroy()\n        })\n        this._maskShader = null\n      }\n      MaskSpriteContainer.prototype.update = function (appRenderer) {\n        for (var m = 0; m < this._maskSprites.length; ++m) {\n          appRenderer.render(this._maskMeshContainers[m], this._maskTextures[m], true, null, false)\n        }\n      }\n      MaskSpriteContainer.prototype.resize = function (viewWidth, viewHeight) {\n        for (var m = 0; m < this._maskTextures.length; ++m) {\n          this._maskTextures[m].resize(viewWidth, viewHeight, false)\n        }\n      }\n      return MaskSpriteContainer\n    }(PIXI.Container))\n    LIVE2DCUBISMPIXI.MaskSpriteContainer = MaskSpriteContainer\n    var ModelBuilder = (function () {\n      function ModelBuilder () {\n        this._textures = []\n        this._timeScale = 1\n        this._animatorBuilder = new LIVE2DCUBISMFRAMEWORK.AnimatorBuilder()\n      }\n      ModelBuilder.prototype.setMoc = function (value) {\n        this._moc = value\n        return this\n      }\n      ModelBuilder.prototype.setTimeScale = function (value) {\n        this._timeScale = value\n        return this\n      }\n      ModelBuilder.prototype.setPhysics3Json = function (value) {\n        if (!this._physicsRigBuilder) {\n          this._physicsRigBuilder = new LIVE2DCUBISMFRAMEWORK.PhysicsRigBuilder()\n        }\n        this._physicsRigBuilder.setPhysics3Json(value)\n        return this\n      }\n      ModelBuilder.prototype.setUserData3Json = function (value) {\n        if (!this._userDataBuilder) {\n          this._userDataBuilder = new LIVE2DCUBISMFRAMEWORK.UserDataBuilder()\n        }\n        this._userDataBuilder.setUserData3Json(value)\n        return this\n      }\n      ModelBuilder.prototype.addTexture = function (index, texture) {\n        this._textures.splice(index, 0, texture)\n        return this\n      }\n      ModelBuilder.prototype.addAnimatorLayer = function (name, blender, weight) {\n        if (blender === undefined) { blender = LIVE2DCUBISMFRAMEWORK.BuiltinAnimationBlenders.OVERRIDE }\n        if (weight === undefined) { weight = 1 }\n        this._animatorBuilder.addLayer(name, blender, weight)\n        return this\n      }\n      ModelBuilder.prototype.addGroups = function (groups) {\n        this._groups = groups\n        return this\n      }\n      ModelBuilder.prototype.buildFromModel3Json = function (loader, model3Obj, callbackFunc) {\n        var _this = this\n        var model3URL = model3Obj.url\n        var modelDir = model3URL.substring(0, model3URL.lastIndexOf('/') + 1)\n        var textureCount = 0\n        if (typeof (model3Obj.data.FileReferences.Moc) !== 'undefined') { loader.add('moc', modelDir + model3Obj.data.FileReferences.Moc, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.BUFFER }) }\n        if (typeof (model3Obj.data.FileReferences.Textures) !== 'undefined') {\n          model3Obj.data.FileReferences.Textures.forEach(function (element) {\n            loader.add('texture' + textureCount, modelDir + element)\n            textureCount++\n          })\n        }\n        if (typeof (model3Obj.data.FileReferences.Physics) !== 'undefined') { loader.add('physics', modelDir + model3Obj.data.FileReferences.Physics, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.JSON }) }\n        if (typeof (model3Obj.data.FileReferences.UserData) !== 'undefined') { loader.add('userdata', modelDir + model3Obj.data.FileReferences.UserData, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.JSON }) }\n        if (typeof (model3Obj.data.Groups) !== 'undefined') { this._groups = LIVE2DCUBISMFRAMEWORK.Groups.fromModel3Json(model3Obj.data) }\n        loader.load(function (loader, resources) {\n          if (typeof (resources.moc) !== 'undefined') { _this.setMoc(Live2DCubismCore.Moc.fromArrayBuffer(resources.moc.data)) }\n          if (typeof (resources['texture' + 0]) !== 'undefined') {\n            for (var i = 0; i < textureCount; i++) { _this.addTexture(i, resources['texture' + i].texture) }\n          }\n          if (typeof (resources.physics) !== 'undefined') { _this.setPhysics3Json(resources.physics.data) }\n          if (typeof (resources.userdata) !== 'undefined') { _this.setUserData3Json(resources.userdata.data) }\n          var model = _this.build()\n          callbackFunc(model)\n        })\n      }\n      ModelBuilder.prototype.build = function () {\n        var coreModel = Live2DCubismCore.Model.fromMoc(this._moc)\n        if (coreModel == null) {\n          return null\n        }\n        var animator = this._animatorBuilder\n          .setTarget(coreModel)\n          .setTimeScale(this._timeScale)\n          .build()\n        var physicsRig = null\n        if (this._physicsRigBuilder) {\n          physicsRig = this._physicsRigBuilder\n            .setTarget(coreModel)\n            .setTimeScale(this._timeScale)\n            .build()\n        }\n        var userData = null\n        if (this._userDataBuilder) {\n          userData = this._userDataBuilder\n            .setTarget(coreModel)\n            .build()\n        }\n        return Model._create(coreModel, this._textures, animator, physicsRig, userData, this._groups)\n      }\n      return ModelBuilder\n    }())\n    LIVE2DCUBISMPIXI.ModelBuilder = ModelBuilder\n    var CubismMesh = (function (_super) {\n      __extends(CubismMesh, _super)\n      function CubismMesh () {\n        var _this = (_super !== null && _super.apply(this, arguments)) || this\n        _this.isCulling = false\n        _this.isMaskMesh = false\n        return _this\n      }\n      CubismMesh.prototype._renderWebGL = function (renderer) {\n        if (this.isMaskMesh === true) { renderer.state.setFrontFace(1) } else { renderer.state.setFrontFace(0) }\n        if (this.isCulling === true) { renderer.state.setCullFace(1) } else { renderer.state.setCullFace(0) }\n        _super.prototype._renderWebGL.call(this, renderer)\n        renderer.state.setFrontFace(0)\n      }\n      return CubismMesh\n    }(PIXI.mesh.Mesh))\n    LIVE2DCUBISMPIXI.CubismMesh = CubismMesh\n  })(LIVE2DCUBISMPIXI || (LIVE2DCUBISMPIXI = {}))\n\n  class L2D {\n    constructor (basePath) {\n      this.basePath = basePath\n      this.loader = new PIXI.loaders.Loader(this.basePath)\n      this.animatorBuilder = new LIVE2DCUBISMFRAMEWORK.AnimatorBuilder()\n      this.timeScale = 1\n      this.models = {}\n    }\n\n    setPhysics3Json (value) {\n      if (!this.physicsRigBuilder) {\n        this.physicsRigBuilder = new LIVE2DCUBISMFRAMEWORK.PhysicsRigBuilder()\n      }\n      this.physicsRigBuilder.setPhysics3Json(value)\n\n      return this\n    }\n\n    load (name, v) {\n      if (!this.models[name]) {\n        const modelDir = name + '/'\n        const modelPath = name + '.model3.json'\n        const textures = []\n        let textureCount = 0\n        const motionNames = []\n        const modelNames = []\n\n        // if (!modelNames.includes(name+'_model')){\n        this.loader.add(name + '_model', modelDir + modelPath, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.JSON })\n        modelNames.push(name + '_model')\n        // }\n\n        this.loader.load((loader, resources) => {\n          const model3Obj = resources[name + '_model'].data\n\n          if (typeof (model3Obj.FileReferences.Moc) !== 'undefined') {\n            loader.add(name + '_moc', modelDir + model3Obj.FileReferences.Moc, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.BUFFER })\n          }\n\n          if (typeof (model3Obj.FileReferences.Textures) !== 'undefined') {\n            model3Obj.FileReferences.Textures.forEach((element) => {\n              loader.add(name + '_texture' + textureCount, modelDir + element)\n              textureCount++\n            })\n          }\n\n          if (typeof (model3Obj.FileReferences.Physics) !== 'undefined') {\n            loader.add(name + '_physics', modelDir + model3Obj.FileReferences.Physics, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.JSON })\n          }\n\n          if (typeof (model3Obj.FileReferences.Motions) !== 'undefined') {\n            for (const group in model3Obj.FileReferences.Motions) {\n              model3Obj.FileReferences.Motions[group].forEach((element) => {\n                const motionName = element.File.split('/').pop().split('.').shift()\n                if (!motionNames.includes(name + '_' + motionName)) {\n                  loader.add(name + '_' + motionName, modelDir + element.File, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.JSON })\n                  motionNames.push(name + '_' + motionName)\n                } else {\n                  var n = name + '_' + motionName + String(Date.now())\n                  loader.add(n, modelDir + element.File, { xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.JSON })\n                  motionNames.push(name + '_' + motionName)\n                }\n              })\n            }\n          }\n\n          let groups = null\n          if (typeof (model3Obj.Groups) !== 'undefined') {\n            groups = LIVE2DCUBISMFRAMEWORK.Groups.fromModel3Json(model3Obj)\n          }\n\n          loader.load((l, r) => {\n            let moc = null\n            if (typeof (r[name + '_moc']) !== 'undefined') {\n              moc = Live2DCubismCore.Moc.fromArrayBuffer(r[name + '_moc'].data)\n            }\n\n            if (typeof (r[name + '_texture' + 0]) !== 'undefined') {\n              for (let i = 0; i < textureCount; i++) {\n                textures.splice(i, 0, r[name + '_texture' + i].texture)\n              }\n            }\n\n            if (typeof (r[name + '_physics']) !== 'undefined') {\n              this.setPhysics3Json(r[name + '_physics'].data)\n            }\n\n            const motions = new Map()\n            motionNames.forEach((element) => {\n              const n = element.split(name + '_').pop()\n              motions.set(n, LIVE2DCUBISMFRAMEWORK.Animation.fromMotion3Json(r[element].data))\n            })\n\n            let model = null\n            const coreModel = Live2DCubismCore.Model.fromMoc(moc)\n            if (coreModel == null) {\n              return\n            }\n\n            const animator = this.animatorBuilder\n              .setTarget(coreModel)\n              .setTimeScale(this.timeScale)\n              .build()\n\n            const physicsRig = this.physicsRigBuilder\n              .setTarget(coreModel)\n              .setTimeScale(this.timeScale)\n              .build()\n\n            const userData = null\n\n            model = LIVE2DCUBISMPIXI.Model._create(coreModel, textures, animator, physicsRig, userData, groups)\n            model.motions = motions\n            this.models[name] = model\n\n            v.changeCanvas(model)\n          })\n        })\n      } else {\n        v.changeCanvas(this.models[name])\n      }\n    }\n  }\n  class Live2dV3 { // eslint-disable-line no-unused-vars\n    constructor ({ basePath, modelName, width = 500, height = 300, el, sizeLimit, mobileLimit, sounds }) {\n      if (typeof Live2DCubismCore === 'undefined') {\n        console.error('live2dv3 failed to load:\\nMissing live2dcubismcore.js\\nPlease add \"https://cdn.jsdelivr.net/gh/HCLonely/Live2dV3/js/live2dcubismcore.min.js\" to the \"<script>\" tag.\\nLook at https://github.com/HCLonely/Live2dV3')\n        return\n      }\n      if (typeof PIXI === 'undefined') {\n        console.error('live2dv3 failed to load:\\nMissing pixi.js\\nPlease add \"https://cdn.jsdelivr.net/npm/pixi.js@4.6.1/dist/pixi.min.js\" to the \"<script>\" tag.\\nLook at https://github.com/HCLonely/Live2dV3')\n        return\n      }\n      if (!el) {\n        console.error('\"el\" parameter is required')\n        return\n      }\n\n      if (!this.isDom(el)) {\n        if (el.length > 0) {\n          if (this.isDom(el[0])) {\n            el = el[0]\n          } else {\n            console.error('live2dv3 failed to load:\\n', el[0], 'is not a HTMLElement object')\n            return\n          }\n        } else {\n          console.error('live2dv3 failed to load:\\n', el, 'is not a HTMLElement object')\n          return\n        }\n      }\n\n      if (sizeLimit && (document.documentElement.clientWidth < width || document.documentElement.clientHeight < height)) return\n      if (mobileLimit && /Mobile|Mac OS|Android|iPhone|iPad/i.test(navigator.userAgent)) return\n\n      window.console.log('Live2dV3: loading model \"' + modelName + '\"')\n\n      this.l2d = new L2D(basePath)\n\n      this.canvas = el\n\n      if (modelName) {\n        this.modelName = modelName\n        this.l2d.load(modelName, this)\n      }\n\n      this.app = new PIXI.Application(width, height, { transparent: true })\n      this.canvas.appendChild(this.app.view)\n\n      this.app.ticker.add((deltaTime) => {\n        if (!this.model) {\n          return\n        }\n\n        this.model.update(deltaTime)\n        this.model.masks.update(this.app.renderer)\n      })\n      window.onresize = (event) => {\n        if (event === undefined) { event = null }\n        this.app.view.style.width = width + 'px'\n        this.app.view.style.height = height + 'px'\n        this.app.renderer.resize(width, height)\n\n        if (this.model) {\n          this.model.position = new PIXI.Point((width * 0.5), (height * 0.5))\n          this.model.scale = new PIXI.Point((this.model.position.x * 0.06), (this.model.position.x * 0.06))\n          this.model.masks.resize(this.app.view.width, this.app.view.height)\n        }\n      }\n      this.isClick = false\n      this.app.view.addEventListener('mousedown', (event) => {\n        this.isClick = true\n      })\n      this.app.view.addEventListener('mousemove', (event) => {\n        if (this.isClick) {\n          this.isClick = false\n          if (this.model) {\n            this.model.inDrag = true\n          }\n        }\n\n        if (this.model) {\n          const mouseX = this.model.position.x - event.offsetX\n          const mouseY = this.model.position.y - event.offsetY\n          this.model.pointerX = -mouseX / this.app.view.height\n          this.model.pointerY = -mouseY / this.app.view.width\n        }\n      })\n      this.app.view.addEventListener('mouseup', (event) => {\n        if (!this.model) {\n          return\n        }\n\n        if (this.isClick) {\n          if (this.isHit('TouchHead', event.offsetX, event.offsetY)) {\n            this.startAnimation('touch_head', 'base')\n          } else if (this.isHit('TouchSpecial', event.offsetX, event.offsetY)) {\n            this.startAnimation('touch_special', 'base')\n          } else {\n            const bodyMotions = ['touch_body', 'main_1', 'main_2', 'main_3']\n            const currentMotion = bodyMotions[Math.floor(Math.random() * bodyMotions.length)]\n            this.startAnimation(currentMotion, 'base')\n          }\n          if (sounds && sounds.length > 0) {\n            const soundFile = sounds[Math.floor((Math.random() * sounds.length))]\n            const filePath = /^https?:\\/\\//.test(soundFile) ? soundFile : [basePath, modelName, soundFile].join('/').replace(/(?<!:)\\/\\//g, '/')\n            if (typeof Howl !== 'undefined') {\n              new Howl({ src: [filePath] }).play()\n            } else if (typeof Audio !== 'undefined') {\n              new Audio(filePath).play()\n            } else {\n              console.error('Current browser does not support playing sound.')\n            }\n          }\n        }\n\n        this.isClick = false\n        this.model.inDrag = false\n      })\n    }\n\n    changeCanvas (model) {\n      this.app.stage.removeChildren()\n\n      this.model = model\n      this.model.update = this.onUpdate\n      this.model.animator.addLayer('base', LIVE2DCUBISMFRAMEWORK.BuiltinAnimationBlenders.OVERRIDE, 1)\n\n      this.app.stage.addChild(this.model)\n      this.app.stage.addChild(this.model.masks)\n\n      window.onresize()\n    }\n\n    onUpdate (delta) {\n      const deltaTime = 0.016 * delta\n\n      if (!this.animator.isPlaying) {\n        const m = this.motions.get('idle')\n        this.animator.getLayer('base').play(m)\n      }\n      this._animator.updateAndEvaluate(deltaTime)\n\n      if (this.inDrag) {\n        this.addParameterValueById('ParamAngleX', this.pointerX * 30)\n        this.addParameterValueById('ParamAngleY', -this.pointerY * 30)\n        this.addParameterValueById('ParamBodyAngleX', this.pointerX * 10)\n        this.addParameterValueById('ParamBodyAngleY', -this.pointerY * 10)\n        this.addParameterValueById('ParamEyeBallX', this.pointerX)\n        this.addParameterValueById('ParamEyeBallY', -this.pointerY)\n      }\n\n      if (this._physicsRig) {\n        this._physicsRig.updateAndEvaluate(deltaTime)\n      }\n\n      this._coreModel.update()\n\n      let sort = false\n      for (let m = 0; m < this._meshes.length; ++m) {\n        this._meshes[m].alpha = this._coreModel.drawables.opacities[m]\n        this._meshes[m].visible = Live2DCubismCore.Utils.hasIsVisibleBit(this._coreModel.drawables.dynamicFlags[m])\n        if (Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(this._coreModel.drawables.dynamicFlags[m])) {\n          this._meshes[m].vertices = this._coreModel.drawables.vertexPositions[m]\n          this._meshes[m].dirtyVertex = true\n        }\n        if (Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(this._coreModel.drawables.dynamicFlags[m])) {\n          sort = true\n        }\n      }\n\n      if (sort) {\n        this.children.sort((a, b) => {\n          const aIndex = this._meshes.indexOf(a)\n          const bIndex = this._meshes.indexOf(b)\n          const aRenderOrder = this._coreModel.drawables.renderOrders[aIndex]\n          const bRenderOrder = this._coreModel.drawables.renderOrders[bIndex]\n\n          return aRenderOrder - bRenderOrder\n        })\n      }\n\n      this._coreModel.drawables.resetDynamicFlags()\n    }\n\n    startAnimation (motionId, layerId) {\n      if (!this.model) {\n        return\n      }\n\n      const m = this.model.motions.get(motionId)\n      if (!m) {\n        return\n      }\n\n      const l = this.model.animator.getLayer(layerId)\n      if (!l) {\n        return\n      }\n\n      l.play(m)\n    }\n\n    isHit (id, posX, posY) {\n      if (!this.model) {\n        return false\n      }\n\n      const m = this.model.getModelMeshById(id)\n      if (!m) {\n        return false\n      }\n\n      const vertexOffset = 0\n      const vertexStep = 2\n      const vertices = m.vertices\n\n      let left = vertices[0]\n      let right = vertices[0]\n      let top = vertices[1]\n      let bottom = vertices[1]\n\n      for (let i = 1; i < 4; ++i) {\n        const x = vertices[vertexOffset + i * vertexStep]\n        const y = vertices[vertexOffset + i * vertexStep + 1]\n\n        if (x < left) {\n          left = x\n        }\n        if (x > right) {\n          right = x\n        }\n        if (y < top) {\n          top = y\n        }\n        if (y > bottom) {\n          bottom = y\n        }\n      }\n\n      const mouseX = m.worldTransform.tx - posX\n      const mouseY = m.worldTransform.ty - posY\n      const tx = -mouseX / m.worldTransform.a\n      const ty = -mouseY / m.worldTransform.d\n\n      return ((left <= tx) && (tx <= right) && (top <= ty) && (ty <= bottom))\n    }\n\n    isDom (e) {\n      if (typeof HTMLElement === 'object') {\n        return e instanceof HTMLElement\n      } else {\n        return e && typeof e === 'object' && e.nodeType === 1 && typeof e.nodeName === 'string'\n      }\n    }\n\n    loadModel (modelName) {\n      this.l2d.load(modelName || this.modelName, this)\n    }\n  }\n  const VERSION = '1.2.2'\n  let _a\n  if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {\n    const args = [\n      '\\n\\n       %c %c %c \\u2730 Live2dV3 ' + VERSION + ' \\u2730  %c  \\n%c  https://github.com/HCLonely/Live2dV3  %c\\n\\n',\n      'background: #ff66a5; padding:5px 0;',\n      'background: #ff66a5; padding:5px 0;',\n      'color: #ff66a5; background: #030307; padding:5px 0;',\n      'background: #ff66a5; padding:5px 0;',\n      'background: #ffc3dc; padding:5px 0;',\n      'background: #ff66a5; padding:5px 0;'];\n    (_a = window.console).log.apply(_a, args)\n  } else if (window.console) {\n    window.console.log('Live2dV3 ' + VERSION + ' - https://github.com/HCLonely/Live2dV3')\n  }\n\n  window.l2dViewer = function (options) {\n    return new Live2dV3(options)\n  }\n})()\n"]}]}